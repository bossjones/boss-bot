
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="AI-powered code generation tooling for efficient software development" name="description"/>
<meta content="Malcolm Jones" name="author"/>
<link href="https://bossjones.github.io/boss-bot/docs/ai/" rel="canonical"/>
<link href="../agile-readme/" rel="prev"/>
<link href="../cli/" rel="next"/>
<link href="../images/logo3.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.11" name="generator"/>
<title>.ai docs - Boss Bot</title>
<link href="../assets/stylesheets/main.4af4bdda.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
<link href="../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../css/neoteroi.cards.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="deep-purple" data-md-color-primary="deep-purple" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#ai-docs">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Boss Bot" class="md-header__button md-logo" data-md-component="logo" href=".." title="Boss Bot">
<img alt="logo" src="../images/logo3.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Boss Bot
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              .ai docs
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="deep-purple" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="deep-purple" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="deep-purple" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="deep-purple" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/bossjones/boss-bot" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    bossjones/boss-bot
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Boss Bot" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Boss Bot">
<img alt="logo" src="../images/logo3.png"/>
</a>
    Boss Bot
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/bossjones/boss-bot" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    bossjones/boss-bot
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Boss-Bot
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../AI_INTEGRATION/">
<span class="md-ellipsis">
    Boss-Bot AI Integration Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../agile-readme/">
<span class="md-ellipsis">
    Cursor Agile Workflow Documentation
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    .ai docs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cli/">
<span class="md-ellipsis">
    BossBot CLI (bossctl) Documentation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../codebase_structure/">
<span class="md-ellipsis">
    Boss-Bot Codebase Structure
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../coverage/">
<span class="md-ellipsis">
    Coverage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cursor-rules-reference/">
<span class="md-ellipsis">
    Cursor Rules Reference
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../downloaders/">
<span class="md-ellipsis">
    Download System: gallery-dl and yt-dlp Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../downloaders_config/">
<span class="md-ellipsis">
    Download Client Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../environment/">
<span class="md-ellipsis">
    Environment
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../langgraph-assistants/">
<span class="md-ellipsis">
    Macro Rendering Error
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/">
<span class="md-ellipsis">
    Loguru Thread-Safe Interceptor Setup Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging_testing/">
<span class="md-ellipsis">
    Loguru Testing with Logot &amp; Pytest Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging_typing/">
<span class="md-ellipsis">
    Loguru Type Hints &amp; IDE Support Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../people/">
<span class="md-ellipsis">
    People
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project_structure/">
<span class="md-ellipsis">
    Boss-Bot Project Structure
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../vcr/">
<span class="md-ellipsis">
    pytest-recording: A pytest plugin that allows you recording of network interactions via VCR.py
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../versioning/">
<span class="md-ellipsis">
    Versioning
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../workflow-rules/">
<span class="md-ellipsis">
    Cursor Workflow Rules
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_21" type="checkbox"/>
<label class="md-nav__link" for="__nav_21" id="__nav_21_label" tabindex="">
<span class="md-ellipsis">
    Contributors
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_21_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_21">
<span class="md-nav__icon md-icon"></span>
            Contributors
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../contributors/dpytest_example/">
<span class="md-ellipsis">
    Discord.py Bot Testing with dpytest
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_22" type="checkbox"/>
<label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="">
<span class="md-ellipsis">
    Core
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_22_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_22">
<span class="md-nav__icon md-icon"></span>
            Core
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../core/architecture-overview/">
<span class="md-ellipsis">
    Architecture Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core/configuration-management/">
<span class="md-ellipsis">
    Configuration Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core/development-workflow/">
<span class="md-ellipsis">
    Development Workflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core/discord-integration/">
<span class="md-ellipsis">
    Discord Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core/download-system/">
<span class="md-ellipsis">
    Download System
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core/testing-patterns/">
<span class="md-ellipsis">
    Testing Patterns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../core/upload-system/">
<span class="md-ellipsis">
    Upload System
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23" type="checkbox"/>
<label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="">
<span class="md-ellipsis">
    Development
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_23">
<span class="md-nav__icon md-icon"></span>
            Development
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../development/claude_code/">
<span class="md-ellipsis">
    Claude code
    
  </span>
</a>
<label class="md-nav__link" for="__nav_23_1" id="__nav_23_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_23_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_1">
<span class="md-nav__icon md-icon"></span>
            Claude code
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../development/claude_code/custom_slash_commands/">
<span class="md-ellipsis">
    Create a Custom Slash Command for your project in Claude Code
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_1_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../development/claude_code/claude-sessions/">
<span class="md-ellipsis">
    Claude sessions
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_23_1_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_23_1_3">
<span class="md-nav__icon md-icon"></span>
            Claude sessions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../development/fastmcp/">
<span class="md-ellipsis">
    Fastmcp
    
  </span>
</a>
<label class="md-nav__link" for="__nav_23_2" id="__nav_23_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_23_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_2">
<span class="md-nav__icon md-icon"></span>
            Fastmcp
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/api-reference/">
<span class="md-ellipsis">
    API Reference
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/authentication/">
<span class="md-ellipsis">
    Authentication
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/context/">
<span class="md-ellipsis">
    Context
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/custom-middleware/">
<span class="md-ellipsis">
    Custom Middleware
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/custom-routes/">
<span class="md-ellipsis">
    Macro Syntax Error
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/database-integration/">
<span class="md-ellipsis">
    Database Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/debugging/">
<span class="md-ellipsis">
    Debugging
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/development-workflow/">
<span class="md-ellipsis">
    Development Workflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/event-store-integration/">
<span class="md-ellipsis">
    Event Store Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/examples/">
<span class="md-ellipsis">
    Examples and Best Practices
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/faq/">
<span class="md-ellipsis">
    FAQ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/lifespan-management/">
<span class="md-ellipsis">
    Lifespan Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/migration-guide/">
<span class="md-ellipsis">
    Migration Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/monitoring-observability/">
<span class="md-ellipsis">
    Macro Syntax Error
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/overview/">
<span class="md-ellipsis">
    FastMCP Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/performance-guide/">
<span class="md-ellipsis">
    Performance Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/prompts/">
<span class="md-ellipsis">
    Prompts
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/resources/">
<span class="md-ellipsis">
    Resources
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/security-guide/">
<span class="md-ellipsis">
    Security Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/session-management/">
<span class="md-ellipsis">
    Session Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/testing-guide/">
<span class="md-ellipsis">
    Testing Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/tools/">
<span class="md-ellipsis">
    Tools
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/transports/">
<span class="md-ellipsis">
    Transport Protocols
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development/fastmcp/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_23_3" id="__nav_23_3_label" tabindex="0">
<span class="md-ellipsis">
    Github actions
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_3">
<span class="md-nav__icon md-icon"></span>
            Github actions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../development/github_actions/claude_workflow/">
<span class="md-ellipsis">
    Claude GitHub Actions Workflow Documentation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_23_4" id="__nav_23_4_label" tabindex="0">
<span class="md-ellipsis">
    Testing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_4">
<span class="md-nav__icon md-icon"></span>
            Testing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../development/testing/pytest_recording/">
<span class="md-ellipsis">
    VCR Cassettes
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_23_5" id="__nav_23_5_label" tabindex="0">
<span class="md-ellipsis">
    Typing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_5">
<span class="md-nav__icon md-icon"></span>
            Typing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../development/typing/monkeytype/">
<span class="md-ellipsis">
    PYTEST.md
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_24" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../til/">
<span class="md-ellipsis">
    Til
    
  </span>
</a>
<label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_24_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_24">
<span class="md-nav__icon md-icon"></span>
            Til
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Archive
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/bossjones/boss-bot/edit/main/docs/ai.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/bossjones/boss-bot/raw/main/docs/ai.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"></path></svg>
</a>
<h1 id="ai-docs">.ai docs<a class="headerlink" href="#ai-docs" title="Permanent link">¶</a></h1>
<h1 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">¶</a></h1>
<ul>
<li><a href="#file-architecture-arch-md">.ai/architecture/arch.md</a></li>
<li><a href="#file-defered-stories-defered-story-1-story-md">.ai/defered-stories/defered-story-1.story.md</a></li>
<li><a href="#file-diagrams-module-fixtures-current-md">.ai/diagrams/module-fixtures-current.md</a></li>
<li><a href="#file-diagrams-module-fixtures-recommended-md">.ai/diagrams/module-fixtures-recommended.md</a></li>
<li><a href="#file-diagrams-pytest_fixtures_relationships-mmd">.ai/diagrams/pytest_fixtures_relationships.mmd</a></li>
<li><a href="#file-prd-prd-md">.ai/prd/prd.md</a></li>
<li><a href="#file-stories-epic-1-epic-md">.ai/stories/epic-1.epic.md</a></li>
<li><a href="#file-stories-story-1-story-md">.ai/stories/story-1.story.md</a></li>
</ul>
<hr/>
<h1 id="file-architecture-arch-md">.ai/architecture/arch.md</h1>
<h1 id="architecture-for-boss-bot-a-discord-media-download-and-rag-assistant">Architecture for Boss-Bot: A Discord Media Download and RAG Assistant<a class="headerlink" href="#architecture-for-boss-bot-a-discord-media-download-and-rag-assistant" title="Permanent link">¶</a></h1>
<p>Status: Approved</p>
<h2 id="technical-summary">Technical Summary<a class="headerlink" href="#technical-summary" title="Permanent link">¶</a></h2>
<p>Boss-Bot is a Discord bot designed to provide reliable media download capabilities from platforms like Twitter and Reddit, with a foundation for future RAG (Retrieval-Augmented Generation) features. The architecture follows a modular, event-driven design using Python 3.12 and discord.py as the core framework. The system implements a robust queue management system for downloads, comprehensive error handling, and a test-driven development approach.</p>
<h2 id="technology-table">Technology Table<a class="headerlink" href="#technology-table" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Technology</th>
<th>Description</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Python</td>
<td>Primary development language, chosen for strong async support and modern features</td>
<td>&gt;=3.12</td>
</tr>
<tr>
<td>discord.py</td>
<td>Discord bot framework providing event handling and API integration</td>
<td>&gt;=2.5.2</td>
</tr>
<tr>
<td>gallery-dl</td>
<td>Media download utility for Twitter, Reddit, and other platforms</td>
<td>&gt;=1.29.3</td>
</tr>
<tr>
<td>yt-dlp</td>
<td>YouTube/video download utility for extended platform support</td>
<td>Latest</td>
</tr>
<tr>
<td>httpx</td>
<td>Modern HTTP client for async API interactions</td>
<td>Latest</td>
</tr>
<tr>
<td>pydantic</td>
<td>Data validation and settings management</td>
<td>&gt;=2.0</td>
</tr>
<tr>
<td>pydantic-settings</td>
<td>Environment configuration management</td>
<td>Latest</td>
</tr>
<tr>
<td>loguru</td>
<td>Advanced logging with structured output</td>
<td>Latest</td>
</tr>
<tr>
<td>pytest</td>
<td>Testing framework with async support</td>
<td>Latest</td>
</tr>
<tr>
<td>pytest-asyncio</td>
<td>Async test support</td>
<td>Latest</td>
</tr>
<tr>
<td>dpytest</td>
<td>Discord.py testing utilities</td>
<td>Latest</td>
</tr>
<tr>
<td>better-exceptions</td>
<td>Enhanced exception handling and formatting</td>
<td>Latest</td>
</tr>
<tr>
<td>ruff</td>
<td>Fast Python linter and formatter written in Rust</td>
<td>Latest</td>
</tr>
<tr>
<td>uv</td>
<td>Modern Python package manager for dependency management</td>
<td>Latest</td>
</tr>
</tbody>
</table>
<h2 id="architectural-diagrams">Architectural Diagrams<a class="headerlink" href="#architectural-diagrams" title="Permanent link">¶</a></h2>
<h3 id="core-system-architecture">Core System Architecture<a class="headerlink" href="#core-system-architecture" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TB
    DC[Discord Client] --&gt; EH[Event Handler]
    EH --&gt; CM[Command Manager]
    CM --&gt; DQ[Download Queue]
    DQ --&gt; DM[Download Manager]
    DM --&gt; TD[Twitter Downloader]
    DM --&gt; RD[Reddit Downloader]
    DM --&gt; FS[File Storage]
    FS --&gt; DU[Discord Uploader]

    subgraph Monitoring
        M[Metrics] --&gt; L[Logging]
        L --&gt; EX[Error Handler]
    end
</code></pre>
<h3 id="download-flow">Download Flow<a class="headerlink" href="#download-flow" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant U as User
    participant B as Bot
    participant Q as Queue
    participant D as Downloader
    participant F as FileSystem
    participant Di as Discord

    U-&gt;&gt;B: $dlt command
    B-&gt;&gt;Q: Add to queue
    Q-&gt;&gt;B: Position update
    B-&gt;&gt;U: Queue status
    Q-&gt;&gt;D: Process download
    D-&gt;&gt;F: Save file
    F-&gt;&gt;Di: Upload file
    Di-&gt;&gt;U: File link
</code></pre>
<h2 id="environment-configuration">Environment Configuration<a class="headerlink" href="#environment-configuration" title="Permanent link">¶</a></h2>
<h3 id="settings-management">Settings Management<a class="headerlink" href="#settings-management" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BotSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Bot configuration settings."""</span>
    <span class="c1"># Sensitive data using SecretStr</span>
    <span class="n">discord_token</span><span class="p">:</span> <span class="n">SecretStr</span>

    <span class="c1"># Basic configuration</span>
    <span class="n">command_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"$"</span>
    <span class="n">max_concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">max_queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
        <span class="n">env_prefix</span> <span class="o">=</span> <span class="s2">"BOSS_BOT_"</span>
</code></pre></div>
<h3 id="required-environment-variables">Required Environment Variables<a class="headerlink" href="#required-environment-variables" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Required</span>
<span class="nv">BOSS_BOT_DISCORD_TOKEN</span><span class="o">=</span>required<span class="w">      </span><span class="c1"># Discord bot token (sensitive)</span>
<span class="nv">BOSS_BOT_COMMAND_PREFIX</span><span class="o">=</span>$<span class="w">            </span><span class="c1"># Command prefix (optional)</span>

<span class="c1"># Optional with defaults</span>
<span class="nv">BOSS_BOT_MAX_CONCURRENT_DOWNLOADS</span><span class="o">=</span><span class="m">5</span>
<span class="nv">BOSS_BOT_MAX_QUEUE_SIZE</span><span class="o">=</span><span class="m">50</span>
</code></pre></div>
<h2 id="data-models">Data Models<a class="headerlink" href="#data-models" title="Permanent link">¶</a></h2>
<h3 id="core-models">Core Models<a class="headerlink" href="#core-models" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">HttpUrl</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadStatus</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Status of a download item."""</span>
    <span class="n">QUEUED</span> <span class="o">=</span> <span class="s2">"queued"</span>
    <span class="n">DOWNLOADING</span> <span class="o">=</span> <span class="s2">"downloading"</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">"completed"</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">"failed"</span>
    <span class="n">CANCELLED</span> <span class="o">=</span> <span class="s2">"cancelled"</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadPriority</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Priority levels for downloads."""</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">NORMAL</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadItem</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Represents a single download request."""</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">HttpUrl</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DownloadStatus</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">DownloadPriority</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">channel_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">progress</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">total_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QueueState</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Represents the current state of the download queue."""</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DownloadItem</span><span class="p">]</span>
    <span class="n">active_downloads</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">total_items</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">queue_size</span><span class="p">:</span> <span class="nb">int</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_full</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_items</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_size</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Standardized error response."""</span>
    <span class="n">error_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
</code></pre></div>
<h2 id="project-structure">Project Structure<a class="headerlink" href="#project-structure" title="Permanent link">¶</a></h2>
<div class="highlight"><pre><span></span><code>boss-bot/
├── src/
│   ├── boss_bot/
│   │   ├── bot/           # Discord bot core
│   │   ├── commands/      # Command implementations
│   │   ├── core/          # Core functionality
│   │   ├── downloaders/   # Download implementations
│   │   ├── schemas/       # Data models
│   │   └── utils/         # Utilities
├── tests/                 # Test suite
├── docs/                  # Documentation
└── scripts/              # Utility scripts
</code></pre></div>
<h2 id="infrastructure">Infrastructure<a class="headerlink" href="#infrastructure" title="Permanent link">¶</a></h2>
<h3 id="development-environment">Development Environment<a class="headerlink" href="#development-environment" title="Permanent link">¶</a></h3>
<ul>
<li>Local development using Python virtual environments</li>
<li>UV for dependency management</li>
<li>Pre-commit hooks for code quality</li>
<li>pytest for testing infrastructure</li>
</ul>
<h3 id="runtime-environment">Runtime Environment<a class="headerlink" href="#runtime-environment" title="Permanent link">¶</a></h3>
<ul>
<li>Local machine (macOS) or Linux server</li>
<li>Python 3.12+ runtime</li>
<li>Persistent storage for temporary files</li>
<li>Discord API integration</li>
<li>Logging and monitoring setup</li>
</ul>
<h3 id="resource-requirements">Resource Requirements<a class="headerlink" href="#resource-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Basic system requirements for local/server deployment:</li>
<li>CPU: 1-2 cores</li>
<li>Memory: 512MB minimum</li>
<li>Storage: 5GB minimum for temporary files</li>
<li>Network: Stable internet connection</li>
</ul>
<h2 id="deployment-plan">Deployment Plan<a class="headerlink" href="#deployment-plan" title="Permanent link">¶</a></h2>
<h3 id="phase-1-mvp-setup">Phase 1: MVP Setup<a class="headerlink" href="#phase-1-mvp-setup" title="Permanent link">¶</a></h3>
<ol>
<li>Initialize Python project with UV</li>
<li>Set up testing infrastructure with GitHub Actions CI/CD</li>
<li>Implement basic Discord bot framework</li>
<li>Add core download functionality</li>
<li>Implement queue management</li>
<li>Set up local deployment via <code>uv run bossbotctl</code></li>
</ol>
<h3 id="phase-2-enhanced-features">Phase 2: Enhanced Features<a class="headerlink" href="#phase-2-enhanced-features" title="Permanent link">¶</a></h3>
<ol>
<li>Add progress tracking</li>
<li>Implement file management</li>
<li>Add error handling</li>
<li>Set up monitoring</li>
<li>Add user management</li>
<li>Implement bot admin restart command</li>
</ol>
<h3 id="phase-3-security-enhancements-nice-to-have">Phase 3: Security Enhancements (Nice to Have)<a class="headerlink" href="#phase-3-security-enhancements-nice-to-have" title="Permanent link">¶</a></h3>
<ol>
<li>Implement API key rotation strategy</li>
<li>Add detailed rate limiting per command</li>
<li>Enhance file storage security</li>
<li>Implement granular user permissions</li>
<li>Set up audit logging</li>
<li>Add security monitoring integration</li>
</ol>
<h3 id="phase-4-future-rag-integration">Phase 4: Future RAG Integration<a class="headerlink" href="#phase-4-future-rag-integration" title="Permanent link">¶</a></h3>
<ol>
<li>Set up vector store</li>
<li>Implement document processing</li>
<li>Add RAG functionality</li>
<li>Enhance command set</li>
</ol>
<h3 id="error-handling-resilience">Error Handling &amp; Resilience<a class="headerlink" href="#error-handling-resilience" title="Permanent link">¶</a></h3>
<p>The system leverages built-in error handling and resilience features from gallery-dl and yt-dlp, complemented by our own error management:</p>
<h4 id="platform-specific-rate-limiting">Platform-Specific Rate Limiting<a class="headerlink" href="#platform-specific-rate-limiting" title="Permanent link">¶</a></h4>
<ul>
<li>Utilizes gallery-dl and yt-dlp's built-in rate limit handling</li>
<li>Automatic backoff and retry mechanisms per platform</li>
<li>Configurable delay between requests</li>
<li>Platform-specific quota management</li>
</ul>
<h4 id="download-retry-strategy">Download Retry Strategy<a class="headerlink" href="#download-retry-strategy" title="Permanent link">¶</a></h4>
<ul>
<li>Leverages gallery-dl and yt-dlp's retry mechanisms</li>
<li>Automatic retry on transient failures</li>
<li>Exponential backoff for repeated failures</li>
<li>Maximum retry attempts configurable per platform</li>
</ul>
<h4 id="network-resilience">Network Resilience<a class="headerlink" href="#network-resilience" title="Permanent link">¶</a></h4>
<ul>
<li>Timeout handling through gallery-dl and yt-dlp</li>
<li>Automatic connection recovery</li>
<li>Partial download resume capability</li>
<li>Bandwidth throttling support</li>
</ul>
<h4 id="failure-recovery">Failure Recovery<a class="headerlink" href="#failure-recovery" title="Permanent link">¶</a></h4>
<ul>
<li>Automatic cleanup of failed downloads</li>
<li>Session recovery after bot restart</li>
<li>Queue state preservation</li>
<li>Incomplete download handling</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DownloadRetryConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Configuration for download retry behavior."""</span>
    <span class="n">MAX_RETRIES</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">INITIAL_DELAY</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># seconds</span>
    <span class="n">MAX_DELAY</span> <span class="o">=</span> <span class="mf">30.0</span>  <span class="c1"># seconds</span>
    <span class="n">BACKOFF_FACTOR</span> <span class="o">=</span> <span class="mf">2.0</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_retry_delay</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Calculate delay for retry attempt."""</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">INITIAL_DELAY</span> <span class="o">*</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">BACKOFF_FACTOR</span> <span class="o">**</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">MAX_DELAY</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Manages download operations with resilience."""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_with_retry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">download_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Attempt download with retry logic."""</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">DownloadRetryConfig</span><span class="o">.</span><span class="n">MAX_RETRIES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">download_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">DownloadRetryConfig</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DownloadError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Max retries exceeded: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

                <span class="n">delay</span> <span class="o">=</span> <span class="n">DownloadRetryConfig</span><span class="o">.</span><span class="n">get_retry_delay</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Download attempt </span><span class="si">{</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> failed, retrying in </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s2">s"</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="n">download_id</span><span class="o">=</span><span class="n">download_id</span>
                <span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</code></pre></div>
<h3 id="cicd-pipeline">CI/CD Pipeline<a class="headerlink" href="#cicd-pipeline" title="Permanent link">¶</a></h3>
<p>The project uses GitHub Actions for continuous integration and deployment:
- Automated testing on pull requests
- Code quality checks using ruff
- Documentation generation and validation
- Dependency management with UV</p>
<h3 id="bot-management">Bot Management<a class="headerlink" href="#bot-management" title="Permanent link">¶</a></h3>
<ul>
<li>Bot runs locally via <code>uv run bossbotctl</code></li>
<li>Admin-only bot restart command (planned feature)</li>
<li>No containerization or complex infrastructure required</li>
<li>Simple start/stop/restart procedures through command line</li>
</ul>
<h2 id="testing-strategy">Testing Strategy<a class="headerlink" href="#testing-strategy" title="Permanent link">¶</a></h2>
<h3 id="coverage-requirements">Coverage Requirements<a class="headerlink" href="#coverage-requirements" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">COVERAGE_TARGETS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"core_download"</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>  <span class="c1"># 30% coverage</span>
    <span class="s2">"command_parsing"</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
    <span class="s2">"discord_events"</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
    <span class="s2">"file_management"</span><span class="p">:</span> <span class="mf">0.30</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="test-infrastructure">Test Infrastructure<a class="headerlink" href="#test-infrastructure" title="Permanent link">¶</a></h3>
<p>The testing infrastructure is built on pytest with async support and specialized Discord testing utilities:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># conftest.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">discord.ext.test</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dpytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">discord.ext</span><span class="w"> </span><span class="kn">import</span> <span class="n">commands</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pytest_configure</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Configure pytest with custom markers."""</span>
    <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span>
        <span class="s2">"markers"</span><span class="p">,</span>
        <span class="s2">"integration: mark test as integration test"</span>
    <span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span>
        <span class="s2">"markers"</span><span class="p">,</span>
        <span class="s2">"slow: mark test as slow running"</span>
    <span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Create a bot instance for testing."""</span>
    <span class="n">intents</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">Intents</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
    <span class="n">intents</span><span class="o">.</span><span class="n">message_content</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">Bot</span><span class="p">(</span><span class="n">command_prefix</span><span class="o">=</span><span class="s2">"$"</span><span class="p">,</span> <span class="n">intents</span><span class="o">=</span><span class="n">intents</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">_async_setup_hook</span><span class="p">()</span>
    <span class="n">dpytest</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">bot</span>
    <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">empty_queue</span><span class="p">()</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_gallery_dl</span><span class="p">(</span><span class="n">mocker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Mock gallery-dl functionality using pytest-mock."""</span>
    <span class="k">return</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"gallery_dl.download"</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_yt_dlp</span><span class="p">(</span><span class="n">mocker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Mock yt-dlp functionality using pytest-mock."""</span>
    <span class="k">return</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"yt_dlp.YoutubeDL"</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_download_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Provide sample download data for tests."""</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"twitter_url"</span><span class="p">:</span> <span class="s2">"https://twitter.com/user/status/123"</span><span class="p">,</span>
        <span class="s2">"reddit_url"</span><span class="p">:</span> <span class="s2">"https://reddit.com/r/sub/comments/123"</span><span class="p">,</span>
        <span class="s2">"expected_output"</span><span class="p">:</span> <span class="s2">"video.mp4"</span>
    <span class="p">}</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_dir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Create a temporary download directory."""</span>
    <span class="n">downloads</span> <span class="o">=</span> <span class="n">tmpdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">"downloads"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">downloads</span><span class="p">))</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_discord_message</span><span class="p">(</span><span class="n">mocker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Create a mock Discord message."""</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">message</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">123456789</span>
    <span class="n">message</span><span class="o">.</span><span class="n">guild</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">987654321</span>
    <span class="n">message</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">456789123</span>
    <span class="k">return</span> <span class="n">message</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_download_manager</span><span class="p">(</span><span class="n">mocker</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Create a mock download manager."""</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>
    <span class="k">return</span> <span class="n">manager</span>
</code></pre></div>
<h3 id="integration-test-strategy">Integration Test Strategy<a class="headerlink" href="#integration-test-strategy" title="Permanent link">¶</a></h3>
<p>Integration tests focus on key user flows and system interactions:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestDownloadFlow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Test complete download flows."""</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_twitter_download_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bot</span><span class="p">,</span>
        <span class="n">mock_gallery_dl</span><span class="p">,</span>
        <span class="n">sample_download_data</span><span class="p">,</span>
        <span class="n">download_dir</span><span class="p">,</span>
        <span class="n">mock_discord_message</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Test complete Twitter download flow."""</span>
        <span class="c1"># Arrange</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">sample_download_data</span><span class="p">[</span><span class="s2">"twitter_url"</span><span class="p">]</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">/</span> <span class="n">sample_download_data</span><span class="p">[</span><span class="s2">"expected_output"</span><span class="p">]</span>
        <span class="n">mock_gallery_dl</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>

        <span class="c1"># Act</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Download started"</span><span class="p">)</span>
        <span class="n">mock_gallery_dl</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">mocker</span><span class="o">.</span><span class="n">ANY</span>  <span class="c1"># Config dict</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Download complete"</span><span class="p">)</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_queue_management</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bot</span><span class="p">,</span>
        <span class="n">mock_gallery_dl</span><span class="p">,</span>
        <span class="n">download_dir</span><span class="p">,</span>
        <span class="n">mock_discord_message</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Test queue handling with multiple downloads."""</span>
        <span class="c1"># Arrange</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"https://twitter.com/user/status/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">mock_gallery_dl</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">download_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"video_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.mp4"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Act &amp; Assert</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Position in queue: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_error_handling</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bot</span><span class="p">,</span>
        <span class="n">mock_gallery_dl</span><span class="p">,</span>
        <span class="n">mock_discord_message</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Test error handling in download flow."""</span>
        <span class="c1"># Arrange</span>
        <span class="n">mock_gallery_dl</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Download failed"</span><span class="p">)</span>

        <span class="c1"># Act</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">"$dlt https://twitter.com/user/status/123"</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Error occurred"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_download_retry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mocker</span><span class="p">,</span>
        <span class="n">mock_download_manager</span><span class="p">,</span>
        <span class="n">download_dir</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Test download retry mechanism."""</span>
        <span class="c1"># Arrange</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>
        <span class="n">mock_download_manager</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s2">"First attempt failed"</span><span class="p">),</span>
            <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Second attempt failed"</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">download_dir</span> <span class="o">/</span> <span class="s2">"success.mp4"</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Act</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">mock_download_manager</span><span class="o">.</span><span class="n">download_with_retry</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="n">mock_download_manager</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"success.mp4"</span><span class="p">)</span>
</code></pre></div>
<h3 id="external-service-mocking">External Service Mocking<a class="headerlink" href="#external-service-mocking" title="Permanent link">¶</a></h3>
<p>Guidelines for mocking external services using pytest-mock:</p>
<ol>
<li>
<p><strong>Gallery-dl Mocking</strong>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_gallery_dl_download</span><span class="p">(</span><span class="n">mocker</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Example of gallery-dl mocking."""</span>
    <span class="c1"># Arrange</span>
    <span class="n">mock_gallery_dl</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"gallery_dl.download"</span><span class="p">)</span>
    <span class="n">mock_gallery_dl</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"filename"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">download_dir</span> <span class="o">/</span> <span class="s2">"video.mp4"</span><span class="p">),</span>
        <span class="s2">"filesize"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://example.com/video.mp4"</span>
    <span class="p">}</span>

    <span class="c1"># Act &amp; Assert</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">mock_gallery_dl</span><span class="p">(</span><span class="s2">"https://twitter.com/user/status/123"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">"filename"</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">download_dir</span>
</code></pre></div></p>
</li>
<li>
<p><strong>YT-DLP Mocking</strong>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_yt_dlp_download</span><span class="p">(</span><span class="n">mocker</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Example of yt-dlp mocking."""</span>
    <span class="c1"># Arrange</span>
    <span class="n">mock_yt_dlp</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"yt_dlp.YoutubeDL"</span><span class="p">)</span>
    <span class="n">mock_instance</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">mock_instance</span><span class="o">.</span><span class="n">extract_info</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Test Video"</span><span class="p">,</span>
        <span class="s2">"duration"</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">"url"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">download_dir</span> <span class="o">/</span> <span class="s2">"video.mp4"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">mock_yt_dlp</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_instance</span>

    <span class="c1"># Act &amp; Assert</span>
    <span class="k">with</span> <span class="n">mock_yt_dlp</span><span class="p">()</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">extract_info</span><span class="p">(</span><span class="s2">"https://youtube.com/watch?v=123"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">"url"</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">download_dir</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="test-data-management">Test Data Management<a class="headerlink" href="#test-data-management" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Test Data Storage</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_data_dir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Set up test data directory structure."""</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>

    <span class="c1"># Create directory structure</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">/</span> <span class="s2">"samples"</span>
    <span class="n">samples</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"twitter"</span><span class="p">,</span> <span class="s2">"reddit"</span><span class="p">,</span> <span class="s2">"youtube"</span><span class="p">]:</span>
        <span class="p">(</span><span class="n">samples</span> <span class="o">/</span> <span class="n">platform</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

    <span class="c1"># Create mock responses directory</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">/</span> <span class="s2">"responses"</span>
    <span class="n">responses</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">base_dir</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cleanup_downloads</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Clean up downloads after tests."""</span>
    <span class="k">yield</span>
    <span class="c1"># Cleanup happens automatically with tmpdir</span>
</code></pre></div></li>
</ol>
<h3 id="ci-integration">CI Integration<a class="headerlink" href="#ci-integration" title="Permanent link">¶</a></h3>
<p>GitHub Actions workflow for automated testing:</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test Suite</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"3.12"</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.python-version }}</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install uv</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">curl -LsSf https://astral.sh/uv/install.sh | sh</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">uv pip install -r requirements.txt</span>
<span class="w">        </span><span class="no">uv pip install -r requirements-dev.txt</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">pytest tests/ --cov=boss_bot --cov-report=xml</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload coverage</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v4</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./coverage.xml</span>
<span class="w">        </span><span class="nt">fail_ci_if_error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<h2 id="error-handling-and-logging">Error Handling and Logging<a class="headerlink" href="#error-handling-and-logging" title="Permanent link">¶</a></h2>
<h3 id="logging-configuration">Logging Configuration<a class="headerlink" href="#logging-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">better_exceptions</span>

<span class="c1"># Enable better exception formatting</span>
<span class="n">better_exceptions</span><span class="o">.</span><span class="n">hook</span><span class="p">()</span>

<span class="c1"># Configure Loguru</span>
<span class="n">logger</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c1"># Remove default handler</span>
<span class="n">logger</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"sink"</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="s2">"format"</span><span class="p">:</span> <span class="s2">"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | &lt;level&gt;</span><span class="si">{level: &lt;8}</span><span class="s2">&lt;/level&gt; | &lt;cyan&gt;</span><span class="si">{name}</span><span class="s2">&lt;/cyan&gt;:&lt;cyan&gt;</span><span class="si">{function}</span><span class="s2">&lt;/cyan&gt;:&lt;cyan&gt;</span><span class="si">{line}</span><span class="s2">&lt;/cyan&gt; - &lt;level&gt;</span><span class="si">{message}</span><span class="s2">&lt;/level&gt;"</span><span class="p">,</span>
            <span class="s2">"level"</span><span class="p">:</span> <span class="s2">"INFO"</span><span class="p">,</span>
            <span class="s2">"colorize"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"backtrace"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"diagnose"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"enqueue"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Error logging handler</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">"</span><span class="si">{time}</span><span class="s2"> | </span><span class="si">{level}</span><span class="s2"> | </span><span class="si">{message}</span><span class="s2">"</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">record</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s2">"level"</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ERROR"</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">"ERROR"</span><span class="p">,</span>
    <span class="n">backtrace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">diagnose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="error-handling-strategy">Error Handling Strategy<a class="headerlink" href="#error-handling-strategy" title="Permanent link">¶</a></h3>
<ol>
<li>All errors are caught and logged with context</li>
<li>User-facing errors are displayed in Discord embeds</li>
<li>Stack traces are formatted using better-exceptions</li>
<li>Sensitive information is never included in error messages</li>
</ol>
<p>Example error handler:
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">discord.ext</span><span class="w"> </span><span class="kn">import</span> <span class="n">commands</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandler</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">Cog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handles all command errors."""</span>

    <span class="nd">@commands</span><span class="o">.</span><span class="n">Cog</span><span class="o">.</span><span class="n">listener</span><span class="p">()</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_command_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Global error handler for all commands."""</span>
        <span class="c1"># Log the error with context</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">"Command error occurred"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">command</span> <span class="k">else</span> <span class="s2">"Unknown"</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">guild_id</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">guild</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Create user-facing error message</span>
        <span class="n">embed</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">Embed</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">"Error Occurred"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"```python</span><span class="se">\n</span><span class="si">{</span><span class="n">better_exceptions</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">```"</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">discord</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">red</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Add error context if available</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">commands</span><span class="o">.</span><span class="n">CommandError</span><span class="p">):</span>
            <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">"Error Type"</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">inline</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">embed</span><span class="o">=</span><span class="n">embed</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="logging-best-practices">Logging Best Practices<a class="headerlink" href="#logging-best-practices" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>Use structured logging with context:
   <div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
    <span class="s2">"Download started"</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
    <span class="n">guild_id</span><span class="o">=</span><span class="n">guild_id</span>
<span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p>Log all state transitions:
   <div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
    <span class="s2">"Download state changed"</span><span class="p">,</span>
    <span class="n">download_id</span><span class="o">=</span><span class="n">download</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">old_state</span><span class="o">=</span><span class="n">old_state</span><span class="p">,</span>
    <span class="n">new_state</span><span class="o">=</span><span class="n">new_state</span>
<span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p>Never log sensitive information:
   <div class="highlight"><pre><span></span><code><span class="c1"># Good</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Bot connected"</span><span class="p">,</span> <span class="n">application_id</span><span class="o">=</span><span class="n">bot</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="c1"># Bad - never log tokens or sensitive data</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Bot connected with token"</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span>  <span class="c1"># Don't do this!</span>
</code></pre></div></p>
</li>
</ol>
<h2 id="change-log">Change Log<a class="headerlink" href="#change-log" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.1.0</td>
<td>2024-04-17</td>
<td>@bossjones</td>
<td>Initial architecture draft</td>
</tr>
<tr>
<td>0.1.1</td>
<td>2024-04-17</td>
<td>@bossjones</td>
<td>Added testing strategy and error handling</td>
</tr>
</tbody>
</table>
<h2 id="development-guidelines">Development Guidelines<a class="headerlink" href="#development-guidelines" title="Permanent link">¶</a></h2>
<h3 id="code-style-guidelines">Code Style Guidelines<a class="headerlink" href="#code-style-guidelines" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Formatting and Linting</span>
<span class="o">-</span> <span class="n">All</span> <span class="n">code</span> <span class="ow">is</span> <span class="n">formatted</span> <span class="n">using</span> <span class="n">ruff</span>
<span class="o">-</span> <span class="n">Maximum</span> <span class="n">line</span> <span class="n">length</span><span class="p">:</span> <span class="mi">88</span> <span class="n">characters</span> <span class="p">(</span><span class="n">ruff</span> <span class="n">default</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Use</span> <span class="nb">type</span> <span class="n">hints</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">functions</span> <span class="ow">and</span> <span class="n">variables</span>
<span class="o">-</span> <span class="n">Follow</span> <span class="n">Google</span> <span class="n">docstring</span> <span class="nb">format</span>
<span class="o">-</span> <span class="n">Use</span> <span class="n">absolute</span> <span class="n">imports</span> <span class="p">(</span><span class="n">configured</span> <span class="ow">in</span> <span class="n">VSCode</span> <span class="n">settings</span><span class="p">)</span>

<span class="c1"># VSCode Configuration</span>
<span class="o">-</span> <span class="n">Format</span> <span class="n">on</span> <span class="n">save</span> <span class="n">enabled</span>
<span class="o">-</span> <span class="n">Ruff</span> <span class="k">as</span> <span class="n">default</span> <span class="n">formatter</span>
<span class="o">-</span> <span class="n">Pylance</span> <span class="k">as</span> <span class="n">language</span> <span class="n">server</span>
<span class="o">-</span> <span class="n">Semantic</span> <span class="n">highlighting</span> <span class="n">enabled</span>
<span class="o">-</span> <span class="n">Inlay</span> <span class="n">hints</span> <span class="k">for</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">Variable</span> <span class="n">types</span>
  <span class="o">*</span> <span class="n">Function</span> <span class="k">return</span> <span class="n">types</span>
  <span class="o">*</span> <span class="n">Pytest</span> <span class="n">parameters</span>

<span class="c1"># Error Checking</span>
<span class="o">-</span> <span class="n">Pylint</span> <span class="n">configuration</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">Enable</span><span class="p">:</span> <span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">E1101</span> <span class="p">(</span><span class="n">errors</span> <span class="ow">and</span> <span class="nb">type</span> <span class="n">checking</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">Disable</span><span class="p">:</span> <span class="n">C0111</span><span class="p">,</span><span class="n">E0401</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">E1205</span> <span class="p">(</span><span class="n">style</span> <span class="ow">and</span> <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">Max</span> <span class="n">line</span> <span class="n">length</span><span class="p">:</span> <span class="mi">120</span>
  <span class="o">*</span> <span class="n">Plugins</span><span class="p">:</span> <span class="n">pylint_pydantic</span><span class="p">,</span> <span class="n">pylint_per_file_ignores</span>

<span class="c1"># Type Checking</span>
<span class="o">-</span> <span class="n">Use</span> <span class="n">Pylance</span><span class="o">/</span><span class="n">Pyright</span> <span class="k">for</span> <span class="nb">type</span> <span class="n">checking</span>
<span class="o">-</span> <span class="n">Strict</span> <span class="nb">type</span> <span class="n">checking</span> <span class="n">enabled</span>
<span class="o">-</span> <span class="n">Report</span> <span class="n">missing</span> <span class="n">imports</span> <span class="k">as</span> <span class="n">errors</span>
<span class="o">-</span> <span class="n">Report</span> <span class="kn">import</span><span class="w"> </span><span class="nn">cycles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">errors</span>
</code></pre></div>
<h3 id="git-workflow">Git Workflow<a class="headerlink" href="#git-workflow" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Branching Strategy</span>
-<span class="w"> </span>Main<span class="w"> </span>branch:<span class="w"> </span><span class="sb">`</span>main<span class="sb">`</span><span class="w"> </span><span class="o">(</span>protected,<span class="w"> </span>represents<span class="w"> </span>production-ready<span class="w"> </span>code<span class="o">)</span>
-<span class="w"> </span>Development<span class="w"> </span>branches:<span class="w"> </span>Use<span class="w"> </span>feature<span class="w"> </span>branches<span class="w"> </span>based<span class="w"> </span>off<span class="w"> </span><span class="sb">`</span>main<span class="sb">`</span>.
-<span class="w"> </span>Branch<span class="w"> </span>Naming<span class="w"> </span>Conventions:
<span class="w">  </span>-<span class="w"> </span><span class="sb">`</span>feature/&lt;short-description&gt;<span class="sb">`</span>:<span class="w"> </span>For<span class="w"> </span>new<span class="w"> </span>features
<span class="w">  </span>-<span class="w"> </span><span class="sb">`</span>bugfix/&lt;short-description&gt;<span class="sb">`</span>:<span class="w"> </span>For<span class="w"> </span>bug<span class="w"> </span>fixes
<span class="w">  </span>-<span class="w"> </span><span class="sb">`</span>hotfix/&lt;short-description&gt;<span class="sb">`</span>:<span class="w"> </span>For<span class="w"> </span>critical<span class="w"> </span>production<span class="w"> </span>fixes<span class="w"> </span><span class="o">(</span>branch<span class="w"> </span>off<span class="w"> </span><span class="sb">`</span>main<span class="sb">`</span><span class="w"> </span>or<span class="w"> </span>release<span class="w"> </span>tags<span class="o">)</span>
<span class="w">  </span>-<span class="w"> </span><span class="sb">`</span>chore/&lt;short-description&gt;<span class="sb">`</span>:<span class="w"> </span>For<span class="w"> </span>maintenance<span class="w"> </span>tasks

<span class="c1"># Commit Messages (Conventional Commits)</span>
-<span class="w"> </span>Use<span class="w"> </span>commitizen<span class="w"> </span><span class="k">for</span><span class="w"> </span>structured<span class="w"> </span>commit<span class="w"> </span>messages:<span class="w"> </span><span class="sb">`</span>&lt;type&gt;<span class="o">(</span>&lt;scope&gt;<span class="o">)</span>:<span class="w"> </span>&lt;description&gt;<span class="sb">`</span>
-<span class="w"> </span>Types:<span class="w"> </span><span class="sb">`</span>feat<span class="sb">`</span>,<span class="w"> </span><span class="sb">`</span>fix<span class="sb">`</span>,<span class="w"> </span><span class="sb">`</span>docs<span class="sb">`</span>,<span class="w"> </span><span class="sb">`</span>style<span class="sb">`</span>,<span class="w"> </span><span class="sb">`</span>refactor<span class="sb">`</span>,<span class="w"> </span><span class="sb">`</span><span class="nb">test</span><span class="sb">`</span>,<span class="w"> </span><span class="sb">`</span>chore<span class="sb">`</span>
-<span class="w"> </span>Example:<span class="w"> </span><span class="sb">`</span>feat<span class="o">(</span>download<span class="o">)</span>:<span class="w"> </span>add<span class="w"> </span>Twitter<span class="w"> </span>video<span class="w"> </span>support<span class="sb">`</span>
</code></pre></div>
<h3 id="versioning-scheme">Versioning Scheme<a class="headerlink" href="#versioning-scheme" title="Permanent link">¶</a></h3>
<ul>
<li>Semantic Versioning (SemVer) 2.0.0 is used.</li>
<li>Version numbers are managed automatically using <code>commitizen</code> based on conventional commit messages.</li>
</ul>
<h3 id="release-process">Release Process<a class="headerlink" href="#release-process" title="Permanent link">¶</a></h3>
<ul>
<li>Releases are automated via GitHub Actions (see <code>.github/workflows/release.yml</code>).</li>
<li><code>commitizen</code> bumps the version number and generates the changelog based on commits since the last tag.</li>
<li>GitHub CLI (<code>gh</code>) is used to create GitHub releases.</li>
<li>New versions are tagged in Git (e.g., <code>v1.2.3</code>).</li>
</ul>
<h3 id="feature-flag-strategy">Feature Flag Strategy<a class="headerlink" href="#feature-flag-strategy" title="Permanent link">¶</a></h3>
<ul>
<li>Feature flags are managed using environment variables.</li>
<li>The <code>pydantic-settings</code> library is used to load and validate these environment variables, allowing features to be toggled on or off without code changes.</li>
<li>Example: An environment variable like <code>BOSS_BOT_ENABLE_EXPERIMENTAL_DOWNLOADER=true</code> could enable a new feature.</li>
</ul>
<h2 id="file-management">File Management<a class="headerlink" href="#file-management" title="Permanent link">¶</a></h2>
<h3 id="storage-structure">Storage Structure<a class="headerlink" href="#storage-structure" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code>/tmp/boss-bot/
├── downloads/                    # Organized downloads
│   ├── {guild_id}/              # Per-guild storage
│   │   ├── {yyyy-mm-dd}/        # Date-based organization
│   │   │   ├── {download_id}/   # Individual download
│   │   │   │   ├── metadata.json # Download metadata
│   │   │   │   └── content/     # Downloaded files
│   │   │   └── .cleanup         # Cleanup marker
│   │   └── .stats              # Guild statistics
│   └── .maintenance            # Maintenance logs
├── temp/                       # Temporary storage
│   └── {download_id}/         # In-progress downloads
└── .locks/                    # Lock files
</code></pre></div>
<h3 id="file-naming-conventions">File Naming Conventions<a class="headerlink" href="#file-naming-conventions" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileNaming</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""File naming conventions."""</span>
    <span class="n">DOWNLOAD_FILE</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{timestamp}</span><span class="s2">_</span><span class="si">{original_name}</span><span class="s2">"</span>  <span class="c1"># e.g., 20240417_123456_video.mp4</span>
    <span class="n">TEMP_FILE</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{download_id}</span><span class="s2">_</span><span class="si">{timestamp}</span><span class="s2">_temp"</span>   <span class="c1"># e.g., abc123_20240417_123456_temp</span>
    <span class="n">LOG_FILE</span> <span class="o">=</span> <span class="s2">"boss-bot_</span><span class="si">{date}</span><span class="s2">.log"</span>              <span class="c1"># e.g., boss-bot_20240417.log</span>
    <span class="n">METADATA_FILE</span> <span class="o">=</span> <span class="s2">"metadata.json"</span>               <span class="c1"># Standard name for all metadata files</span>
</code></pre></div>
<h3 id="storage-policies">Storage Policies<a class="headerlink" href="#storage-policies" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StoragePolicy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Storage management policies."""</span>
    <span class="c1"># Size Limits</span>
    <span class="n">MAX_FILE_SIZE</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 50MB (Discord limit)</span>
    <span class="n">MAX_TEMP_STORAGE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 1GB</span>
    <span class="n">MAX_GUILD_DAILY</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 500MB per guild per day</span>

    <span class="c1"># Retention Periods (in seconds)</span>
    <span class="n">TEMP_FILE_RETENTION</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># 1 hour</span>
    <span class="n">SUCCESSFUL_DOWNLOAD</span> <span class="o">=</span> <span class="mi">86400</span>  <span class="c1"># 24 hours</span>
    <span class="n">FAILED_DOWNLOAD</span> <span class="o">=</span> <span class="mi">21600</span>  <span class="c1"># 6 hours</span>

    <span class="c1"># Cleanup Intervals</span>
    <span class="n">TEMP_SCAN_INTERVAL</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes</span>
    <span class="n">MAIN_SCAN_INTERVAL</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># 1 hour</span>
</code></pre></div>
<h3 id="file-operations">File Operations<a class="headerlink" href="#file-operations" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiofiles</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_download</span><span class="p">(</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
    <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">download_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">original_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Save downloaded content with metadata."""</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S"</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s2">"</span>

    <span class="c1"># Create directory structure</span>
    <span class="n">download_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"/tmp/boss-bot/downloads/</span><span class="si">{</span><span class="n">guild_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">timestamp</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">download_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">download_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Save content</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">download_dir</span> <span class="o">/</span> <span class="s2">"content"</span> <span class="o">/</span> <span class="n">filename</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="c1"># Save metadata</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"original_name"</span><span class="p">:</span> <span class="n">original_name</span><span class="p">,</span>
        <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
        <span class="s2">"size"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
        <span class="s2">"download_id"</span><span class="p">:</span> <span class="n">download_id</span>
    <span class="p">}</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">download_dir</span> <span class="o">/</span> <span class="s2">"metadata.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">file_path</span>
</code></pre></div>
<h3 id="cleanup-strategy">Cleanup Strategy<a class="headerlink" href="#cleanup-strategy" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CleanupManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Manages file cleanup operations."""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_temp_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Clean temporary files older than retention period."""</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"/tmp/boss-bot/temp"</span><span class="p">)</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="n">age</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span>
                <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">StoragePolicy</span><span class="o">.</span><span class="n">TEMP_FILE_RETENTION</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_downloads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Clean old downloads based on retention policy."""</span>
        <span class="n">downloads_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"/tmp/boss-bot/downloads"</span><span class="p">)</span>
        <span class="c1"># Implementation details...</span>
</code></pre></div>
<h2 id="command-system">Command System<a class="headerlink" href="#command-system" title="Permanent link">¶</a></h2>
<h3 id="command-structure">Command Structure<a class="headerlink" href="#command-structure" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Permissions</th>
<th>Rate Limit</th>
<th>Cooldown</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/download &lt;url&gt;</code></td>
<td>Download media from supported platforms</td>
<td><code>send_messages</code></td>
<td>5/minute</td>
<td>10s</td>
</tr>
<tr>
<td><code>/queue list</code></td>
<td>Show current download queue</td>
<td><code>send_messages</code></td>
<td>10/minute</td>
<td>5s</td>
</tr>
<tr>
<td><code>/queue clear</code></td>
<td>Clear download queue</td>
<td><code>manage_messages</code></td>
<td>2/minute</td>
<td>30s</td>
</tr>
<tr>
<td><code>/settings view</code></td>
<td>View guild settings</td>
<td><code>send_messages</code></td>
<td>10/minute</td>
<td>5s</td>
</tr>
<tr>
<td><code>/settings update</code></td>
<td>Update guild settings</td>
<td><code>manage_guild</code></td>
<td>5/minute</td>
<td>15s</td>
</tr>
<tr>
<td><code>/stats</code></td>
<td>View download statistics</td>
<td><code>send_messages</code></td>
<td>10/minute</td>
<td>5s</td>
</tr>
</tbody>
</table>
<h3 id="command-implementation">Command Implementation<a class="headerlink" href="#command-implementation" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">discord</span><span class="w"> </span><span class="kn">import</span> <span class="n">app_commands</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">discord.ext</span><span class="w"> </span><span class="kn">import</span> <span class="n">commands</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadCog</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">Cog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download command implementation."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cd</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">CooldownMapping</span><span class="o">.</span><span class="n">from_cooldown</span><span class="p">(</span>
            <span class="mi">5</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">commands</span><span class="o">.</span><span class="n">BucketType</span><span class="o">.</span><span class="n">user</span>
        <span class="p">)</span>

    <span class="nd">@app_commands</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"download"</span><span class="p">)</span>
    <span class="nd">@app_commands</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">"URL to download from"</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">interaction</span><span class="p">:</span> <span class="n">discord</span><span class="o">.</span><span class="n">Interaction</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Download media from supported platforms."""</span>
        <span class="c1"># Check cooldown</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cd</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>
        <span class="n">retry_after</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">update_rate_limit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">retry_after</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">commands</span><span class="o">.</span><span class="n">CommandOnCooldown</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">retry_after</span><span class="p">)</span>

        <span class="c1"># Validate URL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_supported_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">interaction</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="s2">"❌ URL not supported"</span><span class="p">,</span>
                <span class="n">ephemeral</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Queue download</span>
        <span class="n">download_id</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_download</span><span class="p">(</span><span class="n">interaction</span><span class="o">.</span><span class="n">guild_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">interaction</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"✅ Download queued! ID: `</span><span class="si">{</span><span class="n">download_id</span><span class="si">}</span><span class="s2">`"</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="permission-system">Permission System<a class="headerlink" href="#permission-system" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Set</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BotPermission</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Bot-specific permissions."""</span>
    <span class="n">DOWNLOAD</span> <span class="o">=</span> <span class="s2">"download"</span>
    <span class="n">MANAGE_QUEUE</span> <span class="o">=</span> <span class="s2">"manage_queue"</span>
    <span class="n">MANAGE_SETTINGS</span> <span class="o">=</span> <span class="s2">"manage_settings"</span>
    <span class="n">VIEW_STATS</span> <span class="o">=</span> <span class="s2">"view_stats"</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PermissionManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Manages bot permissions."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role_permissions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">BotPermission</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">has_permission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">member</span><span class="p">:</span> <span class="n">discord</span><span class="o">.</span><span class="n">Member</span><span class="p">,</span>
        <span class="n">permission</span><span class="p">:</span> <span class="n">BotPermission</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check if member has required permission."""</span>
        <span class="c1"># Bot owner always has permission</span>
        <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">is_owner</span><span class="p">(</span><span class="n">member</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Check Discord permissions</span>
        <span class="k">if</span> <span class="n">permission</span> <span class="o">==</span> <span class="n">BotPermission</span><span class="o">.</span><span class="n">MANAGE_SETTINGS</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="n">guild_permissions</span><span class="o">.</span><span class="n">manage_guild</span>

        <span class="k">if</span> <span class="n">permission</span> <span class="o">==</span> <span class="n">BotPermission</span><span class="o">.</span><span class="n">MANAGE_QUEUE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="n">guild_permissions</span><span class="o">.</span><span class="n">manage_messages</span>

        <span class="c1"># Check role-based permissions</span>
        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">member</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_permissions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<h3 id="rate-limiting">Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RateLimiter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Rate limit implementation."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_rate_limit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_requests</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">time_window</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Check if request is rate limited.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: Unique identifier (e.g., user_id or guild_id)</span>
<span class="sd">            max_requests: Maximum requests allowed</span>
<span class="sd">            time_window: Time window in seconds</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (is_limited, retry_after)</span>
<span class="sd">        """</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">window_start</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">time_window</span><span class="p">)</span>

        <span class="c1"># Clean old entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ts</span> <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="n">window_start</span>
        <span class="p">]</span>

        <span class="c1"># Check limit</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">max_requests</span><span class="p">:</span>
            <span class="n">retry_after</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">window_start</span>
            <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">retry_after</span>

        <span class="c1"># Add new timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>
<h2 id="queue-management">Queue Management<a class="headerlink" href="#queue-management" title="Permanent link">¶</a></h2>
<h3 id="queue-structure">Queue Structure<a class="headerlink" href="#queue-structure" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download status states."""</span>
    <span class="n">QUEUED</span> <span class="o">=</span> <span class="s2">"queued"</span>
    <span class="n">PROCESSING</span> <span class="o">=</span> <span class="s2">"processing"</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">"completed"</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">"failed"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QueueItem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Represents a queued download."""</span>
    <span class="n">download_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">channel_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DownloadStatus</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">started_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">completed_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="queue-manager">Queue Manager<a class="headerlink" href="#queue-manager" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">Queue</span><span class="p">,</span> <span class="n">Lock</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QueueManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Manages download queues per guild."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent</span> <span class="o">=</span> <span class="n">max_concurrent_downloads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Queue</span><span class="p">[</span><span class="n">QueueItem</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Queue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Lock</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Lock</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_to_queue</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">channel_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueueItem</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Add a new download to the queue."""</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">QueueItem</span><span class="p">(</span>
            <span class="n">download_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(),</span>
            <span class="n">guild_id</span><span class="o">=</span><span class="n">guild_id</span><span class="p">,</span>
            <span class="n">channel_id</span><span class="o">=</span><span class="n">channel_id</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">DownloadStatus</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Process queued downloads for a guild."""</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">[</span><span class="n">guild_id</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">[</span><span class="n">guild_id</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">download_id</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">DownloadStatus</span><span class="o">.</span><span class="n">PROCESSING</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">started_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

                    <span class="c1"># Process download</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_download</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                    <span class="n">item</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">DownloadStatus</span><span class="o">.</span><span class="n">COMPLETED</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">DownloadStatus</span><span class="o">.</span><span class="n">FAILED</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">completed_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">download_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">guild_id</span><span class="p">]</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</code></pre></div>
<h3 id="queue-storage">Queue Storage<a class="headerlink" href="#queue-storage" title="Permanent link">¶</a></h3>
<p>The queue state is persisted in Redis to maintain queue order and state across bot restarts:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aioredis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QueueStorage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Persistent queue storage using Redis."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">aioredis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">redis_url</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_queue_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">QueueItem</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Save queue item to Redis."""</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"queue:</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">guild_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">download_id</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hmset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"queue:</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">guild_id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">{</span><span class="n">item</span><span class="o">.</span><span class="n">download_id</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()}</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_queue_items</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DownloadStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">QueueItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get all queue items for a guild."""</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">download_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span><span class="sa">f</span><span class="s2">"queue:</span><span class="si">{</span><span class="n">guild_id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">download_id</span> <span class="ow">in</span> <span class="n">download_ids</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"queue:</span><span class="si">{</span><span class="n">guild_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">download_id</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">item</span> <span class="o">=</span> <span class="n">QueueItem</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">items</span>
</code></pre></div>
<h2 id="bot-initialization-and-core-services">Bot Initialization and Core Services<a class="headerlink" href="#bot-initialization-and-core-services" title="Permanent link">¶</a></h2>
<h3 id="bot-initialization-sequence">Bot Initialization Sequence<a class="headerlink" href="#bot-initialization-sequence" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">discord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">discord.ext</span><span class="w"> </span><span class="kn">import</span> <span class="n">commands</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BossBot</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">Bot</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">intents</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">Intents</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
        <span class="n">intents</span><span class="o">.</span><span class="n">message_content</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">command_prefix</span><span class="o">=</span><span class="s2">"$"</span><span class="p">,</span>
            <span class="n">intents</span><span class="o">=</span><span class="n">intents</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Boss-Bot: A Discord Media Download Assistant"</span>
        <span class="p">)</span>

        <span class="c1"># Initialize services</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span> <span class="o">=</span> <span class="n">QueueManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_manager</span> <span class="o">=</span> <span class="n">DownloadManager</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Initialize services and load extensions"""</span>
        <span class="c1"># Load command extensions</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="s2">"boss_bot.cogs.downloads"</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="s2">"boss_bot.cogs.queue"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Called when bot is ready and connected"""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Logged in as </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s1"> (ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">)'</span><span class="p">)</span>
</code></pre></div>
<h3 id="core-services">Core Services<a class="headerlink" href="#core-services" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Discord Connection Service</strong></li>
<li>
<p>Utilizes discord.py v2.5.2's built-in features:</p>
<ul>
<li>Automatic reconnection handling</li>
<li>Exponential backoff for reconnection attempts</li>
<li>Shard management (if needed)</li>
<li>Rate limit handling</li>
</ul>
</li>
<li>
<p><strong>Download Manager Service</strong></p>
</li>
<li>Leverages existing tools:<ul>
<li>gallery-dl: Image/media downloads with built-in retry mechanism</li>
<li>yt-dlp: Video downloads with built-in retry mechanism</li>
</ul>
</li>
<li>
<p>Responsibilities:</p>
<ul>
<li>Platform detection and routing</li>
<li>Download progress tracking</li>
<li>Error handling and reporting</li>
</ul>
</li>
<li>
<p><strong>Queue Management Service</strong>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">QUEUED</span> <span class="o">=</span> <span class="s2">"queued"</span>
    <span class="n">DOWNLOADING</span> <span class="o">=</span> <span class="s2">"downloading"</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">"completed"</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">"failed"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QueueItem</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">channel_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DownloadStatus</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QueueManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_concurrent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">[</span><span class="n">QueueItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueueItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent</span> <span class="o">=</span> <span class="n">max_concurrent</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">QueueItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_next_download</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">QueueItem</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_downloads</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Command System</strong></p>
</li>
<li>Implements discord.py's commands extension</li>
<li>Supports both slash commands and prefix commands</li>
<li>Includes permission handling and rate limiting</li>
<li>Command categories:<ul>
<li>Download commands</li>
<li>Queue management</li>
<li>Status and information</li>
</ul>
</li>
</ol>
<h3 id="error-handling-strategy_1">Error Handling Strategy<a class="headerlink" href="#error-handling-strategy_1" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@bot</span><span class="o">.</span><span class="n">event</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_error</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Global error handler for all events"""</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error in </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">error</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_app_command_error</span><span class="p">(</span>
    <span class="n">interaction</span><span class="p">:</span> <span class="n">discord</span><span class="o">.</span><span class="n">Interaction</span><span class="p">,</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">app_commands</span><span class="o">.</span><span class="n">AppCommandError</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handle errors in application (slash) commands"""</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">app_commands</span><span class="o">.</span><span class="n">CommandOnCooldown</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">interaction</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"This command is on cooldown. Try again in </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">retry_after</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s"</span><span class="p">,</span>
            <span class="n">ephemeral</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Command error"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</code></pre></div>
<h3 id="supported-platforms-and-limitations">Supported Platforms and Limitations<a class="headerlink" href="#supported-platforms-and-limitations" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Media Sources</strong></li>
<li>Twitter/X (via gallery-dl)</li>
<li>Instagram (via gallery-dl)</li>
<li>Reddit (via gallery-dl)</li>
<li>YouTube (via yt-dlp)</li>
<li>
<p>TikTok (via yt-dlp)</p>
</li>
<li>
<p><strong>Download Capabilities</strong></p>
</li>
<li>Single media downloads</li>
<li>Playlist/album downloads</li>
<li>Thread/post downloads</li>
<li>
<p>Bulk download support</p>
</li>
<li>
<p><strong>Limitations</strong></p>
</li>
<li>Discord file size limit: 25MB (or 100MB with nitro)</li>
<li>Maximum concurrent downloads: 3</li>
<li>Rate limits per platform</li>
<li>Queue size limit: 50 items</li>
</ol>
<h2 id="data-management">Data Management<a class="headerlink" href="#data-management" title="Permanent link">¶</a></h2>
<h3 id="redis-configuration">Redis Configuration<a class="headerlink" href="#redis-configuration" title="Permanent link">¶</a></h3>
<ul>
<li>Redis 6.2.10 via docker-compose</li>
<li>Port: 7600</li>
<li>Persistent storage via Docker volume: boss_redis_data</li>
<li>Health checks enabled</li>
<li>No authentication in development (controlled access)</li>
</ul>
<h3 id="data-retention-policies">Data Retention Policies<a class="headerlink" href="#data-retention-policies" title="Permanent link">¶</a></h3>
<h4 id="downloaded-media">Downloaded Media<a class="headerlink" href="#downloaded-media" title="Permanent link">¶</a></h4>
<ul>
<li>Location: /tmp/boss-bot/downloads/{guild_id}/{yyyy-mm-dd}/</li>
<li>Retention Period: 24 hours from download completion</li>
<li>Cleanup: Automatic removal after retention period</li>
<li>Storage Strategy: Date-based organization per guild</li>
<li>Exception: Failed downloads removed after 6 hours</li>
</ul>
<h4 id="queue-data-redis">Queue Data (Redis)<a class="headerlink" href="#queue-data-redis" title="Permanent link">¶</a></h4>
<ul>
<li>Active Queue: Real-time queue state</li>
<li>Queue History:</li>
<li>Completed downloads: 24 hours</li>
<li>Failed downloads: 48 hours for debugging</li>
<li>Cancelled downloads: 12 hours</li>
<li>Queue Metrics: 7 days rolling window</li>
</ul>
<h4 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">¶</a></h4>
<ul>
<li>Primary Output: stdout via Loguru</li>
<li>Log Format: Structured JSON</li>
<li>Log Levels: INFO and above for stdout, ERROR for stderr</li>
<li>Retention: Managed by system log rotation</li>
<li>No persistent log storage needed</li>
</ul>
<h3 id="data-storage-structure">Data Storage Structure<a class="headerlink" href="#data-storage-structure" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code>/tmp/boss-bot/
├── downloads/                    # Temporary media storage
│   ├── {guild_id}/              # Per-guild organization
│   │   ├── {yyyy-mm-dd}/        # Date-based structure
│   │   │   ├── {download_id}/   # Individual downloads
│   │   │   │   ├── metadata.json # Download metadata
│   │   │   │   └── content/     # Media files
│   │   │   └── .cleanup         # Cleanup marker
│   └── .maintenance            # Maintenance logs
└── temp/                       # In-progress downloads
    └── {download_id}/         # Temporary processing
</code></pre></div>
<h2 id="monitoring-observability">Monitoring &amp; Observability<a class="headerlink" href="#monitoring-observability" title="Permanent link">¶</a></h2>
<p>Monitoring and observability are crucial for maintaining the health and performance of the system. These features can be feature-flagged for future implementation.</p>
<h3 id="monitoring-metrics-definition">Monitoring Metrics Definition<a class="headerlink" href="#monitoring-metrics-definition" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Request Rate</strong>: Number of requests per second</li>
<li><strong>Error Rate</strong>: Percentage of failed requests</li>
<li><strong>Resource Utilization</strong>: CPU, memory, and disk usage</li>
<li><strong>Queue Length</strong>: Number of items in the download queue</li>
</ul>
<h3 id="alerting-thresholds">Alerting Thresholds<a class="headerlink" href="#alerting-thresholds" title="Permanent link">¶</a></h3>
<ul>
<li><strong>High Error Rate</strong>: Alert if error rate exceeds 5%</li>
<li><strong>High CPU Usage</strong>: Alert if CPU usage exceeds 80%</li>
<li><strong>Long Queue Length</strong>: Alert if queue length exceeds 50 items</li>
</ul>
<h3 id="logging-levels-and-retention">Logging Levels and Retention<a class="headerlink" href="#logging-levels-and-retention" title="Permanent link">¶</a></h3>
<ul>
<li><strong>INFO</strong>: General operational information</li>
<li><strong>WARN</strong>: Non-critical issues that require attention</li>
<li><strong>ERROR</strong>: Critical issues that need immediate action</li>
<li><strong>Retention</strong>: Logs retained for 30 days</li>
</ul>
<h3 id="performance-monitoring">Performance Monitoring<a class="headerlink" href="#performance-monitoring" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Response Time</strong>: Track average and peak response times</li>
<li><strong>Throughput</strong>: Measure data processed per second</li>
<li><strong>Latency</strong>: Monitor delays in processing requests</li>
</ul>
<h3 id="health-check-endpoints">Health Check Endpoints<a class="headerlink" href="#health-check-endpoints" title="Permanent link">¶</a></h3>
<ul>
<li><strong>/health</strong>: Basic health check for the application</li>
<li><strong>/metrics</strong>: Expose application metrics for monitoring tools</li>
</ul>
<h3 id="dashboard-requirements">Dashboard Requirements<a class="headerlink" href="#dashboard-requirements" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Visualization</strong>: Graphs for request rates, error rates, and resource utilization</li>
<li><strong>Alerts</strong>: Real-time alerts for threshold breaches</li>
<li><strong>Historical Data</strong>: Access to historical performance data</li>
</ul>
<h2 id="performance-scaling-future-considerations">Performance &amp; Scaling (Future Considerations)<a class="headerlink" href="#performance-scaling-future-considerations" title="Permanent link">¶</a></h2>
<p>Current State: Basic queue management defined. Performance and scaling are considered nice-to-have features for future iterations.</p>
<p>Needed Additions:
- [ ] Define performance benchmarks for key operations (e.g., download speed, queue processing time).
- [ ] Establish scaling thresholds based on metrics like queue length, resource utilization, or request rate.
- [ ] Set clear resource utilization limits (CPU, memory, network) for the bot process.
- [ ] Design and implement a caching strategy for frequently accessed data or downloaded content (potentially using Redis or local cache).
- [ ] Develop guidelines for optimizing queue processing, potentially including priority adjustments, worker scaling, or task distribution.</p>
<h2 id="documentation-requirements">Documentation Requirements<a class="headerlink" href="#documentation-requirements" title="Permanent link">¶</a></h2>
<p>Current State: Basic structure provided</p>
<p>Needed Additions:
- [ ] API documentation standards
- [ ] Logging standards
- [ ] Contribution guidelines
- [ ] Development setup guide
- [ ] Deployment guide
- [ ] Troubleshooting guide</p>
<h2 id="github-workflow-for-documentation-deployment">GitHub Workflow for Documentation Deployment<a class="headerlink" href="#github-workflow-for-documentation-deployment" title="Permanent link">¶</a></h2>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docs-mkdocs-gh-deploy</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"docs/**"</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"mkdocs.yml"</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">".github/workflows/docs.yml"</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"Makefile.ci"</span>
<span class="w">  </span><span class="c1"># Allow manual triggering</span>
<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">debug_enabled</span><span class="p">:</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run the build with tmate debugging enabled (https://github.com/marketplace/actions/debugging-with-tmate)</span>
<span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
<span class="nt">concurrency</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cancel-in-progress</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">publish-workflow</span>

<span class="nt">permissions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Mkdocs ${{ matrix.os }} / Python ${{ matrix.python-version }}</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ubuntu-latest</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"3.12"</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.os }}</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">      </span><span class="nt">GH_PAGER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span>
<span class="w">      </span><span class="nt">UV_NO_PROMPT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">UV_PROJECT_ENVIRONMENT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">SKIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">commitizen-branch</span><span class="w"> </span><span class="c1"># Skip commitizen checks for gh-pages</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">          </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure Git Credentials</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">git config user.name github-actions[bot]</span>
<span class="w">          </span><span class="no">git config user.email 41898282+github-actions[bot]@users.noreply.github.com</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set shell path</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">set-shell</span>
<span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">if [[ "$RUNNER_OS" == "macOS" ]]; then</span>
<span class="w">            </span><span class="no">echo "SHELL_PATH=/opt/homebrew/bin/zsh" &gt;&gt; $GITHUB_ENV</span>
<span class="w">          </span><span class="no">else</span>
<span class="w">            </span><span class="no">echo "SHELL_PATH=/bin/bash" &gt;&gt; $GITHUB_ENV</span>
<span class="w">          </span><span class="no">fi</span>
<span class="w">          </span><span class="no">echo "Shell path set to: $SHELL_PATH"</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install UV</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">astral-sh/setup-uv@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">enable-cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">"0.6.11"</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Python ${{ matrix.python-version }}</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.python-version }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup debug tmate session</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mxschmitt/action-tmate@v3</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event_name == 'workflow_dispatch' &amp;&amp; github.event.inputs.debug_enabled == 'true' }}</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">limit-access-to-actor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install additional macos dependencies zsh etc</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">sudo apt-get update</span>
<span class="w">          </span><span class="no">sudo apt-get install zsh -y</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Sync dependencies with UV</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uv sync --dev</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Display environment information</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">make -f Makefile.ci env-info</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">make -f Makefile.ci ci-install</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build mkdocs documentation site</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">uv run mkdocs build</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy mkdocs</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">touch .nojekyll</span>
<span class="w">          </span><span class="no">uv run mkdocs gh-deploy --force --message 'docs(mkdocs): update documentation [skip ci]'</span>
</code></pre></div>
<hr/>
<h1 id="file-defered-stories-defered-story-1-story-md">.ai/defered-stories/defered-story-1.story.md</h1>
<?xml version="1.0" encoding="UTF-8"?>
<p><document></document></p>
<p><section-documentation>
<task-group-documentation>
<section-cicd>
<task-group-cicd>
<section-diagrams>
<section-command-log>
<subsection-deferral-rationale>
<subsection-test-results>
<subsection-priority-tasks></subsection-priority-tasks></subsection-test-results></subsection-deferral-rationale></section-command-log></section-diagrams></task-group-cicd></section-cicd></task-group-documentation></section-documentation></p>
<p></p>
<hr/>
<h1 id="file-diagrams-module-fixtures-current-md">.ai/diagrams/module-fixtures-current.md</h1>
<h1 id="pytest-fixtures-current-state-class-diagram">Pytest Fixtures Current State - Class Diagram<a class="headerlink" href="#pytest-fixtures-current-state-class-diagram" title="Permanent link">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>Shows the current state of pytest fixtures in the project, highlighting duplications and potential conflicts.</p>
<h2 id="source">Source<a class="headerlink" href="#source" title="Permanent link">¶</a></h2>
<ul>
<li>tests/conftest.py</li>
<li>tests/test_bot/test_help.py</li>
<li>tests/test_bot/test_download_cog.py</li>
<li>tests/test_downloaders/test_base.py</li>
<li>tests/test_core/test_queue_manager.py</li>
<li>tests/test_bot/test_cogs/test_downloads.py</li>
</ul>
<h2 id="diagram">Diagram<a class="headerlink" href="#diagram" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>classDiagram
    class Fixture {
        &lt;<interface>&gt;
        +name: str
        +scope: str
        +file: str
    }

    class bot {
        +scope: function
        +file: conftest.py
        +description: "Test bot instance with mocked Discord.py methods"
    }

    class bot_duplicate {
        +scope: function
        +file: test_download_cog.py
        +description: "Create a bot instance for testing"
    }

    class mock_bot {
        +scope: function
        +file: test_downloads.py
        +description: "Create a mocked bot instance"
    }

    class ctx {
        +scope: function
        +file: conftest.py
        +description: "Mock Discord context for testing"
    }

    class queue_manager {
        +scope: function
        +file: conftest.py
        +description: "Test queue manager instance"
    }

    class queue_manager_duplicate {
        +scope: function
        +file: test_queue_manager.py
        +description: "Create a queue manager instance for testing"
    }

    class download_manager {
        +scope: function
        +file: conftest.py
        +description: "Test download manager instance"
    }

    class download_manager_duplicate {
        +scope: function
        +file: test_base.py
        +description: "Create a download manager instance for testing"
    }

    class help_command {
        +scope: function
        +file: test_help.py
        +description: "Help command instance for testing"
    }

    class cog {
        +scope: function
        +file: test_downloads.py
        +description: "Downloads cog instance for testing"
    }

    Fixture &lt;|-- bot
    Fixture &lt;|-- bot_duplicate
    Fixture &lt;|-- mock_bot
    Fixture &lt;|-- ctx
    Fixture &lt;|-- queue_manager
    Fixture &lt;|-- queue_manager_duplicate
    Fixture &lt;|-- download_manager
    Fixture &lt;|-- download_manager_duplicate
    Fixture &lt;|-- help_command
    Fixture &lt;|-- cog

    bot &lt;-- help_command : depends on
    bot &lt;-- ctx : depends on
    mock_bot &lt;-- cog : depends on
    bot .. bot_duplicate : conflicts with
    bot .. mock_bot : similar to
    queue_manager .. queue_manager_duplicate : conflicts with
    download_manager .. download_manager_duplicate : conflicts with
</interface></code></pre>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">¶</a></h2>
<ol>
<li>Red flags identified:</li>
<li><code>bot</code> fixture is duplicated in test_download_cog.py</li>
<li><code>queue_manager</code> fixture is duplicated in test_queue_manager.py</li>
<li><code>download_manager</code> fixture is duplicated in test_base.py</li>
<li><code>mock_bot</code> is similar to <code>bot</code> but with a different name</li>
<li>Potential issues:</li>
<li>Inconsistent fixture behavior across tests</li>
<li>Risk of fixture state bleeding between tests</li>
<li>Maintenance overhead from duplicate code</li>
<li>Unclear which fixture version should be used</li>
</ol>
<hr/>
<h1 id="file-diagrams-module-fixtures-recommended-md">.ai/diagrams/module-fixtures-recommended.md</h1>
<h1 id="pytest-fixtures-recommended-state-class-diagram">Pytest Fixtures Recommended State - Class Diagram<a class="headerlink" href="#pytest-fixtures-recommended-state-class-diagram" title="Permanent link">¶</a></h1>
<h2 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link">¶</a></h2>
<p>Shows the recommended state of pytest fixtures after consolidation and proper organization.</p>
<h2 id="source_1">Source<a class="headerlink" href="#source_1" title="Permanent link">¶</a></h2>
<p>Based on analysis of current fixtures in:
- tests/conftest.py
- tests/test_bot/test_help.py
- tests/test_bot/test_download_cog.py
- tests/test_downloaders/test_base.py
- tests/test_core/test_queue_manager.py
- tests/test_bot/test_cogs/test_downloads.py</p>
<h2 id="diagram_1">Diagram<a class="headerlink" href="#diagram_1" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>classDiagram
    class Fixture {
        &lt;<interface>&gt;
        +name: str
        +scope: str
        +file: str
    }

    class bot {
        +scope: function
        +file: conftest.py
        +description: "Test bot instance with mocked Discord.py methods"
        +is_mock: bool
        +configure_mock()
    }

    class ctx {
        +scope: function
        +file: conftest.py
        +description: "Mock Discord context for testing"
        +bot: Bot
    }

    class queue_manager {
        +scope: function
        +file: conftest.py
        +description: "Test queue manager instance"
        +reset_state()
    }

    class download_manager {
        +scope: function
        +file: conftest.py
        +description: "Test download manager instance"
        +reset_state()
    }

    class help_command {
        +scope: function
        +file: conftest.py
        +description: "Help command instance for testing"
        +bot: Bot
    }

    class cog {
        +scope: function
        +file: conftest.py
        +description: "Downloads cog instance for testing"
        +bot: Bot
        +download_manager: DownloadManager
    }

    class mock_env_vars {
        +scope: function
        +file: conftest.py
        +description: "Mock environment variables"
    }

    class mock_settings {
        +scope: function
        +file: conftest.py
        +description: "Standardized test settings"
    }

    Fixture &lt;|-- bot
    Fixture &lt;|-- ctx
    Fixture &lt;|-- queue_manager
    Fixture &lt;|-- download_manager
    Fixture &lt;|-- help_command
    Fixture &lt;|-- cog
    Fixture &lt;|-- mock_env_vars
    Fixture &lt;|-- mock_settings

    bot &lt;-- ctx : uses
    bot &lt;-- help_command : uses
    bot &lt;-- cog : uses
    download_manager &lt;-- cog : uses
    mock_settings &lt;-- bot : configures
    mock_env_vars &lt;-- mock_settings : uses

    note for bot "Consolidated bot fixture with mock configuration"
    note for queue_manager "Single source of truth in conftest.py"
    note for download_manager "Single source of truth in conftest.py"
</interface></code></pre>
<h2 id="notes_1">Notes<a class="headerlink" href="#notes_1" title="Permanent link">¶</a></h2>
<ol>
<li>Key improvements:</li>
<li>All fixtures consolidated in conftest.py</li>
<li>Clear dependency hierarchy</li>
<li>Consistent mocking strategy</li>
<li>State management with reset methods</li>
<li>
<p>Proper scope isolation</p>
</li>
<li>
<p>Implementation recommendations:</p>
</li>
<li>Move all fixture definitions to conftest.py</li>
<li>Add reset_state() methods to stateful fixtures</li>
<li>Use bot.is_mock flag to control mock behavior</li>
<li>Ensure proper cleanup between tests</li>
<li>
<p>Document fixture dependencies clearly</p>
</li>
<li>
<p>Migration steps:</p>
</li>
<li>Delete duplicate fixtures from individual test files</li>
<li>Update tests to use consolidated fixtures</li>
<li>Add proper teardown/cleanup in conftest.py</li>
<li>Add type hints and docstrings to all fixtures</li>
</ol>
<hr/>
<h1 id="file-diagrams-pytest_fixtures_relationships-mmd">.ai/diagrams/pytest_fixtures_relationships.mmd</h1>
<hr/>
<p>title: Pytest Fixtures Relationship Diagram
description: Shows the relationships, dependencies, and potential conflicts between pytest fixtures in the boss-bot project</p>
<hr/>
<p>erDiagram
    mock_env_vars_main ||--|| settings : "provides"
    mock_env_vars_main ||--|| mock_env_vars_core : "duplicates"
    mock_env_vars_main {
        string DISCORD_TOKEN
        string DISCORD_CLIENT_ID
        string scope "session"
        string file "conftest.py"
    }</p>
<div class="highlight"><pre><span></span><code>mock_env_vars_core {
    string DISCORD_TOKEN
    string DISCORD_CLIENT_ID
    string scope "function"
    string file "test_core/conftest.py"
}

settings ||--|| bot : "configures"
settings ||--|| queue_manager : "configures"
settings ||--|| download_manager : "configures"
settings {
    string discord_token
    string discord_client_id
    string scope "function"
    string file "conftest.py"
}

bot ||--|| ctx : "uses"
bot {
    string instance "BossBot"
    string scope "function"
    string file "conftest.py"
    string duplicate_1 "test_download_cog.py"
    string duplicate_2 "test_queue_cog.py"
}

mock_bot ||--|| cog : "provides"
mock_bot {
    string instance "Mock"
    string scope "function"
    string file "test_downloads.py"
}

queue_manager {
    int max_queue_size
    string scope "function"
    string file "conftest.py"
}

download_manager {
    int max_concurrent
    string scope "function"
    string file "conftest.py"
}

ctx {
    string instance "Mock"
    string scope "function"
    string file "conftest.py"
}

cog {
    string instance "DownloadCog"
    string scope "function"
    string file "test_downloads.py"
}

mock_env ||--|| mock_settings : "provides"
mock_env {
    string env_vars "dict"
    string scope "function"
    string file "test_env.py"
}
</code></pre></div>
<p>%% Notes about the diagram
%% mock_env_vars_main: Main environment fixture with session scope
%% mock_env_vars_core: Duplicate fixture with different scope
%% bot: Multiple implementations across test files</p>
<hr/>
<h1 id="file-prd-prd-md">.ai/prd/prd.md</h1>
<h1 id="title-prd-for-boss-bot-a-discord-media-download-and-rag-assistant">Title: PRD for Boss-Bot: A Discord Media Download and RAG Assistant<a class="headerlink" href="#title-prd-for-boss-bot-a-discord-media-download-and-rag-assistant" title="Permanent link">¶</a></h1>
<p><context>
Boss-Bot is designed to enhance Discord server productivity through media downloads and RAG features. The initial focus is on reliable media downloads from platforms like Twitter and Reddit, with a foundation for future AI capabilities.
</context></p>
<p><stakeholders>
- Product Owner: @bossjones
- Technical Lead: @bossjones
- Engineering Manager: @bossjones
</stakeholders></p>
<p><metrics>
- Uptime: &gt;99%
- Response Time: &lt;2s for command acknowledgment
- Download Queue Processing: &lt;5min per item
- Test Coverage (MVP):
  * Core Download: 30%
  * Command Parsing: 25%
  * Discord Events: 20%
  * File Management: 20%
</metrics></p>
<p><constraints>
- Python 3.11+ required (3.12 recommended)
- Maximum module size: 120 lines
- Discord file size limit: 50MB
- Maximum concurrent downloads: 5
- Queue size limit: 50 items
</constraints></p>
<p><assumptions>
- Users have basic Discord command knowledge
- Stable internet connection available
- Sufficient storage space for temporary files
- Discord API remains stable
- Gallery-dl continues to support target platforms
</assumptions></p>
<p><risks>
- Discord API changes could break functionality
- Target platforms may change their APIs
- Rate limiting could affect user experience
- Storage management could become complex
- Network issues could interrupt downloads
</risks></p>
<p><dependencies>
- Discord.py for bot framework
- Gallery-dl for media downloads
- UV for package management
- Pytest for testing infrastructure
- Ruff for code quality
</dependencies></p>
<p><version>1.0.0</version></p>
<h2 id="status-approved">Status: Approved<a class="headerlink" href="#status-approved" title="Permanent link">¶</a></h2>
<h2 id="approval">Approval<a class="headerlink" href="#approval" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Role</th>
<th>Name</th>
<th>Date</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Product Owner</td>
<td>@bossjones</td>
<td>2024-04-17</td>
<td>✅ Approved</td>
</tr>
<tr>
<td>Technical Lead</td>
<td>@bossjones</td>
<td>2024-04-17</td>
<td>✅ Approved</td>
</tr>
<tr>
<td>Engineering Manager</td>
<td>@bossjones</td>
<td>2024-04-17</td>
<td>✅ Approved</td>
</tr>
</tbody>
</table>
<h3 id="approval-notes">Approval Notes<a class="headerlink" href="#approval-notes" title="Permanent link">¶</a></h3>
<p>PRD has been reviewed and approved. The document provides:
- Comprehensive technical specifications and requirements
- Clear project structure and implementation timeline
- Detailed test strategy with coverage targets
- Well-defined user experience and interface design
- Thorough error handling and monitoring strategy</p>
<h3 id="version-history">Version History<a class="headerlink" href="#version-history" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0.0</td>
<td>2024-04-17</td>
<td>@bossjones</td>
<td>Initial PRD approved</td>
</tr>
</tbody>
</table>
<h2 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link">¶</a></h2>
<p>Boss-Bot is a Discord bot designed to enhance server productivity by providing robust media download capabilities and future RAG (Retrieval-Augmented Generation) features. The initial MVP focuses on reliable media downloads from popular platforms like Twitter and Reddit, with a strong foundation for future AI-powered features. The bot emphasizes test-driven development, clean code practices, and modular design to ensure maintainability and extensibility.</p>
<h2 id="development-environment_1">Development Environment<a class="headerlink" href="#development-environment_1" title="Permanent link">¶</a></h2>
<h3 id="setup-requirements">Setup Requirements<a class="headerlink" href="#setup-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Python 3.11 or higher (3.12 recommended)</li>
<li>UV package manager</li>
<li>Git</li>
</ul>
<h3 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Clone the repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bossjones/boss-bot.git
<span class="nb">cd</span><span class="w"> </span>boss-bot

<span class="c1"># Install dependencies</span>
uv<span class="w"> </span>sync<span class="w"> </span>--dev

<span class="c1"># Set up environment variables</span>
cp<span class="w"> </span>env.sample<span class="w"> </span>.env
<span class="c1"># Edit .env with your Discord credentials</span>

<span class="c1"># Run tests</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest

<span class="c1"># Start the bot</span>
uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>boss_bot
</code></pre></div>
<h3 id="key-configuration-files">Key Configuration Files<a class="headerlink" href="#key-configuration-files" title="Permanent link">¶</a></h3>
<h4 id="1-package-management-pyprojecttoml">1. Package Management (pyproject.toml)<a class="headerlink" href="#1-package-management-pyprojecttoml" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"boss-bot"</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.1.0"</span>
<span class="n">requires-python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&gt;=3.12"</span>
<span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">"discord-py&gt;=2.5.2"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"gallery-dl&gt;=1.29.3"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"loguru&gt;=0.7.3"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"pydantic-settings&gt;=2.8.1"</span><span class="p">,</span>
<span class="w">    </span><span class="c1"># ... other dependencies</span>
<span class="p">]</span>
</code></pre></div>
<h4 id="2-code-quality-tools">2. Code Quality Tools<a class="headerlink" href="#2-code-quality-tools" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Ruff</strong>: Primary linter and formatter
  <div class="highlight"><pre><span></span><code><span class="c1"># .pre-commit-config.yaml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/astral-sh/ruff-pre-commit</span>
<span class="w">  </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruff</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--fix</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">--exit-non-zero-on-fix</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruff-format</span>
</code></pre></div></li>
</ul>
<h4 id="3-testing-framework">3. Testing Framework<a class="headerlink" href="#3-testing-framework" title="Permanent link">¶</a></h4>
<ul>
<li>pytest with extensions:</li>
<li>pytest-asyncio for async testing</li>
<li>pytest-recording for HTTP mocking</li>
<li>pytest-cov for coverage reporting</li>
<li>pytest-retry for flaky tests</li>
<li>pytest-skipuntil for handling flaky Discord API tests</li>
</ul>
<h4 id="test-organization">Test Organization<a class="headerlink" href="#test-organization" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code>tests/
├── conftest.py              # Shared test configuration and fixtures
├── fixtures/               # Test data and mock responses
│   ├── tweet_data.py      # Twitter API mock responses
│   ├── reddit_data.py     # Reddit API mock responses
│   ├── discord_data.py    # Discord API mock responses
│   └── cassettes/         # VCR cassettes for HTTP mocking
├── unit/                  # Unit tests directory
├── integration/          # Integration tests
└── eval/                # Future RAG evaluation tests
</code></pre></div>
<h4 id="handling-flaky-tests">Handling Flaky Tests<a class="headerlink" href="#handling-flaky-tests" title="Permanent link">¶</a></h4>
<ul>
<li>Use pytest-skipuntil for Discord API tests that may be unreliable</li>
<li>Store HTTP interactions in VCR cassettes under tests/fixtures/cassettes/</li>
<li>Use dpytest for reliable Discord command testing</li>
<li>Example:
  <div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipuntil</span><span class="p">(</span><span class="s2">"2024-06-01"</span><span class="p">)</span>  <span class="c1"># Skip until Discord API is stable</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_discord_feature</span><span class="p">():</span>
    <span class="c1"># Test implementation</span>
</code></pre></div></li>
</ul>
<h4 id="test-fixtures">Test Fixtures<a class="headerlink" href="#test-fixtures" title="Permanent link">¶</a></h4>
<ul>
<li>Add new fixtures in tests/fixtures/</li>
<li>Use VCR for HTTP mocking:
  <div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"module"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vcr_config</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""VCR configuration for HTTP mocking."""</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"filter_headers"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"authorization"</span><span class="p">],</span>
        <span class="s2">"filter_post_data_parameters"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"token"</span><span class="p">,</span> <span class="s2">"api_key"</span><span class="p">]</span>
    <span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="4-documentation">4. Documentation<a class="headerlink" href="#4-documentation" title="Permanent link">¶</a></h4>
<ul>
<li>MkDocs with extensions:
  <div class="highlight"><pre><span></span><code><span class="c1"># mkdocs.yml configuration</span>
<span class="nt">plugins</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdocstrings</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coverage</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git-revision-date-localized</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">macros</span>
</code></pre></div></li>
</ul>
<h3 id="development-workflow">Development Workflow<a class="headerlink" href="#development-workflow" title="Permanent link">¶</a></h3>
<ol>
<li>Create feature branch</li>
<li>Write tests first (TDD)</li>
<li>Implement feature</li>
<li>Run pre-commit hooks</li>
<li>Submit PR</li>
</ol>
<h3 id="cicd-pipeline_1">CI/CD Pipeline<a class="headerlink" href="#cicd-pipeline_1" title="Permanent link">¶</a></h3>
<p>GitHub Actions workflow includes:
- Linting with Ruff
- Testing with pytest
- Documentation generation
- Coverage reporting</p>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">¶</a></h3>
<p>Required for development:
<div class="highlight"><pre><span></span><code><span class="nv">DISCORD_TOKEN</span><span class="o">=</span>required<span class="w">                </span><span class="c1"># Discord bot token</span>
<span class="nv">DISCORD_CLIENT_ID</span><span class="o">=</span>required<span class="w">           </span><span class="c1"># Discord application client ID</span>
<span class="nv">DISCORD_SERVER_ID</span><span class="o">=</span>required<span class="w">           </span><span class="c1"># Target Discord server ID</span>
<span class="nv">DISCORD_ADMIN_USER_ID</span><span class="o">=</span>required<span class="w">       </span><span class="c1"># Admin user ID</span>
</code></pre></div></p>
<h2 id="goals">Goals<a class="headerlink" href="#goals" title="Permanent link">¶</a></h2>
<ul>
<li>Create a reliable and efficient Discord bot for media downloads with &gt;99% uptime</li>
<li>Implement MVP test coverage targets:</li>
<li>Core Download: 30%</li>
<li>Command Parsing: 25%</li>
<li>Discord Events: 20% (limited by dpytest capabilities)</li>
<li>File Management: 20%</li>
<li>Ensure all modules follow clean code practices and stay under 120 lines</li>
<li>Build a foundation for future RAG capabilities</li>
<li>Provide clear progress tracking and queue management for downloads</li>
<li>Maintain clear documentation and type hints for junior developer onboarding</li>
</ul>
<h2 id="test-driven-development-guidelines">Test-Driven Development Guidelines<a class="headerlink" href="#test-driven-development-guidelines" title="Permanent link">¶</a></h2>
<h3 id="core-principles">Core Principles<a class="headerlink" href="#core-principles" title="Permanent link">¶</a></h3>
<ol>
<li>Write failing test first</li>
<li>Keep tests focused and small</li>
<li>Use descriptive test names that explain the behavior</li>
<li>Follow the Arrange-Act-Assert pattern</li>
<li>No implementation without a failing test</li>
</ol>
<h3 id="example-test-patterns">Example Test Patterns<a class="headerlink" href="#example-test-patterns" title="Permanent link">¶</a></h3>
<h4 id="command-testing">Command Testing<a class="headerlink" href="#command-testing" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_download_command_validates_url</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test that download command properly validates URLs."""</span>
    <span class="c1"># Arrange</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_test_bot</span><span class="p">()</span>
    <span class="n">invalid_url</span> <span class="o">=</span> <span class="s2">"not-a-url"</span>

    <span class="c1"># Act</span>
    <span class="k">await</span> <span class="n">send_command</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">invalid_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="n">assert_bot_replied_with</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="s2">"Invalid URL"</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_download_command_handles_valid_url</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test that download command processes valid URLs."""</span>
    <span class="c1"># Arrange</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_test_bot</span><span class="p">()</span>
    <span class="n">valid_url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>

    <span class="c1"># Act</span>
    <span class="k">await</span> <span class="n">send_command</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">valid_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="n">assert_download_started</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="n">valid_url</span><span class="p">)</span>
</code></pre></div>
<h4 id="event-testing">Event Testing<a class="headerlink" href="#event-testing" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_bot_handles_disconnect</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test that bot properly handles disconnection events."""</span>
    <span class="c1"># Arrange</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_test_bot</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">ensure_bot_connected</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>

    <span class="c1"># Act</span>
    <span class="k">await</span> <span class="n">simulate_disconnect</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="n">assert_reconnection_attempted</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>
    <span class="n">assert_event_logged</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="s2">"disconnect"</span><span class="p">)</span>
</code></pre></div>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Test Isolation</strong></li>
<li>Each test should be independent</li>
<li>Clean up resources after each test</li>
<li>
<p>Use fresh fixtures for each test</p>
</li>
<li>
<p><strong>Meaningful Names</strong></p>
</li>
<li>Test names should describe behavior</li>
<li>Use consistent naming patterns</li>
<li>
<p>Include success and failure cases</p>
</li>
<li>
<p><strong>Test Organization</strong></p>
</li>
<li>Group related tests in classes</li>
<li>Use descriptive test class names</li>
<li>
<p>Keep test files focused and small</p>
</li>
<li>
<p><strong>Mocking and Fixtures</strong></p>
</li>
<li>Mock external dependencies</li>
<li>Use fixtures for common setup</li>
<li>Keep mocks simple and focused</li>
</ol>
<p><requirements></requirements></p>
<h2 id="features-and-requirements">Features and Requirements<a class="headerlink" href="#features-and-requirements" title="Permanent link">¶</a></h2>
<h3 id="functional-requirements">Functional Requirements<a class="headerlink" href="#functional-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Discord bot integration using discord.py</li>
<li>Media download commands ($dlt, $dlr) with progress tracking</li>
<li>Queue management system for multiple download requests</li>
<li>Temporary file storage and cleanup mechanism</li>
<li>Error handling and user feedback system</li>
<li>Command help and documentation</li>
</ul>
<h3 id="non-functional-requirements">Non-functional Requirements<a class="headerlink" href="#non-functional-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Response time &lt;2s for command acknowledgment</li>
<li>Download queue processing time &lt;5min per item</li>
<li>Maximum module size of 120 lines</li>
<li>Type hints for all functions and classes</li>
<li>Comprehensive docstrings following Google style</li>
<li>Test coverage targets (MVP):</li>
<li>Core Download: 30%</li>
<li>Command Parsing: 25%</li>
<li>Discord Events: 20% (limited by dpytest capabilities)</li>
<li>File Management: 20%</li>
<li>Higher coverage targets will be set post-MVP</li>
<li>Adherence to DRY (Don't Repeat Yourself) and YAGNI (You Aren't Gonna Need It) principles</li>
<li>Performance testing requirements:</li>
<li>Load testing for concurrent downloads (minimum 10 simultaneous)</li>
<li>Memory usage monitoring (max 500MB under load)</li>
<li>CPU usage monitoring (max 50% under load)</li>
<li>Network bandwidth monitoring and throttling capabilities</li>
<li>Code quality requirements:</li>
<li>All code must pass ruff linting and formatting</li>
<li>Zero tolerance for unhandled exceptions</li>
<li>Comprehensive error handling with better-exceptions</li>
<li>All HTTP interactions must be tested with respx mocking</li>
<li>Flaky tests must be identified and managed with pytest-ignore-flaky</li>
<li>Critical tests must use pytest-retry for reliability</li>
</ul>
<h3 id="user-experience-requirements">User Experience Requirements<a class="headerlink" href="#user-experience-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Clear progress indicators for downloads</li>
<li>Intuitive command syntax</li>
<li>Helpful error messages</li>
<li>Command usage examples</li>
<li>Queue status visibility</li>
</ul>
<h3 id="integration-requirements">Integration Requirements<a class="headerlink" href="#integration-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Discord API integration</li>
<li>Twitter API integration via gallery_dl</li>
<li>Reddit API integration via gallery_dl</li>
<li>File system management</li>
<li>Future: Vector store integration
</li>
</ul>
<p><data_models></data_models></p>
<h2 id="data-models_1">Data Models<a class="headerlink" href="#data-models_1" title="Permanent link">¶</a></h2>
<p>All data models will be implemented using Pydantic for validation and serialization. Models are organized by domain and include comprehensive type hints and validation rules.</p>
<h3 id="core-models_1">Core Models<a class="headerlink" href="#core-models_1" title="Permanent link">¶</a></h3>
<h4 id="botconfig">BotConfig<a class="headerlink" href="#botconfig" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BotConfig</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Bot configuration settings."""</span>
    <span class="n">token</span><span class="p">:</span> <span class="n">SecretStr</span>
    <span class="n">command_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"$"</span>
    <span class="n">max_concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">max_queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">temp_file_retention_hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span>
    <span class="n">max_file_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"INFO"</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
        <span class="n">env_prefix</span> <span class="o">=</span> <span class="s2">"BOSS_BOT_"</span>
</code></pre></div>
<h4 id="downloaditem">DownloadItem<a class="headerlink" href="#downloaditem" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DownloadStatus</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Status of a download item."""</span>
    <span class="n">QUEUED</span> <span class="o">=</span> <span class="s2">"queued"</span>
    <span class="n">DOWNLOADING</span> <span class="o">=</span> <span class="s2">"downloading"</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">"completed"</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">"failed"</span>
    <span class="n">CANCELLED</span> <span class="o">=</span> <span class="s2">"cancelled"</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadPriority</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Priority levels for downloads."""</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">NORMAL</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadItem</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Represents a single download request."""</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">HttpUrl</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DownloadStatus</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">DownloadPriority</span> <span class="o">=</span> <span class="n">DownloadPriority</span><span class="o">.</span><span class="n">NORMAL</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">channel_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">started_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">completed_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">progress</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">total_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">current_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attempt_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
        <span class="n">json_encoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">datetime</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="n">UUID</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div>
<h4 id="queuestate">QueueState<a class="headerlink" href="#queuestate" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QueueState</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Represents the current state of the download queue."""</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DownloadItem</span><span class="p">]</span>
    <span class="n">active_downloads</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">total_items</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">queue_size</span><span class="p">:</span> <span class="nb">int</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_full</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_items</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_size</span>
</code></pre></div>
<h4 id="downloadprogress">DownloadProgress<a class="headerlink" href="#downloadprogress" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProgressUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Progress update for a download."""</span>
    <span class="n">item_id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">bytes_downloaded</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">total_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">speed_bps</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">eta_seconds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">status_message</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
<h3 id="user-management-models">User Management Models<a class="headerlink" href="#user-management-models" title="Permanent link">¶</a></h3>
<h4 id="userpermissions">UserPermissions<a class="headerlink" href="#userpermissions" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PermissionLevel</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""User permission levels."""</span>
    <span class="n">NORMAL</span> <span class="o">=</span> <span class="s2">"normal"</span>
    <span class="n">PREMIUM</span> <span class="o">=</span> <span class="s2">"premium"</span>
    <span class="n">ADMIN</span> <span class="o">=</span> <span class="s2">"admin"</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""User-specific settings and permissions."""</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">permission_level</span><span class="p">:</span> <span class="n">PermissionLevel</span> <span class="o">=</span> <span class="n">PermissionLevel</span><span class="o">.</span><span class="n">NORMAL</span>
    <span class="n">max_concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">max_file_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">total_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">last_download</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="file-management-models">File Management Models<a class="headerlink" href="#file-management-models" title="Permanent link">¶</a></h3>
<h4 id="downloadedfile">DownloadedFile<a class="headerlink" href="#downloadedfile" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DownloadedFile</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Represents a downloaded file in temporary storage."""</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">download_item_id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">size_bytes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">mime_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">checksum</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expires_at</span>
</code></pre></div>
<h3 id="error-models">Error Models<a class="headerlink" href="#error-models" title="Permanent link">¶</a></h3>
<h4 id="downloaderror">DownloadError<a class="headerlink" href="#downloaderror" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ErrorType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Types of download errors."""</span>
    <span class="n">NETWORK</span> <span class="o">=</span> <span class="s2">"network"</span>
    <span class="n">RATE_LIMIT</span> <span class="o">=</span> <span class="s2">"rate_limit"</span>
    <span class="n">FILE_TOO_LARGE</span> <span class="o">=</span> <span class="s2">"file_too_large"</span>
    <span class="n">INVALID_URL</span> <span class="o">=</span> <span class="s2">"invalid_url"</span>
    <span class="n">PERMISSION_DENIED</span> <span class="o">=</span> <span class="s2">"permission_denied"</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"unknown"</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadError</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Detailed error information for failed downloads."""</span>
    <span class="n">item_id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">error_type</span><span class="p">:</span> <span class="n">ErrorType</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">retry_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_permanent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
<h3 id="metrics-models">Metrics Models<a class="headerlink" href="#metrics-models" title="Permanent link">¶</a></h3>
<h4 id="downloadmetrics">DownloadMetrics<a class="headerlink" href="#downloadmetrics" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DownloadMetrics</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Metrics for download performance monitoring."""</span>
    <span class="n">total_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">failed_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">average_speed_bps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">total_bytes_downloaded</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">queue_wait_time_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">active_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">success_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span>
</code></pre></div>
<h3 id="prometheus-metrics-structure">Prometheus Metrics Structure<a class="headerlink" href="#prometheus-metrics-structure" title="Permanent link">¶</a></h3>
<p>The following metrics will be collected and exposed via Prometheus:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Gauge</span><span class="p">,</span> <span class="n">Histogram</span>

<span class="c1"># Core Download Metrics</span>
<span class="n">DOWNLOAD_REQUESTS</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
    <span class="s1">'download_requests_total'</span><span class="p">,</span>
    <span class="s1">'Total download requests'</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">'platform'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">]</span>  <span class="c1"># platform: twitter/reddit, status: success/failed</span>
<span class="p">)</span>

<span class="n">DOWNLOAD_DURATION</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
    <span class="s1">'download_duration_seconds'</span><span class="p">,</span>
    <span class="s1">'Time spent downloading'</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">'platform'</span><span class="p">],</span>
    <span class="n">buckets</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>  <span class="c1"># 1s to 5min buckets</span>
<span class="p">)</span>

<span class="n">QUEUE_SIZE</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">'download_queue_size'</span><span class="p">,</span>
    <span class="s1">'Current size of download queue'</span>
<span class="p">)</span>

<span class="c1"># Performance Metrics</span>
<span class="n">COMMAND_LATENCY</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
    <span class="s1">'command_latency_seconds'</span><span class="p">,</span>
    <span class="s1">'Command processing time'</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">'command'</span><span class="p">],</span>
    <span class="n">buckets</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># 100ms to 5s buckets</span>
<span class="p">)</span>

<span class="n">DISCORD_API_LATENCY</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">'discord_api_latency_seconds'</span><span class="p">,</span>
    <span class="s1">'Discord API latency'</span>
<span class="p">)</span>

<span class="c1"># Error Metrics</span>
<span class="n">ERROR_COUNT</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
    <span class="s1">'error_total'</span><span class="p">,</span>
    <span class="s1">'Total errors by type'</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">'error_type'</span><span class="p">,</span> <span class="s1">'platform'</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Resource Usage Metrics</span>
<span class="n">MEMORY_USAGE</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">'memory_usage_bytes'</span><span class="p">,</span>
    <span class="s1">'Memory usage in bytes'</span>
<span class="p">)</span>

<span class="n">CPU_USAGE</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">'cpu_usage_percent'</span><span class="p">,</span>
    <span class="s1">'CPU usage percentage'</span>
<span class="p">)</span>

<span class="c1"># File Management Metrics</span>
<span class="n">FILE_SIZE</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
    <span class="s1">'download_file_size_bytes'</span><span class="p">,</span>
    <span class="s1">'Size of downloaded files'</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">'platform'</span><span class="p">],</span>
    <span class="n">buckets</span><span class="o">=</span><span class="p">[</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">]]</span>  <span class="c1"># 1MB to 50MB buckets</span>
<span class="p">)</span>

<span class="n">TEMP_FILES</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
    <span class="s1">'temp_files_count'</span><span class="p">,</span>
    <span class="s1">'Number of files in temporary storage'</span>
<span class="p">)</span>
</code></pre></div>
<p>These metrics provide comprehensive monitoring of:
- Download performance and success rates
- Command response times
- Resource utilization
- Error tracking
- File management statistics</p>
<p>Metrics will be exposed on <code>/metrics</code> endpoint for Prometheus scraping.</p>
<p>These models provide a strong foundation for type safety and data validation throughout the application. Each model includes:
- Comprehensive type hints
- Default values where appropriate
- Validation rules
- JSON serialization support
- Clear documentation
- Enum-based status and type fields</p>
<p>The models are designed to be:
- Immutable where possible
- Self-validating
- Easy to serialize/deserialize
- Well-documented
- Extensible for future features
</p>
<p><file_management></file_management></p>
<h2 id="file-management-specifications">File Management Specifications<a class="headerlink" href="#file-management-specifications" title="Permanent link">¶</a></h2>
<h3 id="storage-architecture">Storage Architecture<a class="headerlink" href="#storage-architecture" title="Permanent link">¶</a></h3>
<h4 id="directory-structure">Directory Structure<a class="headerlink" href="#directory-structure" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code>/tmp/boss-bot/
├── downloads/
│   ├── {guild_id}/
│   │   ├── {yyyy-mm-dd}/
│   │   │   ├── {download_id}/
│   │   │   │   ├── metadata.json
│   │   │   │   └── content/
│   │   │   │       └── {filename}
│   │   │   └── .cleanup
│   │   └── .stats
│   └── .maintenance
├── temp/
│   └── {download_id}/
└── .locks/
</code></pre></div>
<h3 id="storage-policies_1">Storage Policies<a class="headerlink" href="#storage-policies_1" title="Permanent link">¶</a></h3>
<h4 id="temporary-storage">Temporary Storage<a class="headerlink" href="#temporary-storage" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Location</strong>: All downloads initially go to <code>/tmp/boss-bot/temp/{download_id}/</code></li>
<li><strong>Retention</strong>: Files in temp are deleted after:</li>
<li>Successful upload to Discord (immediate)</li>
<li>Failed download (30 minutes)</li>
<li>Abandoned download (1 hour)</li>
<li><strong>Size Limits</strong>:</li>
<li>Individual file: 50MB (Discord limit)</li>
<li>Total temp storage: 1GB</li>
<li>Per guild daily quota: 500MB</li>
</ul>
<h4 id="organized-storage">Organized Storage<a class="headerlink" href="#organized-storage" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Structure</strong>: Downloads are organized by guild and date</li>
<li><strong>Metadata</strong>: Each download includes a metadata.json file containing:</li>
<li>Original URL</li>
<li>Download timestamp</li>
<li>User information</li>
<li>File checksums</li>
<li>Processing history</li>
<li><strong>Retention Periods</strong>:</li>
<li>Successful downloads: 24 hours</li>
<li>Failed downloads with retry potential: 6 hours</li>
<li>Premium guild downloads: 72 hours</li>
</ul>
<h3 id="cleanup-mechanisms">Cleanup Mechanisms<a class="headerlink" href="#cleanup-mechanisms" title="Permanent link">¶</a></h3>
<h4 id="scheduled-cleanup">Scheduled Cleanup<a class="headerlink" href="#scheduled-cleanup" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CleanupSchedule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Cleanup schedule configuration."""</span>
    <span class="n">TEMP_SCAN_INTERVAL</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes</span>
    <span class="n">MAIN_SCAN_INTERVAL</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># 1 hour</span>
    <span class="n">DEEP_SCAN_INTERVAL</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">86400</span>  <span class="c1"># 24 hours</span>
</code></pre></div>
<h4 id="cleanup-rules">Cleanup Rules<a class="headerlink" href="#cleanup-rules" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Temporary Files</strong>:</li>
<li>Run every 5 minutes</li>
<li>Remove files older than their retention period</li>
<li>Remove files from completed/failed downloads</li>
<li>
<p>Clean partial downloads older than 1 hour</p>
</li>
<li>
<p><strong>Main Storage</strong>:</p>
</li>
<li>Run every hour</li>
<li>Remove expired files based on retention policy</li>
<li>Clean empty directories</li>
<li>
<p>Update storage statistics</p>
</li>
<li>
<p><strong>Deep Cleanup</strong>:</p>
</li>
<li>Run daily during low-usage hours</li>
<li>Perform integrity checks</li>
<li>Remove orphaned files</li>
<li>Compress and archive logs</li>
<li>Generate storage reports</li>
</ol>
<h3 id="file-operations_1">File Operations<a class="headerlink" href="#file-operations_1" title="Permanent link">¶</a></h3>
<h4 id="download-process">Download Process<a class="headerlink" href="#download-process" title="Permanent link">¶</a></h4>
<ol>
<li>
<p><strong>Initial Download</strong>:
   <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_flow</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="n">temp_path</span> <span class="o">=</span> <span class="n">get_temp_path</span><span class="p">(</span><span class="n">download_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">download_to_temp</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">temp_path</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">validate_download</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
        <span class="n">final_path</span> <span class="o">=</span> <span class="n">organize_download</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_path</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">cleanup_failed_download</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Validation Checks</strong>:</p>
</li>
<li>File size limits</li>
<li>MIME type verification</li>
<li>Malware scanning</li>
<li>
<p>File integrity checks</p>
</li>
<li>
<p><strong>Organization Process</strong>:</p>
</li>
<li>Create guild/date directories</li>
<li>Generate metadata</li>
<li>Move from temp to organized storage</li>
<li>Update storage statistics</li>
</ol>
<h3 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">¶</a></h3>
<h4 id="storage-errors">Storage Errors<a class="headerlink" href="#storage-errors" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StorageError</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">DISK_FULL</span> <span class="o">=</span> <span class="s2">"Insufficient disk space"</span>
    <span class="n">QUOTA_EXCEEDED</span> <span class="o">=</span> <span class="s2">"Guild quota exceeded"</span>
    <span class="n">INVALID_FILE</span> <span class="o">=</span> <span class="s2">"File validation failed"</span>
    <span class="n">CLEANUP_ERROR</span> <span class="o">=</span> <span class="s2">"Cleanup process failed"</span>
</code></pre></div>
<h4 id="recovery-procedures">Recovery Procedures<a class="headerlink" href="#recovery-procedures" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Disk Space Issues</strong>:</li>
<li>Trigger emergency cleanup</li>
<li>Notify administrators</li>
<li>
<p>Temporarily reject new downloads</p>
</li>
<li>
<p><strong>Quota Exceeded</strong>:</p>
</li>
<li>Notify guild administrators</li>
<li>Provide cleanup recommendations</li>
<li>
<p>Offer premium upgrade options</p>
</li>
<li>
<p><strong>Validation Failures</strong>:</p>
</li>
<li>Log detailed error information</li>
<li>Notify user with specific reason</li>
<li>Clean up invalid files immediately</li>
</ol>
<h3 id="monitoring-and-metrics">Monitoring and Metrics<a class="headerlink" href="#monitoring-and-metrics" title="Permanent link">¶</a></h3>
<h4 id="storage-metrics">Storage Metrics<a class="headerlink" href="#storage-metrics" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StorageMetrics</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Storage monitoring metrics."""</span>
    <span class="n">total_space_used</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">temp_space_used</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">downloads_per_guild</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
    <span class="n">cleanup_stats</span><span class="p">:</span> <span class="n">CleanupStats</span>
    <span class="n">error_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">StorageError</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</code></pre></div>
<h4 id="alerts">Alerts<a class="headerlink" href="#alerts" title="Permanent link">¶</a></h4>
<ul>
<li>Disk space usage &gt; 80%</li>
<li>Cleanup job failures</li>
<li>High error rates</li>
<li>Quota approaching limits</li>
<li>Suspicious file patterns</li>
</ul>
<h3 id="file-types-and-processing">File Types and Processing<a class="headerlink" href="#file-types-and-processing" title="Permanent link">¶</a></h3>
<h4 id="supported-file-types">Supported File Types<a class="headerlink" href="#supported-file-types" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SupportedTypes</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Supported file types and their processors."""</span>
    <span class="n">IMAGES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"jpg"</span><span class="p">,</span> <span class="s2">"png"</span><span class="p">,</span> <span class="s2">"gif"</span><span class="p">,</span> <span class="s2">"webp"</span><span class="p">]</span>
    <span class="n">VIDEOS</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"mp4"</span><span class="p">,</span> <span class="s2">"webm"</span><span class="p">,</span> <span class="s2">"mov"</span><span class="p">]</span>
    <span class="n">AUDIO</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"mp3"</span><span class="p">,</span> <span class="s2">"wav"</span><span class="p">,</span> <span class="s2">"ogg"</span><span class="p">]</span>
    <span class="n">MAX_SIZES</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"image"</span><span class="p">:</span> <span class="mi">5_242_880</span><span class="p">,</span>  <span class="c1"># 5MB</span>
        <span class="s2">"video"</span><span class="p">:</span> <span class="mi">52_428_800</span><span class="p">,</span>  <span class="c1"># 50MB</span>
        <span class="s2">"audio"</span><span class="p">:</span> <span class="mi">10_485_760</span>  <span class="c1"># 10MB</span>
    <span class="p">}</span>
</code></pre></div>
<h4 id="processing-rules">Processing Rules<a class="headerlink" href="#processing-rules" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Images</strong>:</li>
<li>Convert to Discord-optimal formats</li>
<li>Resize if exceeding limits</li>
<li>
<p>Strip metadata</p>
</li>
<li>
<p><strong>Videos</strong>:</p>
</li>
<li>Transcode to Discord-compatible format</li>
<li>Adjust bitrate if needed</li>
<li>
<p>Generate thumbnail</p>
</li>
<li>
<p><strong>Audio</strong>:</p>
</li>
<li>Convert to Discord-supported format</li>
<li>Adjust quality if size exceeds limits</li>
</ol>
<p>This comprehensive file management system ensures:
- Efficient use of storage space
- Reliable cleanup of temporary files
- Clear organization of downloads
- Robust error handling
- Detailed monitoring and metrics
- Type-safe file processing
</p>
<p><user_experience></user_experience></p>
<h2 id="user-experience-specifications">User Experience Specifications<a class="headerlink" href="#user-experience-specifications" title="Permanent link">¶</a></h2>
<h3 id="command-interface">Command Interface<a class="headerlink" href="#command-interface" title="Permanent link">¶</a></h3>
<h4 id="command-structure_1">Command Structure<a class="headerlink" href="#command-structure_1" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CommandFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Standard command format specifications."""</span>
    <span class="n">PREFIX</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"$"</span>
    <span class="n">COMMANDS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"dlt"</span><span class="p">:</span> <span class="s2">"Download from Twitter"</span><span class="p">,</span>
        <span class="s2">"dlr"</span><span class="p">:</span> <span class="s2">"Download from Reddit"</span><span class="p">,</span>
        <span class="s2">"dlq"</span><span class="p">:</span> <span class="s2">"Show queue status"</span><span class="p">,</span>
        <span class="s2">"dlc"</span><span class="p">:</span> <span class="s2">"Cancel download"</span><span class="p">,</span>
        <span class="s2">"dls"</span><span class="p">:</span> <span class="s2">"Show settings"</span><span class="p">,</span>
        <span class="s2">"dlh"</span><span class="p">:</span> <span class="s2">"Show help"</span>
    <span class="p">}</span>
</code></pre></div>
<h4 id="progress-updates">Progress Updates<a class="headerlink" href="#progress-updates" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProgressFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Progress message formatting."""</span>
    <span class="n">TEMPLATE</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    Downloading: </span><span class="si">{filename}</span>
<span class="s2">    Progress: </span><span class="si">{bar}</span><span class="s2"> </span><span class="si">{percentage}</span><span class="s2">%</span>
<span class="s2">    Speed: </span><span class="si">{speed}</span><span class="s2">/s</span>
<span class="s2">    ETA: </span><span class="si">{eta}</span>
<span class="s2">    Status: </span><span class="si">{status}</span>
<span class="s2">    """</span>
    <span class="n">UPDATE_INTERVAL</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># seconds</span>
    <span class="n">BAR_LENGTH</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
</code></pre></div>
<p>Example Progress Message:
<div class="highlight"><pre><span></span><code>Downloading: funny_cat_video.mp4
Progress: [====================] 100%
Speed: 1.2 MB/s
ETA: Complete
Status: Processing for Discord upload
</code></pre></div></p>
<h3 id="user-interactions">User Interactions<a class="headerlink" href="#user-interactions" title="Permanent link">¶</a></h3>
<h4 id="command-flow">Command Flow<a class="headerlink" href="#command-flow" title="Permanent link">¶</a></h4>
<ol>
<li>
<p><strong>Download Initiation</strong>:
   <div class="highlight"><pre><span></span><code>User: $dlt https://twitter.com/user/status/123
Bot: Starting download...
     Queue position: 2
     Estimated start: 2 minutes
</code></pre></div></p>
</li>
<li>
<p><strong>Progress Updates</strong>:
   <div class="highlight"><pre><span></span><code>Bot: [Progress message updates every 5 seconds]
     Updates merge into single message
     Uses reactions for user controls
</code></pre></div></p>
</li>
<li>
<p><strong>Completion/Error</strong>:
   <div class="highlight"><pre><span></span><code>Bot: ✅ Download complete!
     File: funny_cat_video.mp4
     Size: 2.3MB
     Time: 45s
</code></pre></div></p>
</li>
</ol>
<h4 id="interactive-elements">Interactive Elements<a class="headerlink" href="#interactive-elements" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Progress Control Reactions</strong>:</li>
<li>⏸️ Pause download</li>
<li>▶️ Resume download</li>
<li>⏹️ Cancel download</li>
<li>ℹ️ Show details</li>
<li>
<p>🔄 Retry failed download</p>
</li>
<li>
<p><strong>Queue Management</strong>:
   <div class="highlight"><pre><span></span><code>User: $dlq
Bot: Current Queue Status:
     1. video1.mp4 [===&gt;    ] 35%
     2. image.jpg [WAITING]
     3. video2.mp4 [WAITING]

     Your position: 2
     Estimated wait: 3 minutes
</code></pre></div></p>
</li>
<li>
<p><strong>Settings Management</strong>:
   <div class="highlight"><pre><span></span><code>User: $dls
Bot: Your Settings:
     Max concurrent downloads: 2
     Notification preference: Mentions
     Default priority: Normal
     Total downloads today: 5/10
</code></pre></div></p>
</li>
</ol>
<h3 id="notification-system">Notification System<a class="headerlink" href="#notification-system" title="Permanent link">¶</a></h3>
<h4 id="update-types">Update Types<a class="headerlink" href="#update-types" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NotificationPreference</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""User notification preferences."""</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="s2">"none"</span>  <span class="c1"># No updates</span>
    <span class="n">MINIMAL</span> <span class="o">=</span> <span class="s2">"minimal"</span>  <span class="c1"># Start/finish only</span>
    <span class="n">NORMAL</span> <span class="o">=</span> <span class="s2">"normal"</span>  <span class="c1"># Regular progress</span>
    <span class="n">VERBOSE</span> <span class="o">=</span> <span class="s2">"verbose"</span>  <span class="c1"># Detailed updates</span>
</code></pre></div>
<h4 id="notification-rules">Notification Rules<a class="headerlink" href="#notification-rules" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Queue Position Updates</strong>:</li>
<li>When moving up in queue</li>
<li>When about to start</li>
<li>
<p>On significant delays</p>
</li>
<li>
<p><strong>Download Progress</strong>:</p>
</li>
<li>Start of download</li>
<li>Regular progress updates</li>
<li>Completion/failure</li>
<li>
<p>Processing status</p>
</li>
<li>
<p><strong>Error Notifications</strong>:</p>
</li>
<li>Clear error description</li>
<li>Recommended actions</li>
<li>Retry instructions</li>
<li>Support information</li>
</ol>
<h3 id="user-settings">User Settings<a class="headerlink" href="#user-settings" title="Permanent link">¶</a></h3>
<h4 id="configurable-options">Configurable Options<a class="headerlink" href="#configurable-options" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserPreferences</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""User-configurable settings."""</span>
    <span class="n">notification_level</span><span class="p">:</span> <span class="n">NotificationPreference</span>
    <span class="n">progress_bar_style</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">default_priority</span><span class="p">:</span> <span class="n">DownloadPriority</span>
    <span class="n">mention_on_complete</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">auto_retry</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div>
<h4 id="default-values">Default Values<a class="headerlink" href="#default-values" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">DEFAULT_PREFERENCES</span> <span class="o">=</span> <span class="n">UserPreferences</span><span class="p">(</span>
    <span class="n">notification_level</span><span class="o">=</span><span class="n">NotificationPreference</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">progress_bar_style</span><span class="o">=</span><span class="s2">"standard"</span><span class="p">,</span>
    <span class="n">default_priority</span><span class="o">=</span><span class="n">DownloadPriority</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
    <span class="n">mention_on_complete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">auto_retry</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="help-system">Help System<a class="headerlink" href="#help-system" title="Permanent link">¶</a></h3>
<h4 id="command-help">Command Help<a class="headerlink" href="#command-help" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HelpFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Help message formatting."""</span>
    <span class="n">TEMPLATE</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    </span><span class="si">{command}</span><span class="s2">: </span><span class="si">{description}</span>
<span class="s2">    Usage: </span><span class="si">{usage}</span>
<span class="s2">    Examples:</span>
<span class="s2">    </span><span class="si">{examples}</span>
<span class="s2">    Notes:</span>
<span class="s2">    </span><span class="si">{notes}</span>
<span class="s2">    """</span>
</code></pre></div>
<p>Example Help Message:
<div class="highlight"><pre><span></span><code>$dlt: Download from Twitter
Usage: $dlt &lt;url&gt; [priority]

Examples:
  $dlt https://twitter.com/user/status/123
  $dlt https://twitter.com/user/status/123 high

Notes:
- Supports single tweets and threads
- Max file size: 50MB
- Supported formats: Images, Videos
</code></pre></div></p>
<h3 id="error-messages">Error Messages<a class="headerlink" href="#error-messages" title="Permanent link">¶</a></h3>
<h4 id="user-friendly-errors">User-Friendly Errors<a class="headerlink" href="#user-friendly-errors" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ErrorMessages</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""User-friendly error messages."""</span>
    <span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ErrorType</span><span class="o">.</span><span class="n">NETWORK</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">"🔌 Connection issue! I couldn't reach </span><span class="si">{platform}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">"</span>
            <span class="s2">"I'll retry </span><span class="si">{retry_count}</span><span class="s2"> more times.</span><span class="se">\n</span><span class="s2">"</span>
            <span class="s2">"Try again in </span><span class="si">{retry_after}</span><span class="s2"> seconds."</span>
        <span class="p">),</span>
        <span class="n">ErrorType</span><span class="o">.</span><span class="n">RATE_LIMIT</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">"⏳ We're being rate limited by </span><span class="si">{platform}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">"</span>
            <span class="s2">"Please wait </span><span class="si">{retry_after}</span><span class="s2"> seconds."</span>
        <span class="p">),</span>
        <span class="n">ErrorType</span><span class="o">.</span><span class="n">FILE_TOO_LARGE</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">"📦 File is too large (</span><span class="si">{size}</span><span class="s2">MB)!</span><span class="se">\n</span><span class="s2">"</span>
            <span class="s2">"Maximum size: </span><span class="si">{max_size}</span><span class="s2">MB</span><span class="se">\n</span><span class="s2">"</span>
            <span class="s2">"Try requesting a smaller version."</span>
        <span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>
<p>The user experience design focuses on:
- Clear and intuitive commands
- Real-time progress feedback
- Interactive controls
- Customizable notifications
- Helpful error messages
- Comprehensive help system</p>
<p>Would you like me to:
1. Add more command examples?
2. Expand the notification system?
3. Add more interactive features?
4. Detail the help system further?
</p>
<p><epic_list></epic_list></p>
<h2 id="epic-list">Epic List<a class="headerlink" href="#epic-list" title="Permanent link">¶</a></h2>
<h3 id="epic-1-core-bot-infrastructure">Epic-1: Core Bot Infrastructure<a class="headerlink" href="#epic-1-core-bot-infrastructure" title="Permanent link">¶</a></h3>
<ul>
<li>Discord bot setup and configuration</li>
<li>Command handling framework</li>
<li>Error handling and logging</li>
<li>Testing infrastructure</li>
</ul>
<h3 id="epic-2-media-download-system">Epic-2: Media Download System<a class="headerlink" href="#epic-2-media-download-system" title="Permanent link">¶</a></h3>
<ul>
<li>Download queue implementation</li>
<li>Progress tracking</li>
<li>File management</li>
<li>Platform-specific downloaders</li>
</ul>
<h3 id="epic-3-future-rag-enhancement-beyond-current-prd">Epic-3: Future RAG Enhancement (Beyond Current PRD)<a class="headerlink" href="#epic-3-future-rag-enhancement-beyond-current-prd" title="Permanent link">¶</a></h3>
<ul>
<li>LangChain and LangGraph integration</li>
<li>Redis vector store setup</li>
<li>Extended command set</li>
<li>CLI interface
</li>
</ul>
<p><epic_1_stories></epic_1_stories></p>
<h2 id="epic-1-story-list">Epic 1: Story List<a class="headerlink" href="#epic-1-story-list" title="Permanent link">¶</a></h2>
<ul>
<li>Story 1: Project Initialization and Environment Setup
  Status: ''
  Requirements:</li>
<li>Initialize Python project with uv</li>
<li>Create project structure following the defined layout</li>
<li>Set up pyproject.toml with initial dependencies</li>
<li>Configure ruff for linting and formatting</li>
<li>Create initial README.md with setup instructions</li>
<li>Set up pre-commit hooks for code quality
  Acceptance Criteria:</li>
<li>Project can be cloned and installed with uv</li>
<li>Ruff runs successfully on empty project</li>
<li>
<p>README contains clear setup steps
  Dependencies: None</p>
</li>
<li>
<p>Story 2: Test Infrastructure Setup
  Status: ''
  Requirements:</p>
</li>
<li>Set up pytest with all testing dependencies</li>
<li>Create basic test configuration in conftest.py</li>
<li>Set up coverage reporting with coverage[toml]</li>
<li>Configure tox-uv for test automation</li>
<li>Create test helper utilities and fixtures</li>
<li>Add example tests to validate setup
  Acceptance Criteria:</li>
<li>All test dependencies installed and configured</li>
<li>Example tests run successfully</li>
<li>
<p>Coverage reports generate correctly
  Dependencies: Story 1</p>
</li>
<li>
<p>Story 3: Logging and Monitoring Setup
  Status: ''
  Requirements:</p>
</li>
<li>Implement logging system with loguru</li>
<li>Configure better-exceptions for error handling</li>
<li>Set up basic performance monitoring</li>
<li>Create logging configuration file</li>
<li>Add log rotation and management
  Acceptance Criteria:</li>
<li>Logs are properly formatted and stored</li>
<li>Better-exceptions shows detailed error traces</li>
<li>
<p>Basic metrics are collected
  Dependencies: Story 1</p>
</li>
<li>
<p>Story 4: Basic Discord Bot Setup
  Status: ''
  Requirements:</p>
</li>
<li>Create Discord application and bot user</li>
<li>Implement basic bot client with required intents</li>
<li>Set up environment configuration with pydantic-settings</li>
<li>Create connection and basic event handling</li>
<li>Add health check command
  Acceptance Criteria:</li>
<li>Bot successfully connects to Discord</li>
<li>Basic events (ready, disconnect) are handled</li>
<li>Health check command responds</li>
<li>Bot recovers gracefully from disconnections</li>
<li>
<p>Connection state changes are properly logged
  Dependencies: Story 1, Story 3</p>
</li>
<li>
<p>Story 4a: Discord Connection Setup
  Status: ''
  Requirements:</p>
</li>
<li>Create Discord application and bot user</li>
<li>Implement basic bot client with required intents</li>
<li>Set up environment configuration with pydantic-settings</li>
<li>Implement connection handling and basic event loop</li>
<li>Add health check endpoint</li>
<li>Implement graceful disconnection recovery</li>
<li>Add connection state logging
  Acceptance Criteria:</li>
<li>Bot successfully connects to Discord</li>
<li>Bot responds to health check command</li>
<li>Bot handles connection state changes</li>
<li>Environment variables are properly loaded</li>
<li>Bot automatically recovers from disconnections</li>
<li>
<p>All connection state changes are logged
  Dependencies: Story 1, Story 3</p>
</li>
<li>
<p>Story 4b: Command Framework Base
  Status: ''
  Requirements:</p>
</li>
<li>Set up command registration system</li>
<li>Implement basic error handling for commands</li>
<li>Add help command structure</li>
<li>Create command testing utilities</li>
<li>(Nice to Have) Implement command cooldowns</li>
<li>(Nice to Have) Implement rate limiting
  Acceptance Criteria:</li>
<li>Commands can be registered and respond</li>
<li>Error handling works for basic cases</li>
<li>Help command shows available commands</li>
<li>Command tests pass with dpytest</li>
<li>
<p>(Nice to Have) Rate limiting prevents command spam
  Dependencies: Story 4a</p>
</li>
<li>
<p>Story 4c: Event Handler Implementation
  Status: ''
  Requirements:</p>
</li>
<li>Add core event handlers (ready, disconnect, etc.)</li>
<li>Implement reconnection logic</li>
<li>Add basic event logging</li>
<li>Create event testing framework</li>
<li>Implement error recovery for events
  Acceptance Criteria:</li>
<li>All core events are handled and logged</li>
<li>Bot recovers from disconnections</li>
<li>Event tests pass with dpytest</li>
<li>Error recovery works as expected</li>
<li>
<p>Event handling coverage meets 20% target
  Dependencies: Story 4b</p>
</li>
<li>
<p>Story 5: Queue System Foundation
  Status: ''
  Requirements:</p>
</li>
<li>Design queue data structures</li>
<li>Implement basic queue manager</li>
<li>Add queue persistence</li>
<li>Create queue status command</li>
<li>Implement queue tests
  Acceptance Criteria:</li>
<li>Queue can add and remove items</li>
<li>Queue state persists across restarts</li>
<li>Queue status is queryable</li>
<li>Queue tests pass
  Dependencies: Story 5, Story 6</li>
</ul>
<p>Each story includes clear dependencies, making it easier for junior developers to understand the progression. Stories are broken down into smaller, manageable tasks with clear acceptance criteria. 🏗️
</p>
<p><tech_stack></tech_stack></p>
<h2 id="technology-stack">Technology Stack<a class="headerlink" href="#technology-stack" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Technology</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Python 3.12</td>
<td>Primary development language</td>
</tr>
<tr>
<td>uv</td>
<td>Package management and dependency resolution</td>
</tr>
<tr>
<td>discord.py</td>
<td>Discord bot framework</td>
</tr>
<tr>
<td>pytest</td>
<td>Testing framework with powerful fixture support and assertion introspection</td>
</tr>
<tr>
<td>dpytest</td>
<td>Discord.py testing utilities</td>
</tr>
<tr>
<td>gallery-dl</td>
<td>Reddit, instagram, twitter, other social media media download utility</td>
</tr>
<tr>
<td>yt-dlp</td>
<td>youtube/video download utility</td>
</tr>
<tr>
<td>httpx</td>
<td>Fully featured HTTP client for Python 3, with sync and async APIs, and HTTP/1.1 and HTTP/2 support</td>
</tr>
<tr>
<td>pydantic</td>
<td>Data validation</td>
</tr>
<tr>
<td>pydantic-settings</td>
<td>Configuration management</td>
</tr>
<tr>
<td>loguru</td>
<td>Logging utility</td>
</tr>
<tr>
<td>aiofiles</td>
<td>Asynchronous file I/O operations using asyncio</td>
</tr>
<tr>
<td>better-exceptions</td>
<td>Enhanced exception handling with more informative error messages</td>
</tr>
</tbody>
</table>
<h3 id="testing-dependencies">Testing Dependencies<a class="headerlink" href="#testing-dependencies" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Technology</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>pytest-mock</td>
<td>Thin-wrapper around the unittest.mock package for easier mock creation</td>
</tr>
<tr>
<td>respx</td>
<td>Modern, elegant HTTP mocking for Python tests</td>
</tr>
<tr>
<td>pytest-recording</td>
<td>Record and replay test interactions for reliable testing</td>
</tr>
<tr>
<td>pytest-retry</td>
<td>Retry flaky tests to improve reliability</td>
</tr>
<tr>
<td>pytest-skip-slow</td>
<td>Skip slow tests for faster development cycles</td>
</tr>
<tr>
<td>pytest-ignore-flaky</td>
<td>Manage and track flaky tests separately</td>
</tr>
<tr>
<td>tox-uv</td>
<td>Tox plugin for UV package manager integration</td>
</tr>
<tr>
<td>ruff</td>
<td>Fast Python linter and code formatter written in Rust</td>
</tr>
<tr>
<td>coverage[toml]</td>
<td>Code coverage measurement with TOML configuration support</td>
</tr>
</tbody>
</table>
<h3 id="future-dependencies">Future Dependencies<a class="headerlink" href="#future-dependencies" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Technology</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LangChain</td>
<td>RAG framework</td>
</tr>
<tr>
<td>LangGraph</td>
<td>RAG workflow management</td>
</tr>
<tr>
<td>OpenAI</td>
<td>Embeddings and LLM via LangChain</td>
</tr>
<tr>
<td>Redis</td>
<td>Vector store</td>
</tr>
<tr>
<td>Typer</td>
<td>CLI interface</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><project_structure></project_structure></p>
<h2 id="project-structure_1">Project Structure<a class="headerlink" href="#project-structure_1" title="Permanent link">¶</a></h2>
<p><div class="highlight"><pre><span></span><code>boss-bot/
├── src/
│   ├── boss_bot/
│   │   ├── bot/
│   │   │   ├── __init__.py
│   │   │   ├── client.py          # Discord client setup
│   │   │   ├── events.py          # Event handlers
│   │   │   └── cogs/             # Discord cogs directory
│   │   │       ├── __init__.py
│   │   │       ├── download_cog.py    # Media download commands
│   │   │       ├── queue_cog.py       # Queue management commands
│   │   │       ├── rag_cog.py         # RAG-related commands
│   │   │       └── admin_cog.py       # Admin/utility commands
│   │   ├── cli/
│   │   │   ├── __init__.py
│   │   │   ├── app.py            # Typer CLI application
│   │   │   └── commands/         # CLI command modules
│   │   ├── commands/             # Shared command logic
│   │   │   ├── __init__.py
│   │   │   ├── download.py       # Download command business logic
│   │   │   ├── queue.py          # Queue management logic
│   │   │   └── rag.py           # RAG-related logic
│   │   ├── core/
│   │   │   ├── __init__.py
│   │   │   ├── config.py        # Configuration management
│   │   │   ├── queue.py         # Queue implementation
│   │   │   └── storage.py       # File storage management
│   │   ├── downloaders/
│   │   │   ├── __init__.py
│   │   │   ├── base.py          # Base downloader class
│   │   │   ├── twitter.py       # Twitter downloader
│   │   │   └── reddit.py        # Reddit downloader
│   │   ├── llm/
│   │   │   ├── __init__.py
│   │   │   ├── chains/         # LangChain components
│   │   │   ├── graphs/         # LangGraph workflows
│   │   │   ├── embeddings.py   # Embedding configurations
│   │   │   └── models.py       # LLM configurations
│   │   ├── rag/
│   │   │   ├── __init__.py
│   │   │   ├── indexer.py      # Document indexing
│   │   │   ├── retriever.py    # Vector store retrieval
│   │   │   └── store.py        # Redis vector store management
│   │   ├── schemas/
│   │   │   ├── __init__.py
│   │   │   ├── download.py     # Download-related models
│   │   │   ├── queue.py        # Queue-related models
│   │   │   └── rag.py          # RAG-related models
│   │   └── utils/
│   │       ├── __init__.py
│   │       ├── logging.py      # Logging configuration
│   │       └── metrics.py      # Performance monitoring
├── tests/
│   ├── __init__.py
│   ├── conftest.py
│   ├── test_bot/
│   ├── test_cli/
│   ├── test_commands/
│   ├── test_downloaders/
│   ├── test_llm/
│   └── test_rag/
├── docs/                       # Documentation directory
├── scripts/                    # Utility scripts
├── .devcontainer/             # Development container config
├── pyproject.toml
└── README.md
</code></pre></div>
</p>
<h2 id="data-models_2">Data Models<a class="headerlink" href="#data-models_2" title="Permanent link">¶</a></h2>
<h3 id="download-item-schema">Download Item Schema<a class="headerlink" href="#download-item-schema" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<p><implementation_timeline></implementation_timeline></p>
<h2 id="implementation-strategy-and-timeline">Implementation Strategy and Timeline<a class="headerlink" href="#implementation-strategy-and-timeline" title="Permanent link">¶</a></h2>
<p>Our implementation follows a strict TDD-first approach with two main phases:</p>
<h3 id="phase-1-mvp-discord-core">Phase 1 (MVP - Discord Core)<a class="headerlink" href="#phase-1-mvp-discord-core" title="Permanent link">¶</a></h3>
<ul>
<li>Test infrastructure setup</li>
<li>Basic Discord bot framework</li>
<li>Download command implementation</li>
<li>Queue management system</li>
</ul>
<h3 id="phase-2-mvp-download-features">Phase 2 (MVP - Download Features)<a class="headerlink" href="#phase-2-mvp-download-features" title="Permanent link">¶</a></h3>
<ul>
<li>Enhanced download capabilities</li>
<li>Progress tracking</li>
<li>File management</li>
<li>Error handling</li>
</ul>
<h3 id="development-methodology">Development Methodology<a class="headerlink" href="#development-methodology" title="Permanent link">¶</a></h3>
<p>For each phase, we follow these steps:
1. Write comprehensive test suites first
2. Define clear acceptance criteria
3. Implement minimum code to pass tests
4. Refactor while maintaining coverage
5. Document all components</p>
<h3 id="implementation-timeline">Implementation Timeline<a class="headerlink" href="#implementation-timeline" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Task</th>
<th>Status</th>
<th>Deadline</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test Infrastructure Setup</td>
<td>To Do</td>
<td>2024-05-15</td>
</tr>
<tr>
<td>Basic Discord Integration</td>
<td>To Do</td>
<td>2024-05-22</td>
</tr>
<tr>
<td>Download Commands (Twitter)</td>
<td>To Do</td>
<td>2024-05-29</td>
</tr>
<tr>
<td>Download Commands (Reddit)</td>
<td>To Do</td>
<td>2024-06-05</td>
</tr>
<tr>
<td>Queue Management</td>
<td>To Do</td>
<td>2024-06-12</td>
</tr>
<tr>
<td>Progress Tracking</td>
<td>To Do</td>
<td>2024-06-19</td>
</tr>
</tbody>
</table>
<h3 id="testing-requirements">Testing Requirements<a class="headerlink" href="#testing-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Test coverage must be &gt;= 90%</li>
<li>All error cases must be covered</li>
<li>Performance tests must be included</li>
<li>Integration tests required for each feature</li>
<li>External services must be mocked appropriately</li>
</ul>
<h3 id="quality-gates">Quality Gates<a class="headerlink" href="#quality-gates" title="Permanent link">¶</a></h3>
<p>Each task must pass these gates before being considered complete:
1. All tests passing (unit, integration, performance)
2. Code review completed
3. Documentation updated
4. Test coverage meets minimum threshold
5. Performance metrics within acceptable ranges
6. All error handling scenarios tested
7. Clean code principles verified
8. Type hints and docstrings complete
</p>
<p><discord_integration></discord_integration></p>
<h2 id="discord-integration-and-download-system">Discord Integration and Download System<a class="headerlink" href="#discord-integration-and-download-system" title="Permanent link">¶</a></h2>
<h3 id="1-discord-bot-configuration">1. Discord Bot Configuration<a class="headerlink" href="#1-discord-bot-configuration" title="Permanent link">¶</a></h3>
<h4 id="required-intents">Required Intents<a class="headerlink" href="#required-intents" title="Permanent link">¶</a></h4>
<ul>
<li>message_content</li>
<li>guilds</li>
<li>members</li>
<li>messages</li>
<li>reactions</li>
</ul>
<h4 id="command-structure_2">Command Structure<a class="headerlink" href="#command-structure_2" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$dlt <url></url></td>
<td>Twitter/video downloads</td>
</tr>
<tr>
<td>$dlr <url></url></td>
<td>Reddit downloads</td>
</tr>
<tr>
<td>$dlq</td>
<td>Show queue status</td>
</tr>
<tr>
<td>$dlc</td>
<td>Cancel download</td>
</tr>
</tbody>
</table>
<h4 id="permission-model">Permission Model<a class="headerlink" href="#permission-model" title="Permanent link">¶</a></h4>
<ul>
<li>Role-based access control</li>
<li>Download size limits per role</li>
<li>Queue priority handling</li>
</ul>
<h3 id="2-download-system-architecture">2. Download System Architecture<a class="headerlink" href="#2-download-system-architecture" title="Permanent link">¶</a></h3>
<h4 id="download-manager">Download Manager<a class="headerlink" href="#download-manager" title="Permanent link">¶</a></h4>
<ul>
<li>Async download queue implementation</li>
<li>Real-time progress tracking</li>
<li>Rate limiting and throttling</li>
<li>Concurrent download limits (max 5)</li>
</ul>
<h4 id="file-management_1">File Management<a class="headerlink" href="#file-management_1" title="Permanent link">¶</a></h4>
<ul>
<li>Temporary storage handling with cleanup</li>
<li>Automatic file cleanup after successful upload</li>
<li>File size validation (max 50MB - Discord limit)</li>
<li>Format verification and validation</li>
</ul>
<h3 id="3-error-handling-and-recovery">3. Error Handling and Recovery<a class="headerlink" href="#3-error-handling-and-recovery" title="Permanent link">¶</a></h3>
<ul>
<li>Network failure recovery with automatic retries</li>
<li>Invalid URL handling with user feedback</li>
<li>File system error management</li>
<li>Rate limit handling with exponential backoff</li>
<li>Queue overflow management with priority system</li>
</ul>
<h3 id="4-performance-requirements">4. Performance Requirements<a class="headerlink" href="#4-performance-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Download initiation response: &lt; 1 second</li>
<li>Queue status updates: Every 5 seconds</li>
<li>Maximum queue size: 50 items</li>
<li>Concurrent downloads: 5 max</li>
<li>File size limits: 50MB (Discord limit)</li>
<li>Memory usage: &lt; 500MB under load</li>
<li>CPU usage: &lt; 50% under load</li>
</ul>
<h3 id="5-integration-points">5. Integration Points<a class="headerlink" href="#5-integration-points" title="Permanent link">¶</a></h3>
<ul>
<li>Discord.py event system</li>
<li>Gallery-dl integration for media downloads</li>
<li>File system for temporary storage</li>
<li>Discord CDN for file uploads</li>
<li>Rate limiting systems
</li>
</ul>
<p><test_strategy></test_strategy></p>
<h2 id="test-driven-development-strategy">Test-Driven Development Strategy<a class="headerlink" href="#test-driven-development-strategy" title="Permanent link">¶</a></h2>
<h3 id="1-core-test-infrastructure">1. Core Test Infrastructure<a class="headerlink" href="#1-core-test-infrastructure" title="Permanent link">¶</a></h3>
<h4 id="test-fixtures_1">Test Fixtures<a class="headerlink" href="#test-fixtures_1" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_bot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Core bot fixture for Discord command testing."""</span>
    <span class="n">intents</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">Intents</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
    <span class="n">intents</span><span class="o">.</span><span class="n">message_content</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">Bot</span><span class="p">(</span><span class="n">command_prefix</span><span class="o">=</span><span class="s2">"$"</span><span class="p">,</span> <span class="n">intents</span><span class="o">=</span><span class="n">intents</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">_async_setup_hook</span><span class="p">()</span>
    <span class="n">dpytest</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">bot</span>
    <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">empty_queue</span><span class="p">()</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_downloader</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Mock downloader for testing download functionality."""</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">'bot.download.Downloader'</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">mock</span>
</code></pre></div>
<h3 id="2-command-testing-strategy">2. Command Testing Strategy<a class="headerlink" href="#2-command-testing-strategy" title="Permanent link">¶</a></h3>
<h4 id="download-command-tests">Download Command Tests<a class="headerlink" href="#download-command-tests" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestDownloadCommands</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_valid_twitter_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">,</span> <span class="n">mock_downloader</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">()</span>
        <span class="n">mock_downloader</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"not_a_url"</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Invalid URL"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_queue_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">,</span> <span class="n">mock_downloader</span><span class="p">):</span>
        <span class="n">mock_downloader</span><span class="o">.</span><span class="n">queue_size</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Queue full"</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-integration-testing">3. Integration Testing<a class="headerlink" href="#3-integration-testing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestDownloadFlow</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_download_to_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">,</span> <span class="n">mock_downloader</span><span class="p">):</span>
        <span class="c1"># Given</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>
        <span class="n">mock_downloader</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s2">"file.mp4"</span>

        <span class="c1"># When</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Then</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Started"</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Complete"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">"file.mp4"</span><span class="p">)</span>
</code></pre></div>
<h3 id="4-error-case-testing">4. Error Case Testing<a class="headerlink" href="#4-error-case-testing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestErrorHandling</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_network_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">,</span> <span class="n">mock_downloader</span><span class="p">):</span>
        <span class="n">mock_downloader</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">NetworkError</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Network error"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">,</span> <span class="n">mock_downloader</span><span class="p">):</span>
        <span class="n">mock_downloader</span><span class="o">.</span><span class="n">download</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">RateLimitError</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://twitter.com/user/status/123"</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"Rate limited"</span><span class="p">)</span>
</code></pre></div>
<h3 id="5-performance-testing">5. Performance Testing<a class="headerlink" href="#5-performance-testing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestPerformance</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_response_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s2">"$dlt url"</span><span class="p">)</span>
        <span class="n">response_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">assert</span> <span class="n">response_time</span> <span class="o">&lt;</span> <span class="mf">1.0</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_concurrent_downloads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_bot</span><span class="p">):</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"url</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">dpytest</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$dlt </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">mock_downloader</span><span class="o">.</span><span class="n">active_downloads</span> <span class="o">&lt;=</span> <span class="mi">5</span>
</code></pre></div>
<h3 id="6-test-coverage-requirements">6. Test Coverage Requirements<a class="headerlink" href="#6-test-coverage-requirements" title="Permanent link">¶</a></h3>
<ul>
<li>Unit Tests:</li>
<li>All command handlers</li>
<li>Queue management</li>
<li>File operations</li>
<li>Error handlers</li>
<li>
<p>Permission checks</p>
</li>
<li>
<p>Integration Tests:</p>
</li>
<li>End-to-end download flows</li>
<li>Discord message handling</li>
<li>File upload process</li>
<li>
<p>Queue management system</p>
</li>
<li>
<p>Performance Tests:</p>
</li>
<li>Response times</li>
<li>Concurrent operations</li>
<li>Memory usage</li>
<li>CPU utilization</li>
<li>Network bandwidth</li>
</ul>
<h3 id="7-testing-best-practices">7. Testing Best Practices<a class="headerlink" href="#7-testing-best-practices" title="Permanent link">¶</a></h3>
<ul>
<li>Use pytest markers for test categorization</li>
<li>Implement proper cleanup in fixtures</li>
<li>Mock external dependencies</li>
<li>Use parameterized tests for edge cases</li>
<li>Maintain test isolation</li>
<li>Follow AAA pattern (Arrange-Act-Assert)</li>
<li>Document test purposes and scenarios</li>
<li>Regular test execution in CI/CD pipeline</li>
</ul>
<h3 id="test-infrastructure_1">Test Infrastructure<a class="headerlink" href="#test-infrastructure_1" title="Permanent link">¶</a></h3>
<h4 id="directory-structure_1">Directory Structure<a class="headerlink" href="#directory-structure_1" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code>tests/
├── conftest.py              # Shared test configuration and fixtures
├── fixtures/               # Test data and mock responses
│   ├── tweet_data.py      # Twitter API mock responses
│   ├── reddit_data.py     # Reddit API mock responses
│   ├── discord_data.py    # Discord API mock responses
│   └── cassettes/         # VCR cassettes for HTTP mocking
├── unit/                  # Unit tests directory
├── integration/          # Integration tests
└── eval/                # Future RAG evaluation tests
</code></pre></div>
<h4 id="test-data-management_1">Test Data Management<a class="headerlink" href="#test-data-management_1" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Example test fixture in tests/fixtures/tweet_data.py</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_tweet_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Sample tweet data for testing."""</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://twitter.com/user/status/123"</span><span class="p">,</span>
        <span class="s2">"media"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"video.mp4"</span><span class="p">],</span>
        <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"Sample tweet"</span>
    <span class="p">}</span>

<span class="c1"># Example VCR configuration in conftest.py</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"module"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vcr_config</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""VCR configuration for HTTP interaction recording."""</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"filter_headers"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"authorization"</span><span class="p">],</span>
        <span class="s2">"filter_post_data_parameters"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"token"</span><span class="p">,</span> <span class="s2">"api_key"</span><span class="p">],</span>
        <span class="s2">"match_on"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"method"</span><span class="p">,</span> <span class="s2">"scheme"</span><span class="p">,</span> <span class="s2">"host"</span><span class="p">,</span> <span class="s2">"port"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">,</span> <span class="s2">"query"</span><span class="p">]</span>
    <span class="p">}</span>
</code></pre></div>
<h4 id="coverage-requirements-mvp">Coverage Requirements (MVP)<a class="headerlink" href="#coverage-requirements-mvp" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Component</th>
<th>Target Coverage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Core Download</td>
<td>30%</td>
</tr>
<tr>
<td>Command Parsing</td>
<td>25%</td>
</tr>
<tr>
<td>Discord Events</td>
<td>20%</td>
</tr>
<tr>
<td>File Management</td>
<td>20%</td>
</tr>
</tbody>
</table>
<p>Note: These are minimum targets for MVP. Higher coverage will be required for critical paths.
</p>
<p><technical_implementation></technical_implementation></p>
<h2 id="technical-implementation-details">Technical Implementation Details<a class="headerlink" href="#technical-implementation-details" title="Permanent link">¶</a></h2>
<h3 id="error-handling-mvp">Error Handling (MVP)<a class="headerlink" href="#error-handling-mvp" title="Permanent link">¶</a></h3>
<h4 id="core-error-types">Core Error Types<a class="headerlink" href="#core-error-types" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BotErrorType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Core error types for MVP."""</span>
    <span class="n">DOWNLOAD_FAILED</span> <span class="o">=</span> <span class="s2">"download_failed"</span>
    <span class="n">INVALID_URL</span> <span class="o">=</span> <span class="s2">"invalid_url"</span>
    <span class="n">QUEUE_FULL</span> <span class="o">=</span> <span class="s2">"queue_full"</span>
    <span class="n">FILE_TOO_LARGE</span> <span class="o">=</span> <span class="s2">"file_too_large"</span>
    <span class="n">DISCORD_ERROR</span> <span class="o">=</span> <span class="s2">"discord_error"</span>
</code></pre></div>
<h3 id="logging-configuration_1">Logging Configuration<a class="headerlink" href="#logging-configuration_1" title="Permanent link">¶</a></h3>
<p>The application uses Loguru for structured logging with the following configuration:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>

<span class="c1"># Remove default handler</span>
<span class="n">logger</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="c1"># Configure Loguru</span>
<span class="n">logger</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"sink"</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="s2">"format"</span><span class="p">:</span> <span class="s2">"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | &lt;level&gt;</span><span class="si">{level: &lt;8}</span><span class="s2">&lt;/level&gt; | &lt;cyan&gt;</span><span class="si">{name}</span><span class="s2">&lt;/cyan&gt;:&lt;cyan&gt;</span><span class="si">{function}</span><span class="s2">&lt;/cyan&gt;:&lt;cyan&gt;</span><span class="si">{line}</span><span class="s2">&lt;/cyan&gt; - &lt;level&gt;</span><span class="si">{message}</span><span class="s2">&lt;/level&gt;"</span><span class="p">,</span>
            <span class="s2">"level"</span><span class="p">:</span> <span class="s2">"INFO"</span><span class="p">,</span>
            <span class="s2">"colorize"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"backtrace"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"diagnose"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"enqueue"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Add better exception handling</span>
<span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">"</span><span class="si">{time}</span><span class="s2"> | </span><span class="si">{level}</span><span class="s2"> | </span><span class="si">{message}</span><span class="s2">"</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">record</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s2">"level"</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ERROR"</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">"ERROR"</span><span class="p">,</span>
    <span class="n">backtrace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">diagnose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Example logging usage</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Bot starting up..."</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Processing download request: </span><span class="si">{url}</span><span class="s2">"</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s2">"https://example.com"</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Rate limit approaching: </span><span class="si">{limit}</span><span class="s2">"</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Download failed: </span><span class="si">{error}</span><span class="s2">"</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">"Network timeout"</span><span class="p">)</span>
</code></pre></div>
<h4 id="log-levels">Log Levels<a class="headerlink" href="#log-levels" title="Permanent link">¶</a></h4>
<ul>
<li>DEBUG: Detailed information for debugging</li>
<li>INFO: General operational events</li>
<li>WARNING: Unexpected but handled situations</li>
<li>ERROR: Errors that need attention</li>
<li>CRITICAL: System-level failures</li>
</ul>
<h4 id="logging-guidelines">Logging Guidelines<a class="headerlink" href="#logging-guidelines" title="Permanent link">¶</a></h4>
<ol>
<li>
<p>Use structured logging with context:
   <div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Download started"</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p>Include relevant context in errors:
   <div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Download failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p>Use appropriate log levels:</p>
</li>
<li>DEBUG: Detailed flow information</li>
<li>INFO: Normal operations</li>
<li>WARNING: Potential issues</li>
<li>ERROR: Operation failures</li>
<li>
<p>CRITICAL: System failures</p>
</li>
<li>
<p>Log sensitive information appropriately:
   <div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
    <span class="s2">"Processing user request"</span><span class="p">,</span>
    <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>  <span class="c1"># OK to log</span>
    <span class="c1"># Never log tokens or passwords</span>
<span class="p">)</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="performance-metrics-mvp">Performance Metrics (MVP)<a class="headerlink" href="#performance-metrics-mvp" title="Permanent link">¶</a></h3>
<h4 id="key-metrics">Key Metrics<a class="headerlink" href="#key-metrics" title="Permanent link">¶</a></h4>
<ol>
<li>
<p><strong>Essential Metrics</strong>:
   <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CoreMetrics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Essential performance metrics."""</span>
    <span class="n">download_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">failed_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">active_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Basic Monitoring</strong>:</p>
</li>
<li>Queue length tracking</li>
<li>Download success/failure rates</li>
<li>Basic response time logging</li>
</ol>
<p>Nice to Have (Post-MVP):
- Detailed performance analytics
- Real-time monitoring dashboard
- Resource usage tracking
- Per-guild metrics</p>
<h3 id="api-documentation-mvp">API Documentation (MVP)<a class="headerlink" href="#api-documentation-mvp" title="Permanent link">¶</a></h3>
<h4 id="documentation-approach">Documentation Approach<a class="headerlink" href="#documentation-approach" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Code Documentation</strong>:</li>
<li>Google-style docstrings</li>
<li>Type hints for all functions</li>
<li>
<p>Basic README with setup instructions</p>
</li>
<li>
<p><strong>Command Documentation</strong>:</p>
</li>
<li>Help command with usage examples</li>
<li>Basic command parameter descriptions</li>
<li>Error message documentation</li>
</ol>
<p>Example Docstring Format:
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_media</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DownloadResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Download media from supported platforms.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: The URL to download from (Twitter or Reddit)</span>
<span class="sd">        user_id: Discord user ID requesting the download</span>

<span class="sd">    Returns:</span>
<span class="sd">        DownloadResult containing file path and metadata</span>

<span class="sd">    Raises:</span>
<span class="sd">        DownloadError: If download fails or URL is invalid</span>
<span class="sd">        QueueFullError: If download queue is full</span>
<span class="sd">    """</span>
</code></pre></div></p>
<p>Nice to Have (Post-MVP):
- Auto-generated API documentation
- Interactive command examples
- Detailed troubleshooting guides
- API versioning documentation</p>
<h3 id="deployment-strategy-mvp">Deployment Strategy (MVP)<a class="headerlink" href="#deployment-strategy-mvp" title="Permanent link">¶</a></h3>
<h4 id="initial-deployment">Initial Deployment<a class="headerlink" href="#initial-deployment" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Requirements</strong>:</li>
<li>Python 3.11+</li>
<li>Discord Bot Token</li>
<li>Basic environment variables</li>
<li>
<p>Storage directory setup</p>
</li>
<li>
<p><strong>Deployment Steps</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Setup</span>
uv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
uv<span class="w"> </span>sync<span class="w"> </span>--dev

<span class="c1"># Run</span>
uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>boss_bot
</code></pre></div></p>
</li>
<li>
<p><strong>Environment Variables</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Required for MVP</span>
<span class="nv">DISCORD_TOKEN</span><span class="o">=</span>required<span class="w">                </span><span class="c1"># Discord bot authentication token</span>
<span class="nv">DISCORD_CLIENT_ID</span><span class="o">=</span>required<span class="w">           </span><span class="c1"># Discord application client ID</span>
<span class="nv">DISCORD_SERVER_ID</span><span class="o">=</span>required<span class="w">           </span><span class="c1"># Target Discord server ID</span>
<span class="nv">DISCORD_ADMIN_USER_ID</span><span class="o">=</span>required<span class="w">       </span><span class="c1"># Admin user ID for bot management</span>
<span class="nv">DISCORD_ADMIN_USER_INVITED</span><span class="o">=</span>optional<span class="w">  </span><span class="c1"># Track if admin user is invited</span>

<span class="c1"># Debug and Development (Optional for MVP)</span>
<span class="nv">BETTER_EXCEPTIONS</span><span class="o">=</span><span class="m">1</span><span class="w">                  </span><span class="c1"># Enhanced exception formatting</span>
<span class="nv">DEBUG_AIDER</span><span class="o">=</span><span class="m">0</span><span class="w">                        </span><span class="c1"># Additional debug information</span>
<span class="nv">LOCAL_TEST_DEBUG</span><span class="o">=</span><span class="m">0</span><span class="w">                   </span><span class="c1"># Local testing mode</span>
<span class="nv">LOCAL_TEST_ENABLE_EVALS</span><span class="o">=</span><span class="m">0</span><span class="w">           </span><span class="c1"># Enable evaluation tests</span>
<span class="nv">PYTHON_DEBUG</span><span class="o">=</span><span class="m">0</span><span class="w">                       </span><span class="c1"># Python debug mode</span>
<span class="nv">PYTHONASYNCIODEBUG</span><span class="o">=</span><span class="m">0</span><span class="w">                </span><span class="c1"># AsyncIO debug mode</span>

<span class="c1"># Monitoring and Error Tracking (Optional for MVP)</span>
<span class="nv">ENABLE_SENTRY</span><span class="o">=</span><span class="m">0</span><span class="w">                      </span><span class="c1"># Enable Sentry error tracking</span>
<span class="nv">SENTRY_DSN</span><span class="o">=</span>optional<span class="w">                  </span><span class="c1"># Sentry DSN if enabled</span>

<span class="c1"># Future Features (Post-MVP)</span>
<span class="c1">## AI Integration</span>
<span class="nv">ENABLE_AI</span><span class="o">=</span><span class="m">0</span><span class="w">                          </span><span class="c1"># Enable AI features</span>
<span class="nv">ANTHROPIC_API_KEY</span><span class="o">=</span>optional<span class="w">          </span><span class="c1"># Anthropic API access</span>
<span class="nv">COHERE_API_KEY</span><span class="o">=</span>optional<span class="w">             </span><span class="c1"># Cohere API access</span>
<span class="nv">OPENAI_API_KEY</span><span class="o">=</span>optional<span class="w">             </span><span class="c1"># OpenAI API access</span>

<span class="c1">## LangChain Integration</span>
<span class="nv">LANGCHAIN_API_KEY</span><span class="o">=</span>optional<span class="w">          </span><span class="c1"># LangChain API access</span>
<span class="nv">LANGCHAIN_DEBUG_LOGS</span><span class="o">=</span><span class="m">0</span><span class="w">              </span><span class="c1"># LangChain debug logging</span>
<span class="nv">LANGCHAIN_ENDPOINT</span><span class="o">=</span>optional<span class="w">         </span><span class="c1"># LangChain API endpoint</span>
<span class="nv">LANGCHAIN_HUB_API_KEY</span><span class="o">=</span>optional<span class="w">      </span><span class="c1"># LangChain Hub access</span>
<span class="nv">LANGCHAIN_HUB_API_URL</span><span class="o">=</span>optional<span class="w">      </span><span class="c1"># LangChain Hub URL</span>
<span class="nv">LANGCHAIN_PROJECT</span><span class="o">=</span>optional<span class="w">          </span><span class="c1"># LangChain project name</span>
<span class="nv">LANGCHAIN_TRACING_V2</span><span class="o">=</span><span class="m">0</span><span class="w">             </span><span class="c1"># LangChain tracing</span>

<span class="c1">## Vector Store</span>
<span class="nv">ENABLE_REDIS</span><span class="o">=</span><span class="m">0</span><span class="w">                      </span><span class="c1"># Enable Redis vector store</span>
<span class="nv">PINECONE_API_KEY</span><span class="o">=</span>optional<span class="w">          </span><span class="c1"># Pinecone API access</span>
<span class="nv">PINECONE_ENV</span><span class="o">=</span>optional<span class="w">              </span><span class="c1"># Pinecone environment</span>
<span class="nv">PINECONE_INDEX</span><span class="o">=</span>optional<span class="w">            </span><span class="c1"># Pinecone index name</span>

<span class="c1">## Additional Services</span>
<span class="nv">FIRECRAWL_API_KEY</span><span class="o">=</span>optional<span class="w">         </span><span class="c1"># Firecrawl API access</span>
<span class="nv">TAVILY_API_KEY</span><span class="o">=</span>optional<span class="w">            </span><span class="c1"># Tavily API access</span>
<span class="nv">UNSTRUCTURED_API_KEY</span><span class="o">=</span>optional<span class="w">      </span><span class="c1"># Unstructured API access</span>
<span class="nv">UNSTRUCTURED_API_URL</span><span class="o">=</span>optional<span class="w">      </span><span class="c1"># Unstructured API endpoint</span>
</code></pre></div></p>
</li>
</ol>
<p>Nice to Have (Post-MVP):
- Docker deployment
- CI/CD pipeline
- Multiple environment support
- Automated backups
- Rolling updates
</p>
<p><tech_decisions></tech_decisions></p>
<h3 id="core-technical-decisions">Core Technical Decisions<a class="headerlink" href="#core-technical-decisions" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Test-Driven Development</strong>
<decision>
Implement strict TDD practices with comprehensive test coverage
</decision>
<rationale></rationale></li>
<li>Ensures code reliability</li>
<li>Facilitates junior developer onboarding</li>
<li>Prevents regression issues</li>
<li>
<p>Makes refactoring safer
</p>
</li>
<li>
<p><strong>Queue Management</strong>
<decision>
Implement asynchronous download queue with priority system
</decision>
<rationale></rationale></p>
</li>
<li>Prevents server overload</li>
<li>Provides fair resource allocation</li>
<li>Enables premium user prioritization</li>
<li>
<p>Allows for graceful error handling
</p>
</li>
<li>
<p><strong>Storage Architecture</strong>
<decision>
Implement hierarchical storage with temporary and organized sections
</decision>
<rationale></rationale></p>
</li>
<li>Enables efficient cleanup</li>
<li>Provides clear organization</li>
<li>Supports quota management</li>
<li>
<p>Facilitates error recovery
</p>
</li>
<li>
<p><strong>Error Handling</strong>
<decision>
Implement comprehensive error handling with retry mechanisms
</decision>
<rationale></rationale></p>
</li>
<li>Improves user experience</li>
<li>Handles network instability</li>
<li>Provides clear error messages</li>
<li>
<p>Supports automatic recovery
</p>
</li>
<li>
<p><strong>Monitoring System</strong>
<decision>
Implement Prometheus metrics with detailed logging
</decision>
<rationale></rationale></p>
</li>
<li>Enables performance tracking</li>
<li>Facilitates debugging</li>
<li>Provides usage analytics</li>
<li>Supports capacity planning

</li>
</ol>
<p><acceptance_criteria></acceptance_criteria></p>
<h3 id="core-acceptance-criteria">Core Acceptance Criteria<a class="headerlink" href="#core-acceptance-criteria" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Download Functionality</strong></li>
<li>Successfully downloads media from Twitter and Reddit</li>
<li>Provides real-time progress updates</li>
<li>Handles errors gracefully with clear messages</li>
<li>
<p>Respects Discord file size limits</p>
</li>
<li>
<p><strong>Queue Management</strong></p>
</li>
<li>Maintains ordered download queue</li>
<li>Shows accurate queue position and ETA</li>
<li>Allows download cancellation</li>
<li>
<p>Handles concurrent downloads properly</p>
</li>
<li>
<p><strong>User Experience</strong></p>
</li>
<li>Commands respond within 2 seconds</li>
<li>Progress updates are clear and accurate</li>
<li>Error messages are user-friendly</li>
<li>
<p>Help documentation is comprehensive</p>
</li>
<li>
<p><strong>System Stability</strong></p>
</li>
<li>Maintains 99% uptime</li>
<li>Recovers from errors automatically</li>
<li>Handles Discord API outages gracefully</li>
<li>Manages resources efficiently
</li>
</ol>
<p><future_considerations></future_considerations></p>
<h3 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">¶</a></h3>
<ol>
<li><strong>RAG Integration</strong></li>
<li>LangChain and LangGraph integration</li>
<li>Vector store setup with Redis</li>
<li>Enhanced command set for AI features</li>
<li>
<p>Document indexing and retrieval</p>
</li>
<li>
<p><strong>Premium Features</strong></p>
</li>
<li>Priority queue access</li>
<li>Higher concurrent download limits</li>
<li>Extended file retention</li>
<li>
<p>Custom download preferences</p>
</li>
<li>
<p><strong>Advanced Monitoring</strong></p>
</li>
<li>Real-time dashboard</li>
<li>Advanced analytics</li>
<li>Performance optimization</li>
<li>
<p>Capacity planning tools</p>
</li>
<li>
<p><strong>Platform Extensions</strong></p>
</li>
<li>Support for additional media platforms</li>
<li>Custom media processing options</li>
<li>Batch download capabilities</li>
<li>Format conversion options
</li>
</ol>
<p><technical_debt></technical_debt></p>
<h3 id="known-technical-debt">Known Technical Debt<a class="headerlink" href="#known-technical-debt" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Testing Coverage</strong></li>
<li>Initial MVP coverage targets are minimal</li>
<li>Some Discord events can't be fully tested</li>
<li>Integration tests need expansion</li>
<li>
<p>Performance testing framework needed</p>
</li>
<li>
<p><strong>Error Handling</strong></p>
</li>
<li>Basic retry mechanism needs enhancement</li>
<li>More granular error categorization needed</li>
<li>Better rate limit handling required</li>
<li>
<p>Extended logging for debugging</p>
</li>
<li>
<p><strong>Documentation</strong></p>
</li>
<li>API documentation needs expansion</li>
<li>More code examples needed</li>
<li>Troubleshooting guide required</li>
<li>Architecture documentation needed
</li>
</ol>
<hr/>
<h1 id="file-stories-epic-1-epic-md">.ai/stories/epic-1.epic.md</h1>
<h1 id="epic-1-core-bot-infrastructure_1">Epic-1: Core Bot Infrastructure<a class="headerlink" href="#epic-1-core-bot-infrastructure_1" title="Permanent link">¶</a></h1>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">¶</a></h2>
<p>In Progress</p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">¶</a></h2>
<p>This epic focuses on establishing the foundational infrastructure for the Boss-Bot Discord media download assistant, following the requirements specified in the PRD. It includes setting up the development environment, implementing the core bot framework, establishing error handling and logging systems, and creating a comprehensive testing infrastructure.</p>
<h2 id="goals_1">Goals<a class="headerlink" href="#goals_1" title="Permanent link">¶</a></h2>
<ul>
<li>Establish a solid development foundation with proper tooling and standards</li>
<li>Implement core Discord bot functionality with proper event handling</li>
<li>Set up comprehensive testing infrastructure with PRD-specified coverage targets</li>
<li>Implement robust error handling and logging systems using loguru and better-exceptions</li>
<li>Establish secure file management and storage infrastructure</li>
<li>Configure comprehensive monitoring and metrics collection</li>
</ul>
<h2 id="success-criteria">Success Criteria<a class="headerlink" href="#success-criteria" title="Permanent link">¶</a></h2>
<ol>
<li>Development environment is fully configured and documented</li>
<li>Python 3.12+ environment setup</li>
<li>UV package management configured</li>
<li>✅ Ruff linting and formatting setup via pre-commit</li>
<li>✅ Pre-commit hooks installed and configured</li>
<li>
<p>CI/CD pipeline operational</p>
</li>
<li>
<p>Discord bot connects and responds to basic commands</p>
</li>
<li>Command response time &lt;2s</li>
<li>Proper error handling with better-exceptions</li>
<li>Clear user feedback for all operations</li>
<li>Type hints and docstrings for all code</li>
<li>Maximum concurrent downloads: 5</li>
<li>Maximum queue size: 50 items</li>
<li>
<p>Maximum file size: 50MB</p>
</li>
<li>
<p>Test infrastructure achieves PRD coverage targets:</p>
</li>
<li>Core Download: 30%</li>
<li>Command Parsing: 25%</li>
<li>Discord Events: 20%</li>
<li>File Management: 20%</li>
<li>VCR/cassette setup for HTTP mocking</li>
<li>
<p>Comprehensive test patterns and examples</p>
</li>
<li>
<p>Error handling and logging provide clear visibility</p>
</li>
<li>Loguru configured for structured logging</li>
<li>Better-exceptions integration</li>
<li>Clear error messages for users</li>
<li>Proper error categorization and handling</li>
<li>Log rotation policies implemented</li>
<li>
<p>Monitoring dashboard setup</p>
</li>
<li>
<p>File management system meets requirements</p>
</li>
<li>Temporary storage structure implemented</li>
<li>Cleanup policies enforced</li>
<li>✅ Storage quotas configured and tested (85% coverage)<ul>
<li>Byte and megabyte reporting</li>
<li>File size limits (50MB)</li>
<li>Concurrent download limits (5)</li>
<li>Usage percentage tracking</li>
</ul>
</li>
<li>✅ File validation implemented (57% coverage)<ul>
<li>File type validation</li>
<li>Name sanitization</li>
<li>Security checks</li>
</ul>
</li>
<li>
<p>Storage usage monitoring active</p>
</li>
<li>
<p>Security measures properly implemented</p>
</li>
<li>Environment variable security</li>
<li>Discord permission scopes</li>
<li>Rate limiting</li>
<li>File validation</li>
<li>Secure storage practices</li>
</ol>
<h2 id="stories">Stories<a class="headerlink" href="#stories" title="Permanent link">¶</a></h2>
<ol>
<li>Project Initialization and Environment Setup</li>
<li>Status: In Progress</li>
<li>✅ File validation implemented with security checks</li>
<li>✅ Storage quota management implemented with limits</li>
<li>Set up project structure following PRD layout</li>
<li>Configure UV for package management</li>
<li>Set up Ruff with PRD-specified rules</li>
<li>Configure pre-commit hooks</li>
<li>Create comprehensive README</li>
<li>Ensure all modules respect 120-line limit</li>
<li>Set up CI/CD pipeline</li>
<li>
<p>Configure development workflow</p>
</li>
<li>
<p>Test Infrastructure Setup</p>
</li>
<li>Status: Not Started</li>
<li>Configure pytest with coverage targets from PRD</li>
<li>Set up test fixtures and utilities</li>
<li>Implement test categorization</li>
<li>Configure coverage reporting</li>
<li>Set up dpytest for Discord testing</li>
<li>Configure VCR for HTTP mocking</li>
<li>Create test patterns and examples</li>
<li>
<p>Set up test automation in CI</p>
</li>
<li>
<p>Logging and Monitoring Setup</p>
</li>
<li>Status: Not Started</li>
<li>Implement loguru with structured logging</li>
<li>Configure better-exceptions</li>
<li>Set up basic performance monitoring</li>
<li>Implement response time tracking</li>
<li>Configure log rotation and management</li>
<li>Set up monitoring dashboard</li>
<li>Configure metrics collection</li>
<li>Implement storage usage tracking</li>
<li>
<p>Set up resource monitoring (CPU, Memory)</p>
</li>
<li>
<p>Basic Discord Bot Setup</p>
</li>
<li>Status: Not Started</li>
<li>Create Discord application and bot</li>
<li>Implement bot client with required intents</li>
<li>Set up environment configuration</li>
<li>Create connection handling</li>
<li>Implement command framework</li>
<li>Add health check command</li>
<li>Ensure &lt;2s response time</li>
<li>Configure rate limiting</li>
<li>
<p>Set up permission scopes</p>
</li>
<li>
<p>Security and Permission Setup</p>
</li>
<li>Status: Not Started</li>
<li>Implement Discord permission scopes</li>
<li>Set up environment variable security</li>
<li>Configure rate limiting</li>
<li>Implement file validation</li>
<li>Set up secure storage practices</li>
<li>Configure access controls</li>
<li>Implement security monitoring</li>
<li>
<p>Set up security logging</p>
</li>
<li>
<p>File Management Infrastructure</p>
</li>
<li>Status: Not Started</li>
<li>Implement temporary storage structure</li>
<li>Set up file cleanup policies</li>
<li>Configure storage quotas</li>
<li>Implement file organization strategy</li>
<li>Set up monitoring for storage usage</li>
<li>Configure backup policies</li>
<li>Implement file validation</li>
<li>Set up cleanup automation</li>
</ol>
<h2 id="technical-requirements">Technical Requirements<a class="headerlink" href="#technical-requirements" title="Permanent link">¶</a></h2>
<ul>
<li>Python 3.12+</li>
<li>UV for package management</li>
<li>Ruff for code quality</li>
<li>Pytest for testing</li>
<li>Discord.py v2.5.2+</li>
<li>Loguru for logging</li>
<li>Better-exceptions for error handling</li>
<li>Gallery-dl for media downloads</li>
<li>Maximum concurrent downloads: 5</li>
<li>Maximum queue size: 50 items</li>
<li>Maximum file size: 50MB</li>
<li>Storage cleanup policies</li>
<li>Rate limiting configuration</li>
<li>Environment variable security</li>
</ul>
<h2 id="monitoring-requirements">Monitoring Requirements<a class="headerlink" href="#monitoring-requirements" title="Permanent link">¶</a></h2>
<ul>
<li>Storage usage tracking</li>
<li>Queue length monitoring</li>
<li>Download speed metrics</li>
<li>Error rate tracking</li>
<li>Response time monitoring</li>
<li>Resource usage monitoring (CPU, Memory)</li>
<li>Security event monitoring</li>
<li>API latency tracking</li>
<li>File system metrics</li>
<li>Queue performance metrics</li>
</ul>
<h2 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">¶</a></h2>
<ul>
<li>None (This is the first epic)</li>
</ul>
<h2 id="risks">Risks<a class="headerlink" href="#risks" title="Permanent link">¶</a></h2>
<ul>
<li>Discord API changes could affect implementation</li>
<li>Test coverage targets may be challenging for Discord events</li>
<li>Integration testing complexity with Discord API</li>
<li>Response time requirements may be challenging under load</li>
<li>Storage management complexity</li>
<li>Security configuration complexity</li>
<li>Rate limiting edge cases</li>
<li>File system performance under load</li>
</ul>
<h2 id="notes_2">Notes<a class="headerlink" href="#notes_2" title="Permanent link">¶</a></h2>
<ul>
<li>Follow TDD practices strictly</li>
<li>Maintain clear documentation</li>
<li>Ensure all code has proper type hints and docstrings</li>
<li>Keep modules under 120 lines</li>
<li>Use async/await patterns consistently</li>
<li>Implement proper error handling with better-exceptions</li>
<li>Use loguru for structured logging</li>
<li>Follow security best practices</li>
<li>Maintain comprehensive monitoring</li>
<li>Regular security reviews</li>
</ul>
<h2 id="timeline">Timeline<a class="headerlink" href="#timeline" title="Permanent link">¶</a></h2>
<p>Estimated completion: 2024-05-22</p>
<h2 id="progress-tracking">Progress Tracking<a class="headerlink" href="#progress-tracking" title="Permanent link">¶</a></h2>
<ul class="task-list">
<li>[🚧] Story 1: Project Initialization</li>
<li>✅ File validation (57% coverage)</li>
<li>✅ Storage quotas (96% coverage)</li>
<li>✅ Storage directory structure (100% coverage)</li>
<li>✅ Development environment (Ruff + pre-commit)</li>
<li>🚧 Project structure</li>
<li>❌ CI/CD pipeline</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> Story 2: Test Infrastructure</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> Story 3: Logging Setup</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> Story 4: Discord Bot Setup</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> Story 5: Security Setup</li>
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> Story 6: File Management</li>
</ul>
<h2 id="related-documents">Related Documents<a class="headerlink" href="#related-documents" title="Permanent link">¶</a></h2>
<ul>
<li>PRD: .ai/prd.md</li>
<li>Architecture: .ai/arch.md</li>
<li>Current Story: .ai/story-1.story.md</li>
</ul>
<h2 id="implementation-status">Implementation Status<a class="headerlink" href="#implementation-status" title="Permanent link">¶</a></h2>
<h3 id="completed-features">Completed Features<a class="headerlink" href="#completed-features" title="Permanent link">¶</a></h3>
<ul>
<li>✅ Development environment configuration</li>
<li>Ruff linting and formatting via pre-commit</li>
<li>Comprehensive pre-commit hook setup</li>
<li>Multiple git hooks (pre-commit, commit-msg, pre-push)</li>
<li>Project validation and security scanning</li>
<li>✅ Storage quota management system</li>
<li>Implemented 50MB file size limit</li>
<li>Added 5 concurrent downloads limit</li>
<li>Created comprehensive test suite (96% coverage)</li>
<li>Added detailed status reporting with byte/MB metrics</li>
<li>✅ File validation system</li>
<li>Added file type validation</li>
<li>Implemented filename sanitization</li>
<li>Added path traversal detection</li>
<li>Created test suite (57% coverage)</li>
<li>✅ Temporary storage structure</li>
<li>Created downloads directory hierarchy</li>
<li>Implemented idempotent directory creation</li>
<li>Added file preservation logic</li>
<li>Created comprehensive test suite (100% coverage)</li>
</ul>
<h3 id="in-progress">In Progress<a class="headerlink" href="#in-progress" title="Permanent link">¶</a></h3>
<ul>
<li>🚧 Project structure setup</li>
<li>🚧 Documentation setup</li>
<li>❌ CI/CD pipeline</li>
</ul>
<h3 id="deferred-to-phase-2">Deferred to Phase 2<a class="headerlink" href="#deferred-to-phase-2" title="Permanent link">¶</a></h3>
<ul>
<li>File cleanup policies</li>
<li>Enhanced error handling</li>
<li>Monitoring dashboards</li>
<li>Backup configuration</li>
<li>Storage monitoring</li>
</ul>
<h3 id="deferred-to-phase-3">Deferred to Phase 3<a class="headerlink" href="#deferred-to-phase-3" title="Permanent link">¶</a></h3>
<ul>
<li>Storage security configuration</li>
<li>Rate limiting</li>
</ul>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<ol>
<li>Implement core download functionality</li>
<li>Set up basic queue management</li>
<li>Add essential error handling</li>
<li>Implement basic metrics/monitoring</li>
</ol>
<hr/>
<h1 id="file-stories-story-1-story-md">.ai/stories/story-1.story.md</h1>
<?xml version="1.0" encoding="UTF-8"?>
<p><document></document></p>
<p><document-metadata></document-metadata></p>
<h1 id="epic-1-story-1">Epic-1 - Story-1<a class="headerlink" href="#epic-1-story-1" title="Permanent link">¶</a></h1>
<h1 id="project-initialization-and-environment-setup">Project Initialization and Environment Setup<a class="headerlink" href="#project-initialization-and-environment-setup" title="Permanent link">¶</a></h1>
<p><strong>As a</strong> developer
<strong>I want</strong> to set up the initial project structure and development environment with security and monitoring foundations
<strong>so that</strong> we have a solid, secure, and observable foundation for building the Boss-Bot Discord media download assistant
</p>
<p><section-status></section-status></p>
<h2 id="status_1">Status<a class="headerlink" href="#status_1" title="Permanent link">¶</a></h2>
<p>In Progress
</p>
<p><table-of-contents>
- <a href="#status">Status</a>
- <a href="#context">Context</a>
- <a href="#estimation">Estimation</a>
- <a href="#tasks">Tasks</a>
- <a href="#deferred-tasks">Deferred Tasks</a>
- <a href="#constraints">Constraints</a>
- <a href="#data-models--schema">Data Models / Schema</a>
- <a href="#structure">Structure</a>
- <a href="#diagrams">Diagrams</a>
- <a href="#dev-notes">Dev Notes</a>
- <a href="#chat-command-log">Chat Command Log</a>
- <a href="#implementation-evidence">Implementation Evidence</a>
</table-of-contents></p>
<p><section-context></section-context></p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">¶</a></h2>
<p>This is the first story of Epic-1 (Core Bot Infrastructure) which sets up the foundational project structure and development environment. This story is critical as it establishes:</p>
<ul>
<li>Basic project structure following the defined layout ✅</li>
<li>Development environment configuration 🚧</li>
<li>Code quality tools and standards ✅</li>
<li>Initial test infrastructure 🚧</li>
<li>Documentation foundation ❌</li>
<li>Security baseline 🚧</li>
<li>Monitoring setup ✅</li>
<li>CI/CD pipeline foundation ❌</li>
</ul>
<p><subsection-technical-decisions>
Key technical decisions from the PRD and architecture documents:
- Python 3.12 as the primary development language ✅
- UV for package management ✅
- Ruff for code quality ✅
- Pytest for testing infrastructure ✅
- Comprehensive test coverage targets for MVP ✅ (Current: 56.16%, exceeding MVP targets)
- Loguru for logging ✅
- Better-exceptions for error handling ✅
- Security-first approach with proper environment variable handling 🚧
- Monitoring and metrics collection from the start ✅
</subsection-technical-decisions>
</p>
<p><section-estimation></section-estimation></p>
<h2 id="estimation">Estimation<a class="headerlink" href="#estimation" title="Permanent link">¶</a></h2>
<p>Story Points: 5 (5 days human development = 50 minutes AI development)
Increased from 3 to 5 points due to additional security, monitoring, and CI/CD requirements.
</p>
<p><section-tasks></section-tasks></p>
<h2 id="tasks">Tasks<a class="headerlink" href="#tasks" title="Permanent link">¶</a></h2>
<p><task-group-project-initialization>
1. - [🚧] Initialize Python Project
   1. - [✅] Create project structure following PRD layout
   2. - [✅] Set up pyproject.toml with initial dependencies
   3. - [✅] Configure UV for package management
      * ✅ UV v0.6.13 installed and configured
      * ✅ Dependencies properly managed in pyproject.toml
      * ✅ Dev dependencies correctly configured
      * ✅ UV workspace setup complete
   4. - [✅] Create initial README.md with setup instructions
   5. - [✅] Set up secure environment variable handling
      * ✅ Implemented comprehensive pydantic-settings configuration
      * ✅ Added secure secret handling with SecretStr
      * ✅ Added validation for all environment variables
      * ✅ Configured .env and secrets directory support
      * ✅ Added type safety and validation for all settings
   6. - [🚧] Configure dependency security scanning
   7. - [🚧] Set up initial health checks
      * ✅ Basic health check implementation (80% coverage)
      * ❌ Periodic health check failing
      * 🚧 Component health checks need refinement
   8. - [✅] Configure storage directory structure
</task-group-project-initialization></p>
<p><task-group-dev-environment>
2. - [🚧] Configure Development Environment
   1. - [✅] Set up Ruff for linting and formatting
      * ✅ Basic configuration in pyproject.toml
      * ✅ Integrated with pre-commit hooks
      * ✅ Configured with two hooks: ruff (linting) and ruff-format (formatting)
      * ✅ Set to run before each commit with --fix and --exit-non-zero-on-fix
      * ✅ Properly ordered before other formatting tools
   2. - [✅] Configure pre-commit hooks
      * ✅ Added validate-pyproject for pyproject.toml validation
      * ✅ Added gitleaks for secret scanning
      * ✅ Added ruff and ruff-format hooks
      * ✅ Added additional code quality hooks
      * ✅ Configured to run on pre-commit, commit-msg, and pre-push
   3. - [✅] Set up VSCode settings
   4. - [✅] Create .env.sample with required variables
      * ✅ Added all required environment variables
      * ✅ Added descriptive comments and sections
      * ✅ Included default values from env.py
      * ✅ Added placeholders for sensitive values
   5. - [🚧] Set up development secrets management
   6. - [🚧] Configure development security checks
   7. - [✅] Set up detailed VSCode configuration
   8. - [❌] Configure dependency review automation
</task-group-dev-environment></p>
<p><task-group-test-infrastructure>
3. - [🚧] Set up Test Infrastructure
   1. - [✅] Configure pytest with required plugins
   2. - [✅] Set up test directory structure
   3. - [✅] Create initial test fixtures
   4. - [✅] Configure coverage reporting
   5. - [✅] Set up VCR for HTTP mocking
   6. - [🚧] Configure test security scanning
   7. - [✅] Set up async test support
   8. - [✅] Configure parallel testing
   9. - [🚧] Set up Discord.py testing utilities
      * ❌ Bot test environment validation failing
      * ❌ Mock configuration issues in bot tests
      * 🚧 Help command tests need fixes
</task-group-test-infrastructure></p>
<p><task-group-documentation>
4. - [❌] Initialize Documentation
   1. - [❌] Set up MkDocs with required extensions
   2. - [❌] Create initial documentation structure
   3. - [❌] Document setup process
   4. - [❌] Add development guidelines
   5. - [❌] Add security guidelines
   6. - [❌] Document monitoring setup
   7. - [❌] Create troubleshooting guide
   8. - [❌] Create code style guide
   9. - [❌] Create testing guide
   10. - [❌] Create storage management guide
</task-group-documentation></p>
<p><task-group-cicd>
5. - [❌] Set up CI/CD Pipeline
   1. - [❌] Configure GitHub Actions workflow
   2. - [❌] Set up dependency scanning
   3. - [❌] Configure automated testing
   4. - [❌] Set up code quality checks
   5. - [❌] Configure security scanning
   6. - [❌] Set up documentation building
   7. - [❌] Configure automated deployments
   8. - [❌] Set up CodeQL analysis
   9. - [❌] Configure dependency review
   10. - [❌] Set up release drafting
</task-group-cicd></p>
<p><task-group-monitoring>
6. - [🚧] Configure Monitoring Foundation
   1. - [✅] Set up loguru configuration
   2. - [✅] Configure better-exceptions
   3. - [✅] Set up basic metrics collection
      * ✅ Core metrics implemented
      * ❌ Histogram label issues need fixing
   4. - [✅] Configure log rotation
   5. - [✅] Set up monitoring dashboard structure
   6. - [✅] Configure resource usage monitoring
   7. - [✅] Set up security event logging
   8. - [🚧] Set up health check endpoints
   9. - [✅] Set up storage monitoring
   10. - [✅] Set up performance profiling
</task-group-monitoring></p>
<p><task-group-storage>
7. - [✅] Initialize Storage Structure
   1. - [✅] Set up temporary storage directory structure
      * ✅ Created main downloads directory
      * ✅ Created temp storage directory
      * ✅ Created completed downloads directory
      * ✅ Created failed downloads directory
      * ✅ Added comprehensive tests (100% coverage)
      * ✅ Implemented idempotent creation
      * ✅ Added file preservation checks
   2. - [✅] Add file validation checks to QuotaManager
      * ✅ File type validation - Implemented in FileValidator with ALLOWED_EXTENSIONS
      * ✅ File name sanitization - Implemented with sanitize_filename method
      * ✅ Basic security checks - Implemented path traversal detection and forbidden character validation
      * ✅ Test coverage: 57% for validation.py
   3. - [ ] <del>Configure cleanup policies</del> (Deferred to Phase 2)
   4. - [✅] Set up storage quota management
      * ✅ Basic quota tracking with byte and megabyte reporting
      * ✅ File size limits (50MB per file)
      * ✅ Concurrent download limits (5 max)
      * ✅ Quota status reporting with usage percentage
      * ✅ Test coverage: 96% for quotas.py
   5. - [ ] <del>Configure backup locations</del> (Deferred to Phase 2)
   6. - [ ] <del>Set up storage monitoring</del> (Deferred to Phase 2)
   7. - [ ] <del>Configure storage security</del> (Deferred to Phase 3)
</task-group-storage>
</p>
<p><section-deferred-tasks></section-deferred-tasks></p>
<h2 id="deferred-tasks">Deferred Tasks<a class="headerlink" href="#deferred-tasks" title="Permanent link">¶</a></h2>
<p>The following tasks have been deferred to future phases:</p>
<ol>
<li>Storage Management (Task Group 7)</li>
<li>Configure cleanup policies (Phase 2)</li>
<li>Configure backup locations (Phase 2)</li>
<li>Set up storage monitoring (Phase 2)</li>
<li>Configure storage security (Phase 3)</li>
</ol>
<p><subsection-deferral-rationale>
Rationale for Deferral:
- These features belong to later phases per phased development plan
- Not critical for MVP functionality
- Current focus is on core bot infrastructure and basic file validation
</subsection-deferral-rationale>
</p>
<p><section-constraints></section-constraints></p>
<h2 id="constraints">Constraints<a class="headerlink" href="#constraints" title="Permanent link">¶</a></h2>
<ul>
<li>Python 3.12+ required</li>
<li>Maximum module size: 120 lines</li>
<li>Test coverage targets (MVP):</li>
<li>Core Download: 30%</li>
<li>Command Parsing: 25%</li>
<li>Discord Events: 20%</li>
<li>File Management: 20%</li>
<li>Maximum concurrent downloads: 5</li>
<li>Maximum queue size: 50 items</li>
<li>Maximum file size: 50MB</li>
<li>Secure environment variable handling required</li>
<li>Monitoring metrics must be collected from start
</li>
</ul>
<p><section-data-models></section-data-models></p>
<h2 id="data-models-schema">Data Models / Schema<a class="headerlink" href="#data-models-schema" title="Permanent link">¶</a></h2>
<p><div class="highlight"><pre><span></span><code><span class="c1"># pyproject.toml structure</span>
<span class="p">[</span><span class="n">project</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">"boss-bot"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">"0.1.0"</span>
<span class="n">requires</span><span class="o">-</span><span class="n">python</span> <span class="o">=</span> <span class="s2">"&gt;=3.12"</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"discord-py&gt;=2.5.2"</span><span class="p">,</span>
    <span class="s2">"gallery-dl&gt;=1.29.3"</span><span class="p">,</span>
    <span class="s2">"loguru&gt;=0.7.3"</span><span class="p">,</span>
    <span class="s2">"pydantic-settings&gt;=2.8.1"</span><span class="p">,</span>
    <span class="s2">"better-exceptions&gt;=0.3.3"</span><span class="p">,</span>
    <span class="s2">"prometheus-client&gt;=0.17.1"</span><span class="p">,</span>
    <span class="s2">"pytest-recording&gt;=0.13.0"</span><span class="p">,</span>
    <span class="s2">"pytest-cov&gt;=4.1.0"</span><span class="p">,</span>
    <span class="s2">"mkdocs-material&gt;=9.4.0"</span><span class="p">,</span>
    <span class="s2">"pytest-asyncio&gt;=0.23.0"</span><span class="p">,</span>
    <span class="s2">"pytest-mock&gt;=3.12.0"</span><span class="p">,</span>
    <span class="s2">"pytest-timeout&gt;=2.2.0"</span><span class="p">,</span>
    <span class="s2">"pytest-xdist&gt;=3.5.0"</span><span class="p">,</span>
    <span class="s2">"respx&gt;=0.20.2"</span><span class="p">,</span>
    <span class="s2">"dpytest&gt;=0.7.0"</span><span class="p">,</span>
<span class="p">]</span>

<span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">pytest</span><span class="o">.</span><span class="n">ini_options</span><span class="p">]</span>
<span class="n">testpaths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"tests"</span><span class="p">]</span>
<span class="n">python_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"test_*.py"</span><span class="p">]</span>
<span class="n">addopts</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    --cov=boss_bot</span>
<span class="s2">    --cov-report=xml</span>
<span class="s2">    --cov-report=term-missing</span>
<span class="s2">    --asyncio-mode=auto</span>
<span class="s2">    --numprocesses=auto</span>
<span class="s2">    --dist=loadfile</span>
<span class="s2">"""</span>

<span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">ruff</span><span class="p">]</span>
<span class="n">line</span><span class="o">-</span><span class="n">length</span> <span class="o">=</span> <span class="mi">88</span>
<span class="n">target</span><span class="o">-</span><span class="n">version</span> <span class="o">=</span> <span class="s2">"py312"</span>
<span class="n">select</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"E"</span><span class="p">,</span>   <span class="c1"># pycodestyle errors</span>
    <span class="s2">"W"</span><span class="p">,</span>   <span class="c1"># pycodestyle warnings</span>
    <span class="s2">"F"</span><span class="p">,</span>   <span class="c1"># pyflakes</span>
    <span class="s2">"I"</span><span class="p">,</span>   <span class="c1"># isort</span>
    <span class="s2">"C"</span><span class="p">,</span>   <span class="c1"># flake8-comprehensions</span>
    <span class="s2">"B"</span><span class="p">,</span>   <span class="c1"># flake8-bugbear</span>
<span class="p">]</span>
</code></pre></div>
</p>
<p><section-structure></section-structure></p>
<h2 id="structure">Structure<a class="headerlink" href="#structure" title="Permanent link">¶</a></h2>
<p>Following the project structure from the PRD:</p>
<p><div class="highlight"><pre><span></span><code>boss-bot/
├── .github/
│   └── workflows/
│       ├── ci.yml
│       ├── dependency-review.yml
│       ├── codeql-analysis.yml
│       ├── security-audit.yml
│       ├── release-drafter.yml
│       └── security.yml
├── src/
│   ├── boss_bot/
│   │   ├── bot/
│   │   ├── commands/
│   │   ├── core/
│   │   ├── downloaders/
│   │   ├── schemas/
│   │   ├── monitoring/
│   │   │   ├── metrics.py
│   │   │   ├── health.py
│   │   │   └── logging.py
│   │   ├── storage/
│   │   │   ├── cleanup.py
│   │   │   ├── quotas.py
│   │   │   └── validation.py
│   │   └── utils/
├── tests/
│   ├── conftest.py
│   ├── test_bot/
│   ├── test_commands/
│   ├── test_downloaders/
│   ├── test_storage/
│   └── cassettes/
├── docs/
│   ├── development/
│   │   ├── code_style.md
│   │   ├── testing_guide.md
│   │   ├── security_practices.md
│   │   ├── monitoring_guide.md
│   │   ├── storage_management.md
│   │   └── deployment_guide.md
│   ├── setup.md
│   ├── security.md
│   ├── monitoring.md
│   └── troubleshooting.md
├── scripts/
├── .vscode/
│   ├── settings.json
│   ├── launch.json
│   └── extensions.json
├── .env.sample
├── .pre-commit-config.yaml
├── pyproject.toml
└── README.md
</code></pre></div>
</p>
<p><section-diagrams></section-diagrams></p>
<h2 id="diagrams">Diagrams<a class="headerlink" href="#diagrams" title="Permanent link">¶</a></h2>
<p><pre class="mermaid"><code>graph TD
    A[Initialize Project] --&gt; B[Configure Dev Environment]
    B --&gt; C[Set up Testing]
    C --&gt; D[Initialize Docs]
    D --&gt; E[Set up CI/CD]
    E --&gt; F[Configure Monitoring]

    B --&gt; B1[Ruff]
    B --&gt; B2[Pre-commit]
    B --&gt; B3[VSCode]
    B --&gt; B4[Security]

    C --&gt; C1[Pytest]
    C --&gt; C2[Coverage]
    C --&gt; C3[Fixtures]
    C --&gt; C4[VCR]

    D --&gt; D1[MkDocs]
    D --&gt; D2[Guidelines]
    D --&gt; D3[Security Docs]

    E --&gt; E1[GitHub Actions]
    E --&gt; E2[Security Scans]
    E --&gt; E3[Automated Tests]

    F --&gt; F1[Loguru]
    F --&gt; F2[Metrics]
    F --&gt; F3[Monitoring]
</code></pre>
</p>
<p><section-dev-notes></section-dev-notes></p>
<h2 id="dev-notes">Dev Notes<a class="headerlink" href="#dev-notes" title="Permanent link">¶</a></h2>
<ul>
<li>Ensure all dependencies are pinned to specific versions for reproducibility</li>
<li>Configure Ruff to enforce type hints and docstrings</li>
<li>Set up pre-commit hooks to run before each commit</li>
<li>Create comprehensive test fixtures for Discord bot testing</li>
<li>Document all setup steps clearly for other developers</li>
<li>Implement security best practices from the start</li>
<li>Set up monitoring and metrics collection early</li>
<li>Set up CI/CD pipeline includes security checks</li>
<li>Configure proper secret management</li>
<li>Set up automated dependency updates with security checks</li>
<li>✅ Implemented file validation with comprehensive tests (coverage: 57% for validation.py)</li>
<li>Added support for common media file types</li>
<li>Implemented secure filename sanitization</li>
<li>Added path traversal detection</li>
<li>Created thorough test suite with edge cases</li>
<li>✅ Implemented storage quota management (coverage: 96% for quotas.py)</li>
<li>Added quota tracking with byte/MB reporting</li>
<li>Implemented file size and concurrent download limits</li>
<li>Created comprehensive test suite</li>
<li>Added detailed status reporting</li>
<li>✅ Implemented storage directory structure (100% test coverage)</li>
<li>Created required directory hierarchy</li>
<li>Added idempotent creation</li>
<li>Ensured file preservation</li>
<li>Added comprehensive test suite
</li>
</ul>
<p><section-command-log></section-command-log></p>
<h2 id="chat-command-log">Chat Command Log<a class="headerlink" href="#chat-command-log" title="Permanent link">¶</a></h2>
<p>No commands executed yet - initial story creation.
</p>
<p><section-implementation-evidence></section-implementation-evidence></p>
<h2 id="implementation-evidence">Implementation Evidence<a class="headerlink" href="#implementation-evidence" title="Permanent link">¶</a></h2>
<p><subsection-test-coverage></subsection-test-coverage></p>
<h3 id="test-coverage-status">Test Coverage Status<a class="headerlink" href="#test-coverage-status" title="Permanent link">¶</a></h3>
<ol>
<li>Overall Coverage: 56.16% (Exceeding MVP targets)</li>
<li>Key Component Coverage:</li>
<li>Storage/Quotas: 96% ✅</li>
<li>Storage/Validation: 57% ✅</li>
<li>Core/Environment: 94% ✅</li>
<li>Core/Queue: 94% ✅</li>
<li>Monitoring/Health: 80% ✅</li>
<li>Monitoring/Logging: 100% ✅</li>
<li>Monitoring/Metrics: 100% ✅</li>
<li>Bot/Help: 85% ✅</li>
<li>Bot/Client: 32% ✅ (Meets MVP target)</li>
<li>Bot/Cogs: ~30% ✅ (Meets MVP target)
</li>
</ol>
<p><subsection-test-results></subsection-test-results></p>
<h3 id="test-results-summary">Test Results Summary<a class="headerlink" href="#test-results-summary" title="Permanent link">¶</a></h3>
<ul>
<li>Total Tests: 123</li>
<li>Passed: 78 ✅</li>
<li>Failed: 12 ❌</li>
<li>Errors: 33 ❌</li>
<li>Key Issues:</li>
<li>Discord environment settings validation errors</li>
<li>Metrics histogram label issues</li>
<li>Health check periodic testing</li>
<li>Bot help command formatting</li>
<li>Mock configuration issues in bot tests
</li>
</ul>
<p><subsection-priority-tasks></subsection-priority-tasks></p>
<h3 id="next-priority-tasks">Next Priority Tasks<a class="headerlink" href="#next-priority-tasks" title="Permanent link">¶</a></h3>
<ol>
<li>Fix environment validation errors in bot tests</li>
<li>Address metrics histogram label issues</li>
<li>Fix health check periodic testing</li>
<li>Resolve bot help command formatting</li>
<li>Fix mock configuration in bot tests
</li>
</ol>
<p><subsection-env-config></subsection-env-config></p>
<h3 id="environment-configuration_1">Environment Configuration<a class="headerlink" href="#environment-configuration_1" title="Permanent link">¶</a></h3>
<ol>
<li>Environment Settings:</li>
<li>Location: src/boss_bot/core/env.py</li>
<li>
<p>Key Features:</p>
<ul>
<li>Comprehensive pydantic-settings implementation</li>
<li>Secure secret handling with SecretStr</li>
<li>Validation for all environment variables</li>
<li>Support for .env and secrets directory</li>
<li>Type safety and validation</li>
<li>Environment-specific configuration</li>
</ul>
</li>
<li>
<p>Package Management:</p>
</li>
<li>Location: pyproject.toml, uv.lock</li>
<li>
<p>Features:</p>
<ul>
<li>UV v0.6.13 configuration</li>
<li>Properly managed dependencies</li>
<li>Dev dependencies setup</li>
<li>Workspace configuration</li>
<li>Version pinning</li>
</ul>
</li>
<li>
<p>Environment Templates:</p>
</li>
<li>Location: .env.sample</li>
<li>Features:<ul>
<li>Complete environment variable listing</li>
<li>Organized sections with comments</li>
<li>Default values from env.py</li>
<li>Secure placeholders for API keys</li>
<li>Development-focused defaults
</li>
</ul>
</li>
</ol>
<p><subsection-storage-management></subsection-storage-management></p>
<h3 id="storage-management-implementation">Storage Management Implementation<a class="headerlink" href="#storage-management-implementation" title="Permanent link">¶</a></h3>
<ol>
<li>Storage Quota System:</li>
<li>Location: src/boss_bot/storage/quotas.py</li>
<li>Test Coverage: 96%</li>
<li>
<p>Key Features:</p>
<ul>
<li>File size limits (50MB)</li>
<li>Concurrent download tracking</li>
<li>Usage reporting</li>
<li>Comprehensive test suite</li>
</ul>
</li>
<li>
<p>File Validation:</p>
</li>
<li>Location: src/boss_bot/storage/validation.py</li>
<li>Test Coverage: 57%</li>
<li>
<p>Key Features:</p>
<ul>
<li>File type validation</li>
<li>Name sanitization</li>
<li>Security checks</li>
<li>Path traversal prevention</li>
</ul>
</li>
<li>
<p>Storage Structure:</p>
</li>
<li>Location: src/boss_bot/storage/</li>
<li>Test Coverage: 100% for directory management</li>
<li>Features:<ul>
<li>Organized directory hierarchy</li>
<li>Idempotent creation</li>
<li>File preservation</li>
<li>Comprehensive tests
</li>
</ul>
</li>
</ol>
<p><subsection-dev-environment></subsection-dev-environment></p>
<h3 id="development-environment_2">Development Environment<a class="headerlink" href="#development-environment_2" title="Permanent link">¶</a></h3>
<ol>
<li>Pre-commit Configuration:</li>
<li>Location: .pre-commit-config.yaml</li>
<li>
<p>Key Features:</p>
<ul>
<li>Ruff integration with two hooks:</li>
<li>ruff: Linting with --fix and --exit-non-zero-on-fix</li>
<li>ruff-format: Formatting with proper configuration</li>
<li>Comprehensive hook setup for code quality</li>
<li>Multiple git hooks configured (pre-commit, commit-msg, pre-push)</li>
<li>Proper hook ordering for optimal formatting</li>
<li>Validation hooks for project configuration</li>
</ul>
</li>
<li>
<p>Environment Settings:</p>
</li>
<li>Location: src/boss_bot/core/env.py</li>
<li>Key Features:<ul>
<li>Comprehensive pydantic-settings implementation</li>
<li>Secure secret handling with SecretStr</li>
<li>Validation for all environment variables</li>
<li>Support for .env and secrets directory</li>
<li>Type safety and validation</li>
<li>Environment-specific configuration

</li>
</ul>
</li>
</ol>
<p></p>
<hr/>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="August 12, 2025 23:41:12">August 12, 2025 23:41:12</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Created">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="August 12, 2025 23:41:12">August 12, 2025 23:41:12</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Contributors">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"></path></svg>
</span>
<nav>
<a href="mailto:bossjones@theblacktonystark.com">Malcolm Jones</a>
</nav>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Cursor Agile Workflow Documentation" class="md-footer__link md-footer__link--prev" href="../agile-readme/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Cursor Agile Workflow Documentation
              </div>
</div>
</a>
<a aria-label="Next: BossBot CLI (bossctl) Documentation" class="md-footer__link md-footer__link--next" href="../cli/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                BossBot CLI (bossctl) Documentation
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2023 - 2025 Malcolm Jones
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bossjones/boss-bot" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.select", "content.tooltips", "navigation.footer", "search.share", "navigation.indexes", "navigation.sections"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>