
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="AI-powered code generation tooling for efficient software development" name="description"/>
<meta content="Malcolm Jones" name="author"/>
<link href="https://bossjones.github.io/boss-bot/docs/core/download-system/" rel="canonical"/>
<link href="../discord-integration/" rel="prev"/>
<link href="../testing-patterns/" rel="next"/>
<link href="../../images/logo3.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.11" name="generator"/>
<title>Download System - Boss Bot</title>
<link href="../../assets/stylesheets/main.4af4bdda.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../css/neoteroi.cards.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="deep-purple" data-md-color-primary="deep-purple" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#download-system">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Boss Bot" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Boss Bot">
<img alt="logo" src="../../images/logo3.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Boss Bot
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Download System
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="deep-purple" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="deep-purple" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="deep-purple" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="deep-purple" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/bossjones/boss-bot" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    bossjones/boss-bot
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Boss Bot" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Boss Bot">
<img alt="logo" src="../../images/logo3.png"/>
</a>
    Boss Bot
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/bossjones/boss-bot" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    bossjones/boss-bot
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Boss-Bot
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../AI_INTEGRATION/">
<span class="md-ellipsis">
    Boss-Bot AI Integration Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../agile-readme/">
<span class="md-ellipsis">
    Cursor Agile Workflow Documentation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ai/">
<span class="md-ellipsis">
    .ai docs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cli/">
<span class="md-ellipsis">
    BossBot CLI (bossctl) Documentation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../codebase_structure/">
<span class="md-ellipsis">
    Boss-Bot Codebase Structure
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../coverage/">
<span class="md-ellipsis">
    Coverage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cursor-rules-reference/">
<span class="md-ellipsis">
    Cursor Rules Reference
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../downloaders/">
<span class="md-ellipsis">
    Download System: gallery-dl and yt-dlp Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../downloaders_config/">
<span class="md-ellipsis">
    Download Client Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../environment/">
<span class="md-ellipsis">
    Environment
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../langgraph-assistants/">
<span class="md-ellipsis">
    Macro Rendering Error
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logging/">
<span class="md-ellipsis">
    Loguru Thread-Safe Interceptor Setup Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logging_testing/">
<span class="md-ellipsis">
    Loguru Testing with Logot &amp; Pytest Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logging_typing/">
<span class="md-ellipsis">
    Loguru Type Hints &amp; IDE Support Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../people/">
<span class="md-ellipsis">
    People
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../project_structure/">
<span class="md-ellipsis">
    Boss-Bot Project Structure
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../vcr/">
<span class="md-ellipsis">
    pytest-recording: A pytest plugin that allows you recording of network interactions via VCR.py
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../versioning/">
<span class="md-ellipsis">
    Versioning
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../workflow-rules/">
<span class="md-ellipsis">
    Cursor Workflow Rules
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_21" type="checkbox"/>
<label class="md-nav__link" for="__nav_21" id="__nav_21_label" tabindex="">
<span class="md-ellipsis">
    Contributors
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_21_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_21">
<span class="md-nav__icon md-icon"></span>
            Contributors
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributors/dpytest_example/">
<span class="md-ellipsis">
    Discord.py Bot Testing with dpytest
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_22" type="checkbox"/>
<label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="">
<span class="md-ellipsis">
    Core
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_22_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_22">
<span class="md-nav__icon md-icon"></span>
            Core
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../architecture-overview/">
<span class="md-ellipsis">
    Architecture Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration-management/">
<span class="md-ellipsis">
    Configuration Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development-workflow/">
<span class="md-ellipsis">
    Development Workflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../discord-integration/">
<span class="md-ellipsis">
    Discord Integration
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Download System
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Download System
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#system-overview">
<span class="md-ellipsis">
      System Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#handler-pattern-current-implementation">
<span class="md-ellipsis">
      Handler Pattern (Current Implementation)
    </span>
</a>
<nav aria-label="Handler Pattern (Current Implementation)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview">
<span class="md-ellipsis">
      Architecture Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#base-handler-interface">
<span class="md-ellipsis">
      Base Handler Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#platform-handler-implementations">
<span class="md-ellipsis">
      Platform Handler Implementations
    </span>
</a>
<nav aria-label="Platform Handler Implementations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#twitterhandler">
<span class="md-ellipsis">
      TwitterHandler
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#youtubehandler">
<span class="md-ellipsis">
      YouTubeHandler
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#enhanced-youtube-strategy-pattern">
<span class="md-ellipsis">
      Enhanced YouTube Strategy Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#handler-registration-and-discovery">
<span class="md-ellipsis">
      Handler Registration and Discovery
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-pattern-experimental">
<span class="md-ellipsis">
      Strategy Pattern (Experimental)
    </span>
</a>
<nav aria-label="Strategy Pattern (Experimental)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview_1">
<span class="md-ellipsis">
      Architecture Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#base-strategy-interface">
<span class="md-ellipsis">
      Base Strategy Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-flag-system">
<span class="md-ellipsis">
      Feature Flag System
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-implementation-example">
<span class="md-ellipsis">
      Strategy Implementation Example
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-client-implementation">
<span class="md-ellipsis">
      API Client Implementation
    </span>
</a>
<nav aria-label="API Client Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#asyncgallerydl-client">
<span class="md-ellipsis">
      AsyncGalleryDL Client
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-management">
<span class="md-ellipsis">
      Configuration Management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mediametadata-schema">
<span class="md-ellipsis">
      MediaMetadata Schema
    </span>
</a>
<nav aria-label="MediaMetadata Schema" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-metadata-structure">
<span class="md-ellipsis">
      Core Metadata Structure
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#platform-specific-extensions">
<span class="md-ellipsis">
      Platform-Specific Extensions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-and-environment-variables">
<span class="md-ellipsis">
      Configuration and Environment Variables
    </span>
</a>
<nav aria-label="Configuration and Environment Variables" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-flag-environment-variables">
<span class="md-ellipsis">
      Feature Flag Environment Variables
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bosssettings-integration">
<span class="md-ellipsis">
      BossSettings Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-and-resilience">
<span class="md-ellipsis">
      Error Handling and Resilience
    </span>
</a>
<nav aria-label="Error Handling and Resilience" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#error-hierarchy">
<span class="md-ellipsis">
      Error Hierarchy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#retry-and-fallback-logic">
<span class="md-ellipsis">
      Retry and Fallback Logic
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-considerations">
<span class="md-ellipsis">
      Performance Considerations
    </span>
</a>
<nav aria-label="Performance Considerations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#asyncawait-patterns">
<span class="md-ellipsis">
      Async/Await Patterns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resource-management">
<span class="md-ellipsis">
      Resource Management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compression-integration">
<span class="md-ellipsis">
      Compression Integration
    </span>
</a>
<nav aria-label="Compression Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#post-download-compression">
<span class="md-ellipsis">
      Post-Download Compression
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compression-strategy-selection">
<span class="md-ellipsis">
      Compression Strategy Selection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#discord-integration">
<span class="md-ellipsis">
      Discord Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compression-configuration">
<span class="md-ellipsis">
      Compression Configuration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-system-integration">
<span class="md-ellipsis">
      Upload System Integration
    </span>
</a>
<nav aria-label="Upload System Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#enhanced-download-workflow">
<span class="md-ellipsis">
      Enhanced Download Workflow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#download-upload-integration-architecture">
<span class="md-ellipsis">
      Download-Upload Integration Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-aware-download-configuration">
<span class="md-ellipsis">
      Upload-Aware Download Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#command-interface-changes">
<span class="md-ellipsis">
      Command Interface Changes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-integration-examples">
<span class="md-ellipsis">
      Upload Integration Examples
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#temporary-directory-management">
<span class="md-ellipsis">
      Temporary Directory Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-and-fallbacks">
<span class="md-ellipsis">
      Error Handling and Fallbacks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimizations">
<span class="md-ellipsis">
      Performance Optimizations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-benefits">
<span class="md-ellipsis">
      Integration Benefits
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../testing-patterns/">
<span class="md-ellipsis">
    Testing Patterns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../upload-system/">
<span class="md-ellipsis">
    Upload System
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23" type="checkbox"/>
<label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="">
<span class="md-ellipsis">
    Development
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_23">
<span class="md-nav__icon md-icon"></span>
            Development
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../development/claude_code/">
<span class="md-ellipsis">
    Claude code
    
  </span>
</a>
<label class="md-nav__link" for="__nav_23_1" id="__nav_23_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_23_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_1">
<span class="md-nav__icon md-icon"></span>
            Claude code
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/claude_code/custom_slash_commands/">
<span class="md-ellipsis">
    Create a Custom Slash Command for your project in Claude Code
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_1_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../development/claude_code/claude-sessions/">
<span class="md-ellipsis">
    Claude sessions
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_23_1_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_23_1_3">
<span class="md-nav__icon md-icon"></span>
            Claude sessions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../development/fastmcp/">
<span class="md-ellipsis">
    Fastmcp
    
  </span>
</a>
<label class="md-nav__link" for="__nav_23_2" id="__nav_23_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_23_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_2">
<span class="md-nav__icon md-icon"></span>
            Fastmcp
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/api-reference/">
<span class="md-ellipsis">
    API Reference
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/authentication/">
<span class="md-ellipsis">
    Authentication
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/context/">
<span class="md-ellipsis">
    Context
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/custom-middleware/">
<span class="md-ellipsis">
    Custom Middleware
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/custom-routes/">
<span class="md-ellipsis">
    Macro Syntax Error
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/database-integration/">
<span class="md-ellipsis">
    Database Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/debugging/">
<span class="md-ellipsis">
    Debugging
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/development-workflow/">
<span class="md-ellipsis">
    Development Workflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/event-store-integration/">
<span class="md-ellipsis">
    Event Store Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/examples/">
<span class="md-ellipsis">
    Examples and Best Practices
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/faq/">
<span class="md-ellipsis">
    FAQ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/lifespan-management/">
<span class="md-ellipsis">
    Lifespan Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/migration-guide/">
<span class="md-ellipsis">
    Migration Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/monitoring-observability/">
<span class="md-ellipsis">
    Macro Syntax Error
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/overview/">
<span class="md-ellipsis">
    FastMCP Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/performance-guide/">
<span class="md-ellipsis">
    Performance Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/prompts/">
<span class="md-ellipsis">
    Prompts
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/resources/">
<span class="md-ellipsis">
    Resources
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/security-guide/">
<span class="md-ellipsis">
    Security Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/session-management/">
<span class="md-ellipsis">
    Session Management
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/testing-guide/">
<span class="md-ellipsis">
    Testing Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/tools/">
<span class="md-ellipsis">
    Tools
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/transports/">
<span class="md-ellipsis">
    Transport Protocols
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/fastmcp/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_23_3" id="__nav_23_3_label" tabindex="0">
<span class="md-ellipsis">
    Github actions
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_3">
<span class="md-nav__icon md-icon"></span>
            Github actions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/github_actions/claude_workflow/">
<span class="md-ellipsis">
    Claude GitHub Actions Workflow Documentation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_23_4" id="__nav_23_4_label" tabindex="0">
<span class="md-ellipsis">
    Testing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_4">
<span class="md-nav__icon md-icon"></span>
            Testing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/testing/pytest_recording/">
<span class="md-ellipsis">
    VCR Cassettes
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_23_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_23_5" id="__nav_23_5_label" tabindex="0">
<span class="md-ellipsis">
    Typing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_23_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_23_5">
<span class="md-nav__icon md-icon"></span>
            Typing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/typing/monkeytype/">
<span class="md-ellipsis">
    PYTEST.md
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_24" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../til/">
<span class="md-ellipsis">
    Til
    
  </span>
</a>
<label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_24_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_24">
<span class="md-nav__icon md-icon"></span>
            Til
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Archive
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#system-overview">
<span class="md-ellipsis">
      System Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#handler-pattern-current-implementation">
<span class="md-ellipsis">
      Handler Pattern (Current Implementation)
    </span>
</a>
<nav aria-label="Handler Pattern (Current Implementation)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview">
<span class="md-ellipsis">
      Architecture Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#base-handler-interface">
<span class="md-ellipsis">
      Base Handler Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#platform-handler-implementations">
<span class="md-ellipsis">
      Platform Handler Implementations
    </span>
</a>
<nav aria-label="Platform Handler Implementations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#twitterhandler">
<span class="md-ellipsis">
      TwitterHandler
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#youtubehandler">
<span class="md-ellipsis">
      YouTubeHandler
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#enhanced-youtube-strategy-pattern">
<span class="md-ellipsis">
      Enhanced YouTube Strategy Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#handler-registration-and-discovery">
<span class="md-ellipsis">
      Handler Registration and Discovery
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-pattern-experimental">
<span class="md-ellipsis">
      Strategy Pattern (Experimental)
    </span>
</a>
<nav aria-label="Strategy Pattern (Experimental)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview_1">
<span class="md-ellipsis">
      Architecture Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#base-strategy-interface">
<span class="md-ellipsis">
      Base Strategy Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-flag-system">
<span class="md-ellipsis">
      Feature Flag System
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-implementation-example">
<span class="md-ellipsis">
      Strategy Implementation Example
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-client-implementation">
<span class="md-ellipsis">
      API Client Implementation
    </span>
</a>
<nav aria-label="API Client Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#asyncgallerydl-client">
<span class="md-ellipsis">
      AsyncGalleryDL Client
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-management">
<span class="md-ellipsis">
      Configuration Management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mediametadata-schema">
<span class="md-ellipsis">
      MediaMetadata Schema
    </span>
</a>
<nav aria-label="MediaMetadata Schema" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-metadata-structure">
<span class="md-ellipsis">
      Core Metadata Structure
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#platform-specific-extensions">
<span class="md-ellipsis">
      Platform-Specific Extensions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-and-environment-variables">
<span class="md-ellipsis">
      Configuration and Environment Variables
    </span>
</a>
<nav aria-label="Configuration and Environment Variables" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#feature-flag-environment-variables">
<span class="md-ellipsis">
      Feature Flag Environment Variables
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bosssettings-integration">
<span class="md-ellipsis">
      BossSettings Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-and-resilience">
<span class="md-ellipsis">
      Error Handling and Resilience
    </span>
</a>
<nav aria-label="Error Handling and Resilience" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#error-hierarchy">
<span class="md-ellipsis">
      Error Hierarchy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#retry-and-fallback-logic">
<span class="md-ellipsis">
      Retry and Fallback Logic
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-considerations">
<span class="md-ellipsis">
      Performance Considerations
    </span>
</a>
<nav aria-label="Performance Considerations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#asyncawait-patterns">
<span class="md-ellipsis">
      Async/Await Patterns
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resource-management">
<span class="md-ellipsis">
      Resource Management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compression-integration">
<span class="md-ellipsis">
      Compression Integration
    </span>
</a>
<nav aria-label="Compression Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#post-download-compression">
<span class="md-ellipsis">
      Post-Download Compression
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compression-strategy-selection">
<span class="md-ellipsis">
      Compression Strategy Selection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#discord-integration">
<span class="md-ellipsis">
      Discord Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compression-configuration">
<span class="md-ellipsis">
      Compression Configuration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-system-integration">
<span class="md-ellipsis">
      Upload System Integration
    </span>
</a>
<nav aria-label="Upload System Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#enhanced-download-workflow">
<span class="md-ellipsis">
      Enhanced Download Workflow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#download-upload-integration-architecture">
<span class="md-ellipsis">
      Download-Upload Integration Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-aware-download-configuration">
<span class="md-ellipsis">
      Upload-Aware Download Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#command-interface-changes">
<span class="md-ellipsis">
      Command Interface Changes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-integration-examples">
<span class="md-ellipsis">
      Upload Integration Examples
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#temporary-directory-management">
<span class="md-ellipsis">
      Temporary Directory Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-and-fallbacks">
<span class="md-ellipsis">
      Error Handling and Fallbacks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimizations">
<span class="md-ellipsis">
      Performance Optimizations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-benefits">
<span class="md-ellipsis">
      Integration Benefits
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/bossjones/boss-bot/edit/main/docs/core/download-system.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/bossjones/boss-bot/raw/main/docs/core/download-system.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"></path></svg>
</a>
<h1 id="download-system">Download System<a class="headerlink" href="#download-system" title="Permanent link"></a></h1>
<p>This document explains Boss-Bot's download system architecture, covering both the current Handler pattern and the experimental Strategy pattern for platform-specific media downloads.</p>
<h2 id="system-overview">System Overview<a class="headerlink" href="#system-overview" title="Permanent link"></a></h2>
<p>Boss-Bot supports downloading media from multiple platforms through a pluggable architecture that allows for different implementation approaches:</p>
<p><strong>Supported Platforms:</strong>
- <strong>Twitter/X</strong>: Posts, threads, media content
- <strong>Reddit</strong>: Posts, comments, images, videos
- <strong>Instagram</strong>: Posts, stories (experimental)
- <strong>YouTube</strong>: Videos, playlists, audio extraction</p>
<p><strong>Implementation Approaches:</strong>
- <strong>Handler Pattern</strong> (Current): CLI-based subprocess execution
- <strong>Strategy Pattern</strong> (Experimental): API-direct with CLI fallback</p>
<h2 id="handler-pattern-current-implementation">Handler Pattern (Current Implementation)<a class="headerlink" href="#handler-pattern-current-implementation" title="Permanent link"></a></h2>
<h3 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link"></a></h3>
<p>The Handler pattern provides a stable, CLI-based approach using external tools:</p>
<pre class="mermaid"><code>graph LR
    subgraph "Download Flow"
        USER[Discord User] --&gt; COG[Download Cog]
        COG --&gt; MGR[Download Manager]
        MGR --&gt; HANDLER[Platform Handler]
        HANDLER --&gt; CLI[External CLI Tool]
        CLI --&gt; GALLERY[gallery-dl/yt-dlp]
        GALLERY --&gt; FILES[Downloaded Files]
        FILES --&gt; META[MediaMetadata]
        META --&gt; USER
    end
</code></pre>
<h3 id="base-handler-interface">Base Handler Interface<a class="headerlink" href="#base-handler-interface" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/handlers/base_handler.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boss_bot.schemas.discord</span><span class="w"> </span><span class="kn">import</span> <span class="n">MediaMetadata</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDownloadHandler</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Abstract base class for platform-specific download handlers."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Download media from URL and return metadata."""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supports_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check if this handler supports the given URL."""</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Build CLI command for external tool."""</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Parse CLI output into MediaMetadata."""</span>
        <span class="k">pass</span>
</code></pre></div>
<h3 id="platform-handler-implementations">Platform Handler Implementations<a class="headerlink" href="#platform-handler-implementations" title="Permanent link"></a></h3>
<h4 id="twitterhandler">TwitterHandler<a class="headerlink" href="#twitterhandler" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/handlers/twitter_handler.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TwitterHandler</span><span class="p">(</span><span class="n">BaseDownloadHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handle Twitter/X downloads using gallery-dl."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">supports_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check if URL is from Twitter/X."""</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">domain</span> <span class="ow">in</span> <span class="n">url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'twitter.com'</span><span class="p">,</span> <span class="s1">'x.com'</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Download Twitter content via gallery-dl CLI."""</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">'gallery-dl'</span><span class="p">,</span>
            <span class="s1">'--extract'</span><span class="p">,</span>                    <span class="c1"># Extract metadata only</span>
            <span class="s1">'--write-info-json'</span><span class="p">,</span>           <span class="c1"># Save metadata as JSON</span>
            <span class="s1">'--cookies-from-browser'</span><span class="p">,</span> <span class="s1">'firefox'</span><span class="p">,</span>  <span class="c1"># Use browser cookies</span>
            <span class="s1">'--user-agent'</span><span class="p">,</span> <span class="s1">'Mozilla/5.0...'</span><span class="p">,</span>    <span class="c1"># Set user agent</span>
            <span class="n">url</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DownloadError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"gallery-dl failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_twitter_metadata</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
<h4 id="youtubehandler">YouTubeHandler<a class="headerlink" href="#youtubehandler" title="Permanent link"></a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/handlers/youtube_handler.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">YouTubeHandler</span><span class="p">(</span><span class="n">BaseDownloadHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handle YouTube downloads using yt-dlp."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quality</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"720p"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Download YouTube content with quality selection."""</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">'yt-dlp'</span><span class="p">,</span>
            <span class="s1">'--format'</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'best[height&lt;=</span><span class="si">{</span><span class="n">quality</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]'</span><span class="p">,</span>  <span class="c1"># Quality selection</span>
            <span class="s1">'--write-info-json'</span><span class="p">,</span>                          <span class="c1"># Save metadata</span>
            <span class="s1">'--extract-flat'</span><span class="p">,</span>                             <span class="c1"># Extract info only</span>
            <span class="n">url</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_youtube_metadata</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

        <span class="c1"># Add quality information</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="n">quality</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">format_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_format_info</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metadata</span>
</code></pre></div>
<h3 id="enhanced-youtube-strategy-pattern">Enhanced YouTube Strategy Pattern<a class="headerlink" href="#enhanced-youtube-strategy-pattern" title="Permanent link"></a></h3>
<p>The YouTube strategy has been significantly enhanced with advanced features for Discord integration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/strategies/youtube_strategy.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">YouTubeDownloadStrategy</span><span class="p">(</span><span class="n">BaseDownloadStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Enhanced YouTube strategy with organized storage and deduplication."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_youtube_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get optimized yt-dlp configuration for Discord workflow."""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="c1"># Organized directory structure</span>
            <span class="s2">"outtmpl"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"default"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">/yt-dlp/youtube/%(uploader|Unknown)s/%(title).100s-%(id)s.%(ext)s"</span><span class="p">,</span>
                <span class="s2">"infojson"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">/yt-dlp/youtube/%(uploader|Unknown)s/%(title).100s-%(id)s.info.json"</span><span class="p">,</span>
                <span class="s2">"thumbnail"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">/yt-dlp/youtube/%(uploader|Unknown)s/%(title).100s-%(id)s.%(ext)s"</span><span class="p">,</span>
                <span class="s2">"description"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">/yt-dlp/youtube/%(uploader|Unknown)s/%(title).100s-%(id)s.description"</span>
            <span class="p">},</span>

            <span class="c1"># Quality ladder optimized for Discord limits</span>
            <span class="s2">"format"</span><span class="p">:</span> <span class="s2">"best[height&lt;=720][filesize&lt;50M]/best[height&lt;=480][filesize&lt;25M]/best[height&lt;=360][filesize&lt;10M]"</span><span class="p">,</span>

            <span class="c1"># Enhanced metadata preservation</span>
            <span class="s2">"writeinfojson"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"writedescription"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"writethumbnail"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"writesubtitles"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Skip subtitles for Discord uploads</span>

            <span class="c1"># Performance optimization</span>
            <span class="s2">"noplaylist"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"ignoreerrors"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">"retries"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">"fragment_retries"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">"socket_timeout"</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
            <span class="s2">"read_timeout"</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>

            <span class="c1"># Discord-friendly video settings</span>
            <span class="s2">"merge_output_format"</span><span class="p">:</span> <span class="s2">"mp4"</span><span class="p">,</span>
            <span class="s2">"postprocessor_args"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"-movflags"</span><span class="p">,</span> <span class="s2">"+faststart"</span><span class="p">]</span>  <span class="c1"># Web-optimized MP4</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Download with deduplication and performance tracking."""</span>
        <span class="c1"># Check for duplicates unless force_redownload is specified</span>
        <span class="n">duplicate_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_deduplication</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">duplicate_check</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Skipping duplicate download: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">duplicate_check</span>

        <span class="c1"># Performance tracking</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Enhanced error handling with YouTube-specific patterns</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_via_api_with_fallbacks</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Record performance metrics</span>
            <span class="n">download_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="n">video_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_youtube_video_id</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">video_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_record_download</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_record_performance_metrics</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">download_duration</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">download_method</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">metadata</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">download_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"YouTube download failed after </span><span class="si">{</span><span class="n">download_duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div>
<p><strong>Key Strategy Enhancements:</strong></p>
<ol>
<li><strong>Organized Directory Structure</strong></li>
<li><code>yt-dlp/youtube/{channel_name}/</code> hierarchy</li>
<li>Automatic channel name sanitization for filesystem compatibility</li>
<li>
<p>Consistent with gallery-dl organization patterns</p>
</li>
<li>
<p><strong>Discord Optimization</strong></p>
</li>
<li>Quality ladder: 720p (50MB)  480p (25MB)  360p (10MB)</li>
<li>MP4 format with web optimization (<code>+faststart</code>)</li>
<li>
<p>Automatic format selection based on Discord limits</p>
</li>
<li>
<p><strong>Deduplication System</strong></p>
</li>
<li>Video ID extraction from URLs (supports all YouTube URL formats)</li>
<li>Persistent download history in <code>.yt_download_history.json</code></li>
<li>Automatic duplicate detection with user notification</li>
<li>
<p>Force redownload option with <code>force_redownload=True</code></p>
</li>
<li>
<p><strong>Performance Monitoring</strong></p>
</li>
<li>Real-time download duration tracking</li>
<li>Method performance comparison (API vs CLI vs fallback)</li>
<li>Historical metrics storage in <code>.yt_performance_metrics.json</code></li>
<li>
<p>Statistics accessible via Discord commands</p>
</li>
<li>
<p><strong>Enhanced Error Handling</strong></p>
</li>
<li>YouTube-specific error patterns (age-restriction, copyright, private videos)</li>
<li>Retry logic with exponential backoff</li>
<li>Fatal vs retryable error classification</li>
<li>Automatic API-to-CLI fallback when enabled</li>
</ol>
<h3 id="handler-registration-and-discovery">Handler Registration and Discovery<a class="headerlink" href="#handler-registration-and-discovery" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/manager.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DownloadManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Manages download operations across platforms."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">BossSettings</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_handlers</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_register_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDownloadHandler</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Register all available download handlers."""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'twitter'</span><span class="p">:</span> <span class="n">TwitterHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">download_dir</span><span class="p">),</span>
            <span class="s1">'reddit'</span><span class="p">:</span> <span class="n">RedditHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">download_dir</span><span class="p">),</span>
            <span class="s1">'instagram'</span><span class="p">:</span> <span class="n">InstagramHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">download_dir</span><span class="p">),</span>
            <span class="s1">'youtube'</span><span class="p">:</span> <span class="n">YouTubeHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">download_dir</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDownloadHandler</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Find appropriate handler for URL."""</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">supports_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">handler</span>
        <span class="k">raise</span> <span class="n">UnsupportedURLError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"No handler found for URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h2 id="strategy-pattern-experimental">Strategy Pattern (Experimental)<a class="headerlink" href="#strategy-pattern-experimental" title="Permanent link"></a></h2>
<h3 id="architecture-overview_1">Architecture Overview<a class="headerlink" href="#architecture-overview_1" title="Permanent link"></a></h3>
<p>The Strategy pattern enables switching between CLI and API implementations:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Strategy Selection"
        FLAGS[Feature Flags] --&gt; STRATEGY[Download Strategy]
        STRATEGY --&gt; API{Use API?}
        API --&gt;|Yes| APICLIENT[API Client]
        API --&gt;|No| CLIHANDLER[CLI Handler]
        APICLIENT --&gt;|Fallback| CLIHANDLER
    end

    subgraph "Implementation"
        APICLIENT --&gt; GALLERYAPI[gallery-dl API]
        CLIHANDLER --&gt; GALLERYCLI[gallery-dl CLI]
        GALLERYAPI --&gt; METADATA[MediaMetadata]
        GALLERYCLI --&gt; METADATA
    end
</code></pre>
<h3 id="base-strategy-interface">Base Strategy Interface<a class="headerlink" href="#base-strategy-interface" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/strategies/base_strategy.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseDownloadStrategy</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Strategy interface for download implementations."""</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Download using chosen strategy (CLI or API)."""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supports_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check if strategy supports URL."""</span>
        <span class="k">pass</span>
</code></pre></div>
<h3 id="feature-flag-system">Feature Flag System<a class="headerlink" href="#feature-flag-system" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/feature_flags.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DownloadFeatureFlags</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Feature flags for download implementations."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">BossSettings</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">use_api_twitter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Use API-direct approach for Twitter downloads."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">twitter_use_api_client</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">use_api_reddit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Use API-direct approach for Reddit downloads."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">reddit_use_api_client</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">api_fallback_to_cli</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Fallback to CLI if API fails."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">download_api_fallback_to_cli</span>
</code></pre></div>
<h3 id="strategy-implementation-example">Strategy Implementation Example<a class="headerlink" href="#strategy-implementation-example" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/strategies/twitter_strategy.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TwitterDownloadStrategy</span><span class="p">(</span><span class="n">BaseDownloadStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Strategy for Twitter downloads with CLI/API choice."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_flags</span><span class="p">:</span> <span class="n">DownloadFeatureFlags</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span> <span class="o">=</span> <span class="n">feature_flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">download_dir</span>

        <span class="c1"># Keep existing CLI handler (unchanged)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_handler</span> <span class="o">=</span> <span class="n">TwitterHandler</span><span class="p">(</span><span class="n">download_dir</span><span class="o">=</span><span class="n">download_dir</span><span class="p">)</span>

        <span class="c1"># Lazy-loaded API client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">api_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Lazy load API client only when needed."""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">boss_bot.core.downloads.clients</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncGalleryDL</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="o">=</span> <span class="n">AsyncGalleryDL</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Download using feature-flagged approach."""</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="o">.</span><span class="n">use_api_twitter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_via_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"API download failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_flags</span><span class="o">.</span><span class="n">api_fallback_to_cli</span><span class="p">:</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_via_cli</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_via_cli</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_download_via_cli</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Use existing CLI handler (unchanged behavior)."""</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_handler</span><span class="o">.</span><span class="n">download</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_download_via_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Use new API client."""</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_api_response</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>
<h2 id="api-client-implementation">API Client Implementation<a class="headerlink" href="#api-client-implementation" title="Permanent link"></a></h2>
<h3 id="asyncgallerydl-client">AsyncGalleryDL Client<a class="headerlink" href="#asyncgallerydl-client" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/clients/aio_gallery_dl.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AsyncGalleryDL</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Asynchronous wrapper around gallery-dl API."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cookies_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cookies_from_browser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="n">config_file</span> <span class="ow">or</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"~/.gallery-dl.conf"</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

        <span class="c1"># Apply cookie settings</span>
        <span class="k">if</span> <span class="n">cookies_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">"extractor"</span><span class="p">,</span> <span class="p">{})[</span><span class="s2">"cookies"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cookies_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cookies_from_browser</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">"extractor"</span><span class="p">,</span> <span class="p">{})[</span><span class="s2">"cookies-from-browser"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cookies_from_browser</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Download content from URL asynchronously."""</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

        <span class="c1"># Run gallery-dl in thread pool to avoid blocking</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_run_gallerydl</span><span class="p">():</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">gallery_dl</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">gallery_dl</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">DownloadJob</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">job</span><span class="o">.</span><span class="n">pathfmt</span><span class="o">.</span><span class="n">tempdir</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_run_gallerydl</span><span class="p">)</span>

        <span class="c1"># Yield download results</span>
        <span class="k">for</span> <span class="n">file_info</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">{</span>
                <span class="s2">"url"</span><span class="p">:</span> <span class="n">file_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"url"</span><span class="p">),</span>
                <span class="s2">"filename"</span><span class="p">:</span> <span class="n">file_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"filename"</span><span class="p">),</span>
                <span class="s2">"extractor"</span><span class="p">:</span> <span class="n">file_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"extractor"</span><span class="p">),</span>
                <span class="s2">"metadata"</span><span class="p">:</span> <span class="n">file_info</span>
            <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">extract_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Extract metadata without downloading files."""</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_extract_metadata</span><span class="p">():</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">gallery_dl</span>
            <span class="n">extractor</span> <span class="o">=</span> <span class="n">gallery_dl</span><span class="o">.</span><span class="n">extractor</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extractor</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">items</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_extract_metadata</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">item</span>
</code></pre></div>
<h3 id="configuration-management">Configuration Management<a class="headerlink" href="#configuration-management" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/clients/config/gallery_dl_config.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">SecretStr</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TwitterConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Twitter extractor configuration."""</span>
    <span class="n">quoted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">replies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">retweets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">videos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cookies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{category}</span><span class="s2">_</span><span class="si">{user[screen_name]}</span><span class="s2">_</span><span class="si">{id}</span><span class="s2">_</span><span class="si">{num}</span><span class="s2">.</span><span class="si">{extension}</span><span class="s2">"</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"twitter"</span><span class="p">,</span> <span class="s2">"</span><span class="si">{user[screen_name]}</span><span class="s2">"</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GalleryDLConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Root gallery-dl configuration with validation."""</span>
    <span class="n">extractor</span><span class="p">:</span> <span class="n">ExtractorConfig</span>
    <span class="n">downloader</span><span class="p">:</span> <span class="n">DownloaderConfig</span> <span class="o">=</span> <span class="n">DownloaderConfig</span><span class="p">()</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
        <span class="c1"># Allow loading from JSON files</span>
        <span class="n">json_encoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">SecretStr</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">}</span>
</code></pre></div>
<h2 id="mediametadata-schema">MediaMetadata Schema<a class="headerlink" href="#mediametadata-schema" title="Permanent link"></a></h2>
<h3 id="core-metadata-structure">Core Metadata Structure<a class="headerlink" href="#core-metadata-structure" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/schemas/discord/metadata.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MediaMetadata</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Unified metadata for downloaded media."""</span>

    <span class="c1"># Core identification</span>
    <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span>                      <span class="c1"># twitter, reddit, youtube, instagram</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>                           <span class="c1"># Original URL</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>           <span class="c1"># Platform-specific ID</span>

    <span class="c1"># Content information</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>        <span class="c1"># Post/video title</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Content description</span>
    <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>       <span class="c1"># Creator/uploader</span>
    <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># Video duration (seconds)</span>

    <span class="c1"># Media files</span>
    <span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MediaFile</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c1"># Downloaded files</span>
    <span class="n">thumbnail</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># Thumbnail URL</span>

    <span class="c1"># Platform-specific metadata</span>
    <span class="n">platform_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Raw platform data</span>

    <span class="c1"># Download metadata</span>
    <span class="n">download_timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">download_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"cli"</span>       <span class="c1"># "cli" or "api"</span>
    <span class="n">file_size_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># Video quality (720p, 1080p, etc.)</span>

    <span class="c1"># Social metadata (when available)</span>
    <span class="n">like_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">retweet_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">view_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">comment_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MediaFile</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Individual media file information."""</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span>                     <span class="c1"># image, video, audio</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span>                      <span class="c1"># image/jpeg, video/mp4, etc.</span>
    <span class="n">size_bytes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">checksum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># File integrity check</span>
</code></pre></div>
<h3 id="platform-specific-extensions">Platform-Specific Extensions<a class="headerlink" href="#platform-specific-extensions" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Twitter-specific metadata extensions</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TwitterMetadata</span><span class="p">(</span><span class="n">MediaMetadata</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Twitter-specific metadata fields."""</span>
    <span class="n">tweet_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_screen_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_retweet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_quote_tweet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">thread_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
        <span class="c1"># Ensure platform is always "twitter"</span>
        <span class="n">schema_extra</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"platform"</span><span class="p">:</span> <span class="s2">"twitter"</span><span class="p">}</span>

<span class="c1"># YouTube-specific metadata extensions</span>
<span class="k">class</span><span class="w"> </span><span class="nc">YouTubeMetadata</span><span class="p">(</span><span class="n">MediaMetadata</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""YouTube-specific metadata fields."""</span>
    <span class="n">video_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">channel_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">channel_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">upload_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">categories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_livestream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">format_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># Available formats/qualities</span>
</code></pre></div>
<h2 id="configuration-and-environment-variables">Configuration and Environment Variables<a class="headerlink" href="#configuration-and-environment-variables" title="Permanent link"></a></h2>
<h3 id="feature-flag-environment-variables">Feature Flag Environment Variables<a class="headerlink" href="#feature-flag-environment-variables" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Enable API-direct for specific platforms</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TWITTER_USE_API_CLIENT</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">REDDIT_USE_API_CLIENT</span><span class="o">=</span><span class="nb">false</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">INSTAGRAM_USE_API_CLIENT</span><span class="o">=</span><span class="nb">false</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">YOUTUBE_USE_API_CLIENT</span><span class="o">=</span><span class="nb">false</span>

<span class="c1"># Fallback behavior</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DOWNLOAD_API_FALLBACK_TO_CLI</span><span class="o">=</span><span class="nb">true</span>

<span class="c1"># Gallery-dl configuration</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GALLERY_DL_CONFIG_FILE</span><span class="o">=</span><span class="s2">"~/.gallery-dl.conf"</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GALLERY_DL_COOKIES_FROM_BROWSER</span><span class="o">=</span><span class="s2">"firefox"</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GALLERY_DL_USER_AGENT</span><span class="o">=</span><span class="s2">"Mozilla/5.0 (compatible; BossBot/1.0)"</span>
</code></pre></div>
<h3 id="bosssettings-integration">BossSettings Integration<a class="headerlink" href="#bosssettings-integration" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/env.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BossSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Bot configuration with download system settings."""</span>

    <span class="c1"># Download system configuration</span>
    <span class="n">download_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">"./downloads"</span><span class="p">))</span>
    <span class="n">max_file_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100_000_000</span><span class="p">)</span>  <span class="c1"># 100MB</span>
    <span class="n">max_concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Feature flags for experimental features</span>
    <span class="n">twitter_use_api_client</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reddit_use_api_client</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">instagram_use_api_client</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">youtube_use_api_client</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">download_api_fallback_to_cli</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Gallery-dl configuration</span>
    <span class="n">gallery_dl_config_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">"~/.gallery-dl.conf"</span><span class="p">))</span>
    <span class="n">gallery_dl_cookies_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">gallery_dl_cookies_from_browser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">gallery_dl_user_agent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">"Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0"</span>
    <span class="p">)</span>
</code></pre></div>
<h2 id="error-handling-and-resilience">Error Handling and Resilience<a class="headerlink" href="#error-handling-and-resilience" title="Permanent link"></a></h2>
<h3 id="error-hierarchy">Error Hierarchy<a class="headerlink" href="#error-hierarchy" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/boss_bot/core/downloads/exceptions.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DownloadError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Base exception for download operations."""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UnsupportedURLError</span><span class="p">(</span><span class="n">DownloadError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""URL is not supported by any handler."""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QuotaExceededError</span><span class="p">(</span><span class="n">DownloadError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""User or guild storage quota exceeded."""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DownloadTimeoutError</span><span class="p">(</span><span class="n">DownloadError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download operation timed out."""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ExternalToolError</span><span class="p">(</span><span class="n">DownloadError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""External tool (gallery-dl/yt-dlp) failed."""</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">returncode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stderr</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">returncode</span> <span class="o">=</span> <span class="n">returncode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">stderr</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">tool</span><span class="si">}</span><span class="s2"> failed with code </span><span class="si">{</span><span class="n">returncode</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">stderr</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="retry-and-fallback-logic">Retry and Fallback Logic<a class="headerlink" href="#retry-and-fallback-logic" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_with_retry</span><span class="p">(</span>
    <span class="n">strategy</span><span class="p">:</span> <span class="n">BaseDownloadStrategy</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MediaMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Download with automatic retry and fallback."""</span>

    <span class="n">last_exception</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">strategy</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">DownloadTimeoutError</span><span class="p">,</span> <span class="n">ExternalToolError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">last_exception</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span>  <span class="c1"># Exponential backoff</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Download attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed, retrying in </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"All </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> download attempts failed"</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">last_exception</span>
</code></pre></div>
<h2 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link"></a></h2>
<h3 id="asyncawait-patterns">Async/Await Patterns<a class="headerlink" href="#asyncawait-patterns" title="Permanent link"></a></h3>
<ul>
<li><strong>CLI Operations</strong>: Execute in thread pool via <code>loop.run_in_executor()</code></li>
<li><strong>API Operations</strong>: Native async with proper context management</li>
<li><strong>File I/O</strong>: Use <code>aiofiles</code> for non-blocking file operations</li>
<li><strong>Concurrent Downloads</strong>: Semaphore-based rate limiting</li>
</ul>
<h3 id="resource-management">Resource Management<a class="headerlink" href="#resource-management" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Concurrent download limiting</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_multiple</span><span class="p">(</span><span class="n">urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">max_concurrent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download multiple URLs with concurrency control."""</span>
    <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">max_concurrent</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_one</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">strategy</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">download_one</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h2 id="compression-integration">Compression Integration<a class="headerlink" href="#compression-integration" title="Permanent link"></a></h2>
<h3 id="post-download-compression">Post-Download Compression<a class="headerlink" href="#post-download-compression" title="Permanent link"></a></h3>
<p>Boss-Bot includes automatic compression capabilities to ensure downloaded media meets Discord file size limits:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Integration with download workflow</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_and_compress</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>  <span class="c1"># Discord Nitro limit</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CompressionResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Download and automatically compress media."""</span>

    <span class="c1"># Standard download process</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_manager</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Check if compression is needed</span>
    <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">file_size_bytes</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">target_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span>
        <span class="c1"># Initialize compression manager</span>
        <span class="n">compression_manager</span> <span class="o">=</span> <span class="n">CompressionManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>

        <span class="c1"># Compress the downloaded file</span>
        <span class="n">compression_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">compression_manager</span><span class="o">.</span><span class="n">compress_file</span><span class="p">(</span>
            <span class="n">input_path</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">target_size_mb</span><span class="o">=</span><span class="n">target_size_mb</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">compression_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="c1"># Update metadata with compressed file info</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">compression_result</span><span class="o">.</span><span class="n">output_path</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">file_size_bytes</span> <span class="o">=</span> <span class="n">compression_result</span><span class="o">.</span><span class="n">compressed_size_bytes</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">compression_ratio</span> <span class="o">=</span> <span class="n">compression_result</span><span class="o">.</span><span class="n">compression_ratio</span>

        <span class="k">return</span> <span class="n">compression_result</span>

    <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No compression needed</span>
</code></pre></div>
<h3 id="compression-strategy-selection">Compression Strategy Selection<a class="headerlink" href="#compression-strategy-selection" title="Permanent link"></a></h3>
<p>The system automatically selects appropriate compression strategies based on file type:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Compression Flow"
        DOWNLOAD[Downloaded File] --&gt; DETECT[File Type Detection]
        DETECT --&gt; VIDEO{Video?}
        DETECT --&gt; AUDIO{Audio?}
        DETECT --&gt; IMAGE{Image?}

        VIDEO --&gt;|Yes| VIDEOPROC[Video Processor]
        AUDIO --&gt;|Yes| AUDIOPROC[Audio Processor]
        IMAGE --&gt;|Yes| IMAGEPROC[Image Processor]

        VIDEOPROC --&gt; FFMPEG[FFmpeg Compression]
        AUDIOPROC --&gt; AUDIOCOMP[Audio Compression]
        IMAGEPROC --&gt; PILLOW[PIL/Pillow Optimization]

        FFMPEG --&gt; RESULT[Compressed File]
        AUDIOCOMP --&gt; RESULT
        PILLOW --&gt; RESULT
    end
</code></pre>
<h3 id="discord-integration">Discord Integration<a class="headerlink" href="#discord-integration" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Discord cog integration example</span>
<span class="nd">@commands</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"download"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download with automatic compression for Discord."""</span>

    <span class="c1"># Determine target size based on user/server perks</span>
    <span class="n">target_size_mb</span> <span class="o">=</span> <span class="mi">25</span> <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span><span class="o">.</span><span class="n">premium_tier</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">8</span>  <span class="c1"># Nitro vs basic</span>

    <span class="c1"># Download and compress</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_manager</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Check if compression is needed</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">file_size_bytes</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">target_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span>
            <span class="n">processing_msg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">" Compressing file for Discord..."</span><span class="p">)</span>

            <span class="n">compression_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression_manager</span><span class="o">.</span><span class="n">compress_file</span><span class="p">(</span>
                <span class="n">input_path</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span>
                <span class="n">target_size_mb</span><span class="o">=</span><span class="n">target_size_mb</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">compression_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="c1"># Send compressed file</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">" Compressed from </span><span class="si">{</span><span class="n">compression_result</span><span class="o">.</span><span class="n">original_size_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB "</span>
                    <span class="sa">f</span><span class="s2">"to </span><span class="si">{</span><span class="n">compression_result</span><span class="o">.</span><span class="n">compressed_size_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB "</span>
                    <span class="sa">f</span><span class="s2">"(ratio: </span><span class="si">{</span><span class="n">compression_result</span><span class="o">.</span><span class="n">compression_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)"</span><span class="p">,</span>
                    <span class="n">file</span><span class="o">=</span><span class="n">discord</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">compression_result</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Compression failed: </span><span class="si">{</span><span class="n">compression_result</span><span class="o">.</span><span class="n">error_message</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Send original file</span>
            <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">discord</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_path</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Download failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="compression-configuration">Compression Configuration<a class="headerlink" href="#compression-configuration" title="Permanent link"></a></h3>
<p><strong>Environment Variables:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Compression settings</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COMPRESSION_TARGET_SIZE_MB</span><span class="o">=</span><span class="m">50</span><span class="w">        </span><span class="c1"># Default target size</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COMPRESSION_FFMPEG_PRESET</span><span class="o">=</span>slow<span class="w">       </span><span class="c1"># Quality vs speed balance</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COMPRESSION_MAX_CONCURRENT</span><span class="o">=</span><span class="m">3</span><span class="w">         </span><span class="c1"># Concurrent operations</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COMPRESSION_MIN_VIDEO_BITRATE_KBPS</span><span class="o">=</span><span class="m">125</span><span class="w">  </span><span class="c1"># Minimum video quality</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COMPRESSION_MIN_AUDIO_BITRATE_KBPS</span><span class="o">=</span><span class="m">32</span><span class="w">   </span><span class="c1"># Minimum audio quality</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COMPRESSION_IMAGE_MIN_QUALITY</span><span class="o">=</span><span class="m">10</span><span class="w">     </span><span class="c1"># Minimum image quality (%)</span>
</code></pre></div></p>
<p><strong>Validation and Feasibility:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Pre-compression validation</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_compression_feasible</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">target_size_mb</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Check if compression to target size is possible."""</span>

    <span class="n">media_info</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression_manager</span><span class="o">.</span><span class="n">get_media_info</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># Check current size vs target</span>
    <span class="n">current_size_mb</span> <span class="o">=</span> <span class="n">media_info</span><span class="o">.</span><span class="n">file_size_bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">current_size_mb</span> <span class="o">&lt;=</span> <span class="n">target_size_mb</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"File already </span><span class="si">{</span><span class="n">current_size_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB (target: </span><span class="si">{</span><span class="n">target_size_mb</span><span class="si">}</span><span class="s2">MB)"</span>

    <span class="c1"># Check minimum quality constraints</span>
    <span class="k">if</span> <span class="n">media_info</span><span class="o">.</span><span class="n">duration_seconds</span><span class="p">:</span>
        <span class="n">required_bitrate</span> <span class="o">=</span> <span class="n">target_size_mb</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">media_info</span><span class="o">.</span><span class="n">duration_seconds</span>
        <span class="n">min_bitrate</span> <span class="o">=</span> <span class="mi">125</span> <span class="o">+</span> <span class="mi">32</span>  <span class="c1"># Video + audio minimum</span>

        <span class="k">if</span> <span class="n">required_bitrate</span> <span class="o">&lt;</span> <span class="n">min_bitrate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Required bitrate </span><span class="si">{</span><span class="n">required_bitrate</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">kbps below minimum </span><span class="si">{</span><span class="n">min_bitrate</span><span class="si">}</span><span class="s2">kbps"</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">""</span>
</code></pre></div></p>
<p><strong>Error Handling:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Compression-specific error handling</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">compression_manager</span><span class="o">.</span><span class="n">compress_file</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">target_size_mb</span><span class="p">)</span>
<span class="k">except</span> <span class="n">CompressionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">"bitrate"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">" File too long for target size. Try a smaller target or longer video."</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">"codec"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">" Unsupported video codec. Please try a different file."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Compression failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></p>
<p>This download system provides both stability through the proven Handler pattern and innovation through the experimental Strategy pattern, enabling gradual adoption of new features while maintaining backward compatibility. The integrated compression system ensures all downloaded media can be shared within Discord's file size constraints while maintaining optimal quality.</p>
<h2 id="upload-system-integration">Upload System Integration<a class="headerlink" href="#upload-system-integration" title="Permanent link"></a></h2>
<h3 id="enhanced-download-workflow">Enhanced Download Workflow<a class="headerlink" href="#enhanced-download-workflow" title="Permanent link"></a></h3>
<p>The download system now integrates seamlessly with the upload system to provide a complete download-to-Discord workflow:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Enhanced Download Workflow"
        USER[Discord User] --&gt; CMD[Download Command]
        CMD --&gt; VALIDATE[URL Validation]
        VALIDATE --&gt; STRATEGY[Select Strategy]
        STRATEGY --&gt; DOWNLOAD[Execute Download]
        DOWNLOAD --&gt; SUCCESS{Download Success?}
        SUCCESS --&gt;|No| ERROR[Send Error Message]
        SUCCESS --&gt;|Yes| UPLOAD_CHECK{Upload Requested?}
        UPLOAD_CHECK --&gt;|No| SAVE[Save to Directory]
        UPLOAD_CHECK --&gt;|Yes| UPLOAD_FLOW[Upload Workflow]

        subgraph "Upload Workflow"
            UPLOAD_FLOW --&gt; DETECT[Detect Media Files]
            DETECT --&gt; ANALYZE[Analyze File Sizes]
            ANALYZE --&gt; COMPRESS{Files &gt; Discord Limit?}
            COMPRESS --&gt;|Yes| COMPRESSION[Compress Files]
            COMPRESS --&gt;|No| BATCH[Create Upload Batches]
            COMPRESSION --&gt; BATCH
            BATCH --&gt; DISCORD_UPLOAD[Upload to Discord]
            DISCORD_UPLOAD --&gt; CLEANUP[Cleanup Files]
        end

        SAVE --&gt; END[Complete]
        CLEANUP --&gt; END
        ERROR --&gt; END
    end
</code></pre>
<h3 id="download-upload-integration-architecture">Download-Upload Integration Architecture<a class="headerlink" href="#download-upload-integration-architecture" title="Permanent link"></a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Integration architecture in download cog</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DownloadCog</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">Cog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Enhanced download cog with upload integration."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">settings</span>

        <span class="c1"># Core download components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_manager</span> <span class="o">=</span> <span class="n">DownloadManager</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_strategies</span><span class="p">()</span>

        <span class="c1"># New upload integration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_manager</span> <span class="o">=</span> <span class="n">UploadManager</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_with_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Unified download and upload workflow."""</span>

        <span class="c1"># Phase 1: Download to isolated directory</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">download_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_manager</span><span class="o">.</span><span class="n">create_isolated_dir</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Execute download using strategy pattern</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Download failed: </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Download completed!"</span><span class="p">)</span>

            <span class="c1"># Phase 2: Upload processing (if requested)</span>
            <span class="k">if</span> <span class="n">upload</span><span class="p">:</span>
                <span class="n">upload_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_manager</span><span class="o">.</span><span class="n">process_downloaded_files</span><span class="p">(</span>
                    <span class="n">download_dir</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">platform</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">upload_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" </span><span class="si">{</span><span class="n">upload_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" </span><span class="si">{</span><span class="n">upload_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Phase 3: Cleanup</span>
            <span class="k">if</span> <span class="n">upload</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">upload_cleanup_after_success</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>
</code></pre></div>
<h3 id="upload-aware-download-configuration">Upload-Aware Download Configuration<a class="headerlink" href="#upload-aware-download-configuration" title="Permanent link"></a></h3>
<p>The download system now includes upload-specific configuration options:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Enhanced BossSettings with upload integration</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BossSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="c1"># Download configuration (existing)</span>
    <span class="n">download_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">"./downloads"</span><span class="p">))</span>
    <span class="n">max_concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Upload integration configuration (new)</span>
    <span class="n">upload_cleanup_after_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Remove downloaded files after successful upload"</span><span class="p">,</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="s2">"UPLOAD_CLEANUP_AFTER_SUCCESS"</span>
    <span class="p">)</span>
    <span class="n">upload_enable_progress_updates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Show upload progress messages"</span><span class="p">,</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="s2">"UPLOAD_ENABLE_PROGRESS_UPDATES"</span>
    <span class="p">)</span>
    <span class="n">upload_batch_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Maximum batch size for Discord uploads in MB"</span><span class="p">,</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="s2">"UPLOAD_BATCH_SIZE_MB"</span>
    <span class="p">)</span>
    <span class="n">upload_max_files_per_batch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Maximum files per Discord message"</span><span class="p">,</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="s2">"UPLOAD_MAX_FILES_PER_BATCH"</span>
    <span class="p">)</span>

    <span class="c1"># Compression for upload optimization</span>
    <span class="n">compression_max_upload_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Target compression size for Discord uploads in MB"</span><span class="p">,</span>
        <span class="n">validation_alias</span><span class="o">=</span><span class="s2">"COMPRESSION_MAX_UPLOAD_SIZE_MB"</span>
    <span class="p">)</span>
</code></pre></div>
<h3 id="command-interface-changes">Command Interface Changes<a class="headerlink" href="#command-interface-changes" title="Permanent link"></a></h3>
<p>The download commands now support upload functionality:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Updated command signatures</span>
<span class="nd">@commands</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"download"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">upload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download content and optionally upload to Discord.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: URL to download</span>
<span class="sd">        upload: Whether to upload files to Discord (default: True)</span>

<span class="sd">    Examples:</span>
<span class="sd">        $download https://twitter.com/user/status/123         # Download and upload</span>
<span class="sd">        $download https://youtube.com/watch?v=abc upload=False # Download only</span>
<span class="sd">    """</span>

<span class="nd">@commands</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"download-only"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_only_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">commands</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Download content without uploading to Discord.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: URL to download</span>

<span class="sd">    Examples:</span>
<span class="sd">        $download-only https://twitter.com/user/status/123</span>
<span class="sd">    """</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_command</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<h3 id="upload-integration-examples">Upload Integration Examples<a class="headerlink" href="#upload-integration-examples" title="Permanent link"></a></h3>
<p><strong>Basic Usage:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Download and upload (default behavior)</span>
<span class="nv">$download</span><span class="w"> </span>https://twitter.com/user/status/123

<span class="c1"># Download only (no upload)</span>
<span class="nv">$download</span>-only<span class="w"> </span>https://youtube.com/watch?v<span class="o">=</span>VIDEO_ID

<span class="c1"># Explicit upload control</span>
<span class="nv">$download</span><span class="w"> </span>https://reddit.com/r/pics/comments/abc123/<span class="w"> </span><span class="nv">upload</span><span class="o">=</span>False

<span class="c1"># YouTube-specific commands with enhanced features</span>
<span class="nv">$yt</span>-download<span class="w"> </span>https://youtube.com/watch?v<span class="o">=</span>VIDEO_ID<span class="w"> </span>1080p<span class="w">          </span><span class="c1"># High quality</span>
<span class="nv">$yt</span>-download<span class="w"> </span>https://youtube.com/watch?v<span class="o">=</span>VIDEO_ID<span class="w"> </span>720p<span class="w"> </span>True<span class="w">     </span><span class="c1"># Audio only</span>
<span class="nv">$yt</span>-playlist<span class="w"> </span>https://youtube.com/playlist?list<span class="o">=</span>PLAYLIST_ID<span class="w"> </span>720p<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c1"># Playlist (5 videos)</span>
<span class="nv">$yt</span>-stats<span class="w">                                                        </span><span class="c1"># Performance stats</span>
</code></pre></div></p>
<p><strong>Workflow Messages:</strong>
<div class="highlight"><pre><span></span><code>User: $download https://twitter.com/example/status/123

Bot:  Twitter/X download completed!
Bot:  Processing files for upload...
Bot:  Found 2 media files (15.3MB total)
Bot:  Uploading batch 1/1: image1.jpg, video1.mp4 (15.3MB)
Bot:  Twitter/X media files: [files attached]
Bot:  Upload complete: 2/2 files uploaded
</code></pre></div></p>
<h3 id="temporary-directory-management">Temporary Directory Management<a class="headerlink" href="#temporary-directory-management" title="Permanent link"></a></h3>
<p>The enhanced download system uses temporary directories for upload processing:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Temporary directory strategy</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DownloadManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Enhanced download manager with upload integration."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_isolated_download_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Create isolated directory for download-upload workflow."""</span>
        <span class="n">download_subdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">/</span> <span class="n">request_id</span>
        <span class="n">download_subdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">download_subdir</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_with_isolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">isolated_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Download to isolated directory for upload processing."""</span>
        <span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_strategy_for_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Temporarily change strategy download directory</span>
        <span class="n">original_dir</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">download_dir</span>
        <span class="n">strategy</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">isolated_dir</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">strategy</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore original directory</span>
            <span class="n">strategy</span><span class="o">.</span><span class="n">download_dir</span> <span class="o">=</span> <span class="n">original_dir</span>
</code></pre></div>
<h3 id="error-handling-and-fallbacks">Error Handling and Fallbacks<a class="headerlink" href="#error-handling-and-fallbacks" title="Permanent link"></a></h3>
<p>Enhanced error handling for download-upload workflows:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Comprehensive error handling</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_download_upload_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handle errors in download-upload workflow."""</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Download phase</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Download failed: </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Upload phase (if requested)</span>
        <span class="k">if</span> <span class="n">upload</span><span class="p">:</span>
            <span class="n">upload_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_manager</span><span class="o">.</span><span class="n">process_downloaded_files</span><span class="p">(</span>
                <span class="n">download_dir</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">platform</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">upload_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="c1"># Fallback: Save files locally</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Upload failed: </span><span class="si">{</span><span class="n">upload_result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Files saved locally to: `</span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">`"</span><span class="p">)</span>

                <span class="c1"># Don't cleanup on upload failure</span>
                <span class="k">return</span>

    <span class="k">except</span> <span class="n">DownloadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Download error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unexpected error in download-upload workflow: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">" An unexpected error occurred. Files may be saved locally."</span><span class="p">)</span>
</code></pre></div>
<h3 id="performance-optimizations">Performance Optimizations<a class="headerlink" href="#performance-optimizations" title="Permanent link"></a></h3>
<p>Upload integration includes several performance optimizations:</p>
<p><strong>Concurrent Processing:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Concurrent download and upload preparation</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">optimized_download_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Optimized workflow with concurrent operations."""</span>

    <span class="c1"># Start download</span>
    <span class="n">download_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

    <span class="c1"># Prepare upload manager while downloading</span>
    <span class="n">upload_manager</span> <span class="o">=</span> <span class="n">UploadManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>

    <span class="c1"># Wait for download completion</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">download_task</span>

    <span class="c1"># Process upload immediately</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="n">upload_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">upload_manager</span><span class="o">.</span><span class="n">process_downloaded_files</span><span class="p">(</span>
            <span class="n">download_dir</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">platform</span>
        <span class="p">)</span>
</code></pre></div></p>
<p><strong>Smart Batching:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Intelligent batching for large downloads</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">batch_large_downloads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_files</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handle large downloads with smart batching."""</span>

    <span class="c1"># Analyze total size</span>
    <span class="n">total_size_mb</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">size_mb</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">media_files</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_size_mb</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># Large download</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">" Large download detected (</span><span class="si">{</span><span class="n">total_size_mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB). Processing in batches..."</span><span class="p">)</span>

        <span class="c1"># Process in smaller batches for better UX</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">media_files</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">media_files</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_upload_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="integration-benefits">Integration Benefits<a class="headerlink" href="#integration-benefits" title="Permanent link"></a></h3>
<p>The upload integration provides several key benefits:</p>
<ol>
<li><strong>Seamless User Experience</strong>: Single command for download-to-Discord workflow</li>
<li><strong>Automatic Compression</strong>: Oversized files are automatically compressed for Discord</li>
<li><strong>Intelligent Batching</strong>: Files are optimally grouped for Discord's limits</li>
<li><strong>Progress Feedback</strong>: Real-time updates on download and upload progress</li>
<li><strong>Error Resilience</strong>: Graceful handling of upload failures with local fallback</li>
<li><strong>Resource Management</strong>: Automatic cleanup of temporary files</li>
<li><strong>Configuration Flexibility</strong>: Extensive customization options</li>
</ol>
<p>This integration transforms the download system from a simple file retrieval tool into a comprehensive media sharing solution optimized for Discord's platform constraints.</p>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="August 12, 2025 23:41:12">August 12, 2025 23:41:12</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Created">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="August 12, 2025 23:41:12">August 12, 2025 23:41:12</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Contributors">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"></path></svg>
</span>
<nav>
<a href="mailto:bossjones@theblacktonystark.com">Malcolm Jones</a>
</nav>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Discord Integration" class="md-footer__link md-footer__link--prev" href="../discord-integration/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Discord Integration
              </div>
</div>
</a>
<a aria-label="Next: Testing Patterns" class="md-footer__link md-footer__link--next" href="../testing-patterns/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Testing Patterns
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright  2023 - 2025 Malcolm Jones
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bossjones/boss-bot" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.select", "content.tooltips", "navigation.footer", "search.share", "navigation.indexes", "navigation.sections"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>